{"version":3,"mappings":"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","names":["t","r","n","s","o","a","e","i","_a","_b","__vitePreload","_c","c","l","h","d","m","p","b","g","F"],"ignoreList":[0,1],"sources":["../../node_modules/@arcgis/core/versionManagement/support/versionManagementUtils.js","../../node_modules/@arcgis/core/layers/mixins/EditBusLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import{generateLowercaseBracedUUID as r}from\"../../core/uuid.js\";const t=r(),n=new Map,s=new Map,a=new Map;async function o(r,t,s){if(!r||!s)return!1;if(!t)return!0;const a=new URL(r).host;let o=n.get(a);if(!o){const t=r.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\");o=(await e(t,{responseType:\"json\",query:{f:\"json\"}})).data.defaultVersionName}return o===t}async function i(e,r,n=!1){if(!e||!r)return!0;const a=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),o=s.get(a)?.entries();if(o)for(const[s,i]of o)if(i.name===r){const e=!i.stack?.hasForwardEdits();if(!e&&n){const[{deleteForwardEdits:e},{default:r}]=await Promise.all([import(\"../../rest/versionManagement/gdbVersion/deleteForwardEdits.js\"),import(\"../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters.js\")]),n=await e(a,s,new r({sessionId:t,moment:i.moment}));return n.success&&i.stack?.clearForwardEdits(),n.success}return e}return!0}function c(e,r){if(!e)return!1;const t=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),n=s.get(t)?.entries();if(n)for(const[s,a]of n)if(a.name===r){return\"edit\"===a.lockType}return!1}export{t as currentSessionId,n as defaultVersionNameLookup,o as isHistoricVersion,i as isSafeToEditVersion,c as isVersionInEditSession,s as versionCollection,a as versionCollectionCount};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Evented.js\";import{clone as i}from\"../../core/lang.js\";import{createResolver as s}from\"../../core/promiseUtils.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{defaultVersionNameLookup as o,isVersionInEditSession as n}from\"../../versionManagement/support/versionManagementUtils.js\";const a=new e.EventEmitter;function l(t){return a.on(\"apply-edits\",new WeakRef(t))}function h(t){return a.on(\"update-moment\",new WeakRef(t))}function c(t,e,i=null,r=!1){const d=s();return r=null==e||r,a.emit(\"apply-edits\",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:d.promise}),d}function u(t,e,i=null,s){a.emit(\"update-moment\",{serviceUrl:t,layerId:e,gdbVersion:i,moment:s})}const m=Symbol();function p(t){return null!=t&&\"object\"==typeof t&&m in t}function b(t){return null!=t&&\"object\"==typeof t&&\"gdbVersion\"in t}function g(t,e,i){const s=new URL(t).host,r=o.get(s),d=t=>!t||t===r;return d(e)&&d(i)||e===i}const F=e=>{var s;let o=class extends e{constructor(...t){super(...t),this[s]=!0,this._applyEditsHandler=t=>{const{serviceUrl:e,layerId:s,gdbVersion:r,mayReceiveServiceEdits:d,result:o}=t,n=e===this.url,a=null!=s&&null!=this.layerId&&s===this.layerId,l=b(this),h=b(this)&&g(e,r,this.gdbVersion);if(!n||l&&!h||!a&&!d)return;const c=o.then((t=>{if(this.lastEditsEventDate=new Date,a&&(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length))return this.emit(\"edits\",i(t)),t;const s=t.editedFeatures?.find((({layerId:t})=>t===this.layerId));if(s){const{adds:e,updates:r,deletes:d}=s.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:e?e.map((({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],deletedFeatures:d?d.map((({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],updatedFeatures:r?r.map((({current:{attributes:t}})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],editedFeatures:i(t.editedFeatures),exceededTransferLimit:!1,historicMoment:i(t.historicMoment)};return this.emit(\"edits\",o),o}const d={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:i(t.editedFeatures),exceededTransferLimit:!1,historicMoment:i(t.historicMoment)};return\"historicMoment\"in this&&this._shouldUpdateHistoricMoment(e,r,d.historicMoment)&&this.emit(\"edits\",d),d})).then((t=>(\"historicMoment\"in this&&this._shouldUpdateHistoricMoment(e,r,t.historicMoment)&&(this.historicMoment=t.historicMoment),t)));this.emit(\"apply-edits\",{result:c})},this._updateMomentHandler=t=>{const{serviceUrl:e,gdbVersion:i,moment:s}=t,r=e===this.url,d=b(this),o=b(this)&&g(e,i,this.gdbVersion),n=b(this)&&!g(e,this.gdbVersion,null);r&&d&&o&&n&&\"historicMoment\"in this&&this.historicMoment!==s&&(this.historicMoment=s)},this.when().then((()=>{this.addHandles(l(this._applyEditsHandler)),\"historicMoment\"in this&&this.addHandles(h(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(t,e,i){return\"historicMoment\"in this&&this.historicMoment!==i&&n(t,e)}};return s=m,t([r()],o.prototype,\"lastEditsEventDate\",void 0),o=t([d(\"esri.layers.mixins.EditBusLayer\")],o),o};export{F as EditBusLayer,c as emitApplyEditsEvent,u as emitUpdateMomentEvent,p as isEditBusLayer,b as isLayerWithGDBVersion,l as onApplyEditsEvent,h as onUpdateMomentEvent,g as versionMatches};\n"],"file":"assets/EditBusLayer-BwLk-_N_.js"}