{"version":3,"mappings":"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","names":["n","e","t","__vitePreload","i","o","r","a","d","c","g","S","E","l","s","_a","f","u","j","m","w","y","p","h","b","L","I","A","_","P","M","N","U","T","x"],"ignoreList":[0,1,2,3],"sources":["../../node_modules/@arcgis/core/libs/i3s/enums.js","../../node_modules/@arcgis/core/libs/i3s/I3SModule.js","../../node_modules/@arcgis/core/views/3d/layers/i3s/I3SNode.js","../../node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nvar n,e;!function(n){n[n.None=0]=\"None\",n[n.Int16=1]=\"Int16\",n[n.Int32=2]=\"Int32\"}(n||(n={})),function(n){n[n.Replace=0]=\"Replace\",n[n.Outside=1]=\"Outside\",n[n.Inside=2]=\"Inside\",n[n.Finished=3]=\"Finished\"}(e||(e={}));export{n as IndexType,e as ModificationType};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return n||(n=new Promise((t=>import(\"../../chunks/i3s.js\").then((t=>t.i)).then((({default:e})=>{const n=e({locateFile:i,onRuntimeInitialized:()=>t(n)});delete n.then})))).catch((t=>{throw t}))),n}function i(e){return t(`esri/libs/i3s/${e}`)}let n;export{e as get};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{fromValues as e}from\"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{f as i}from\"../../../../chunks/sphere.js\";import{invalidateMbs as n}from\"./I3SUtil.js\";import{ElevationRange as t}from\"../../support/ElevationRange.js\";class s extends t{constructor(e,n){super(NaN,NaN),this.id=e,this.serviceMbsInIndexSR=n,this.serviceMbsInRenderSR=i(0,0,0,-1)}invalidateServiceBVsInRenderSR(){n(this.serviceMbsInRenderSR),this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(e){this.serviceObbInRenderSR=e.serviceObbInRenderSR,this.serviceMbsInRenderSR=e.serviceMbsInRenderSR}}var o,r,a,d,c;!function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.Culled=1]=\"Culled\",e[e.NotChecked=2]=\"NotChecked\"}(o||(o={})),function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.PotentiallyModified=1]=\"PotentiallyModified\",e[e.Culled=2]=\"Culled\",e[e.Unknown=3]=\"Unknown\",e[e.NotChecked=4]=\"NotChecked\"}(r||(r={}));class h extends s{constructor(i,n,t,s,o,d,c,h,l,u){super(i,t),this.index=n,this.childCount=s,this.level=o,this.resources=d,this.version=c,this.lodMetric=h,this.maxError=l,this.numFeatures=u,this.failed=!1,this.cacheState=a.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=r.NotChecked,this.elevationAgnosticBoundingVolume=e(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR(),this.elevationAgnosticBoundingVolume[3]=-1}}!function(e){e[e.Unknown=0]=\"Unknown\",e[e.Uncached=1]=\"Uncached\",e[e.Cached=2]=\"Cached\"}(a||(a={})),function(e){e[e.None=0]=\"None\",e[e.MaxScreenThreshold=1]=\"MaxScreenThreshold\",e[e.ScreenSpaceRelative=2]=\"ScreenSpaceRelative\",e[e.RemovedFeatureDiameter=3]=\"RemovedFeatureDiameter\",e[e.DistanceRangeFromDefaultCamera=4]=\"DistanceRangeFromDefaultCamera\"}(d||(d={})),function(e){e[e.Hole=0]=\"Hole\",e[e.Leaf=1]=\"Leaf\"}(c||(c={}));class l{constructor(e,i,n,t){this.nodeHasLOD=e,this.isChosen=i,this.lodLevel=n,this.version=t}}export{a as CacheState,d as LodMetric,h as Node,s as NodeBase,o as NodeFilterImpact,r as NodeIMModificationImpact,c as NodeState,l as NodeTraversalState};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{hasScaling as e}from\"../../../core/mathUtils.js\";import t from\"../../../geometry/SpatialReference.js\";import r from\"../../../geometry/support/MeshGeoreferencedVertexSpace.js\";import o from\"../../../geometry/support/MeshLocalVertexSpace.js\";import{b as n,n as s}from\"../../../chunks/vec3.js\";import{IndexType as i}from\"../../../libs/i3s/enums.js\";import{get as a}from\"../../../libs/i3s/I3SModule.js\";import{NodeIMModificationImpact as f}from\"./i3s/I3SNode.js\";async function c(e){g=await S();const t=[e.geometryBuffer];return{result:E(g,e,t),transferList:t}}async function l(e){g=await S();const t=[e.geometryBuffer],{geometryBuffer:r}=e,o=r.byteLength,n=g._malloc(o),s=new Uint8Array(g.HEAPU8.buffer,n,o);s.set(new Uint8Array(r));const i=g.dracoDecompressPointCloudData(n,s.byteLength);if(g._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&t.push(a.buffer),t.push(f.buffer),{result:{positions:f,featureIds:a},transferList:t}}async function u(e){await S(),j(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function m(e){await S(),w(e)}async function y(e){g=await S(),g.setLegacySchema(e.context,e.jsonSchema)}async function p(e){const{localMatrix:n,origin:s,positions:i,vertexSpace:a}=e,f=t.fromJSON(e.inSpatialReference),c=t.fromJSON(e.outSpatialReference);let l;const[{projectBuffer:u},{initializeProjection:m}]=await Promise.all([import(\"../../../geometry/projection/projectBuffer.js\"),import(\"../../../geometry/projection.js\")]);await m(f,c);const y=[0,0,0];if(!u(s,f,0,y,c,0))throw new Error(\"Failed to project\");if(\"georeferenced\"===a.type&&null==a.origin){if(l=new Float64Array(i.length),!u(i,f,0,l,c,0,l.length/3))throw new Error(\"Failed to project\")}else{const e=\"georeferenced\"===a.type?r.fromJSON(a):o.fromJSON(a),{projectMeshVertexPositions:t}=await import(\"../../../geometry/support/meshUtils/projectMeshVertexPositions.js\"),s=t({vertexAttributes:{position:i},transform:n?{localMatrix:n}:void 0,vertexSpace:e,spatialReference:f},c);if(!s)throw new Error(\"Failed to project\");l=s}const p=l.length,[d,h,b]=y;for(let t=0;t<p;t+=3)l[t]-=d,l[t+1]-=h,l[t+2]-=b;return{result:{projected:l,original:i,projectedOrigin:y},transferList:[l.buffer,i.buffer]}}async function d({normalMatrix:t,normals:r}){const o=new Float32Array(r.length);return n(o,r,t),e(t)&&s(o,o),{result:{transformed:o,original:r},transferList:[o.buffer,r.buffer]}}function h(e){L(e)}let b,g;function w(e){if(!g)return;const t=e.modifications,r=g._malloc(8*t.length),o=new Float64Array(g.HEAPU8.buffer,r,t.length);for(let n=0;n<t.length;++n)o[n]=t[n];g.setModifications(e.context,r,t.length,e.isGeodetic),g._free(r)}function E(e,t,r){const{context:o,globalTrafo:n,mbs:s,obbData:a,elevationOffset:f,geometryBuffer:c,geometryDescriptor:l,indexToVertexProjector:u,vertexToRenderProjector:m}=t,y=e._malloc(c.byteLength),p=33,d=e._malloc(p*Float64Array.BYTES_PER_ELEMENT),h=new Uint8Array(e.HEAPU8.buffer,y,c.byteLength);h.set(new Uint8Array(c));const b=new Float64Array(e.HEAPU8.buffer,d,p);I(b,[NaN,NaN,NaN]);let g=b.byteOffset+3*b.BYTES_PER_ELEMENT,w=new Float64Array(b.buffer,g);I(w,n),g+=16*b.BYTES_PER_ELEMENT,w=new Float64Array(b.buffer,g),I(w,s),g+=4*b.BYTES_PER_ELEMENT,a&&(w=new Float64Array(b.buffer,g),I(w,a));const E=l,A={isDraco:!1,isLegacy:!1,color:t.layouts.some((e=>e.some((e=>\"color\"===e.name)))),normal:t.needNormals&&t.layouts.some((e=>e.some((e=>\"normalCompressed\"===e.name)))),uv0:t.layouts.some((e=>e.some((e=>\"uv0\"===e.name)))),uvRegion:t.layouts.some((e=>e.some((e=>\"uvRegion\"===e.name)))),featureIndex:E.featureIndex},j=e.process(o,!!t.obbData,y,h.byteLength,E,A,d,f,u,m,t.normalReferenceFrame);if(e._free(d),e._free(y),j.error.length>0)throw new Error(`i3s.wasm: ${j.error}`);if(j.discarded)return null;const L=j.componentOffsets.length>0?j.componentOffsets.slice():null,x=j.featureIds.length>0?j.featureIds.slice():null,S=j.anchorIds.length>0?Array.from(j.anchorIds):null,_=j.anchors.length>0?Array.from(j.anchors):null,P=j.interleavedVertedData.slice().buffer,M=j.indicesType===i.Int16?new Uint16Array(j.indices.buffer,j.indices.byteOffset,j.indices.byteLength/2).slice():new Uint32Array(j.indices.buffer,j.indices.byteOffset,j.indices.byteLength/4).slice(),N=j.positions.slice(),U=j.positionIndicesType===i.Int16?new Uint16Array(j.positionIndices.buffer,j.positionIndices.byteOffset,j.positionIndices.byteLength/2).slice():new Uint32Array(j.positionIndices.buffer,j.positionIndices.byteOffset,j.positionIndices.byteLength/4).slice(),T={layout:t.layouts[0],interleavedVertexData:P,indices:M,hasColors:j.hasColors,hasModifications:j.hasModifications,positionData:{data:N,indices:U}};return x&&r.push(x.buffer),L&&r.push(L.buffer),r.push(P),r.push(M.buffer),r.push(N.buffer),r.push(U.buffer),{componentOffsets:L,featureIds:x,anchorIds:S,anchors:_,transformedGeometry:T,obb:j.obb,globalTrafo:n}}function A(e){return 0===e?f.Unmodified:1===e?f.PotentiallyModified:2===e?f.Culled:f.Unknown}function j(e){if(!g)return;const{context:t,buffer:r}=e,o=g._malloc(r.byteLength),n=r.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(g.HEAPU8.buffer,o,n),i=new Float64Array(r);s.set(i),g.filterOBBs(t,o,n),i.set(s),g._free(o)}function L(e){g&&0===g.destroy(e)&&(g=null)}function I(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}async function x(){g||await S()}function S(){return g?Promise.resolve(g):(b||(b=a().then((e=>(g=e,b=null,g)))),b)}const _={transform:(e,t)=>g&&E(g,e,t),destroy:L};export{h as destroyContext,l as dracoDecompressPointCloudData,u as filterObbsForModifications,j as filterObbsForModificationsSync,x as initialize,A as interpretObbModificationResults,c as process,p as project,y as setLegacySchema,m as setModifications,w as setModificationsSync,_ as test,d as transformNormals};\n"],"file":"assets/SceneLayerWorker-YZBdcji3.js"}