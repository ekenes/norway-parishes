{"version":3,"file":"UpdatingHandles-Dsl38oBb.js","sources":["../../node_modules/@arcgis/core/core/support/UpdatingHandles.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import e from\"../Accessor.js\";import{makeHandle as t}from\"../handleUtils.js\";import{watch as i,when as n,on as d,sync as a}from\"../reactiveUtils.js\";import{schedule as r}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let h=class extends e{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(s,e,t={}){return this._installWatch(s,e,t,i)}addWhen(s,e,t={}){return this._installWatch(s,e,t,n)}addOnCollectionChange(s,e,{initial:i=!1,final:n=!1}={}){const r=++this._handleId;return this.addHandles([d(s,\"after-changes\",this._createSyncUpdatingCallback(),a),d(s,\"change\",e,{onListenerAdd:i?s=>e({added:s.toArray(),removed:[]}):void 0,onListenerRemove:n?s=>e({added:[],removed:s.toArray()}):void 0})],r),t((()=>this.removeHandles(r)))}addPromise(s){if(null==s)return s;const e=++this._handleId;this.addHandles(t((()=>{this._pendingPromises.delete(s)&&(0!==this._pendingPromises.size||this.hasHandles(c)||this._set(\"updating\",!1))})),e),this._pendingPromises.add(s),this._set(\"updating\",!0);const i=()=>this.removeHandles(e);return s.then(i,i),s}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set(\"updating\",!1)}_installWatch(s,e,i={},n){const d=++this._handleId;i.sync||this._installSyncUpdatingWatch(s,d);const a=n(s,e,i);return this.addHandles(a,d),t((()=>this.removeHandles(d)))}_installSyncUpdatingWatch(s,e){const t=this._createSyncUpdatingCallback(),n=i(s,t,{sync:!0,equals:()=>!1});return this.addHandles(n,e),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(c),++this._scheduleHandleId;const s=this._scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.addHandles(r((()=>{s===this._scheduleHandleId&&(this._set(\"updating\",this._pendingPromises.size>0),this.removeHandles(c))})),c)}}};s([o({readOnly:!0})],h.prototype,\"updating\",void 0),h=s([l(\"esri.core.support.UpdatingHandles\")],h);const c=-42;export{h as UpdatingHandles};\n"],"names":["h","e","s","i","n","r","d","a","t","c","o","l"],"mappings":"yGAI4X,IAACA,EAAE,cAAcC,CAAC,CAAC,aAAa,CAAC,MAAM,GAAG,SAAS,EAAE,KAAK,SAAS,GAAG,KAAK,UAAU,EAAE,KAAK,kBAAkB,EAAE,KAAK,iBAAiB,IAAI,GAAG,CAAC,SAAS,CAAC,KAAK,UAAS,CAAE,CAAC,IAAIC,EAAED,EAAE,EAAE,CAAE,EAAC,CAAC,OAAO,KAAK,cAAcC,EAAED,EAAE,EAAEE,CAAC,CAAC,CAAC,QAAQD,EAAED,EAAE,EAAE,CAAA,EAAG,CAAC,OAAO,KAAK,cAAcC,EAAED,EAAE,EAAEG,CAAC,CAAC,CAAC,sBAAsBF,EAAED,EAAE,CAAC,QAAQE,EAAE,GAAG,MAAMC,EAAE,EAAE,EAAE,CAAA,EAAG,CAAC,MAAMC,EAAE,EAAE,KAAK,UAAU,OAAO,KAAK,WAAW,CAACC,EAAEJ,EAAE,gBAAgB,KAAK,4BAA2B,EAAGK,CAAC,EAAED,EAAEJ,EAAE,SAASD,EAAE,CAAC,cAAcE,EAAED,GAAGD,EAAE,CAAC,MAAMC,EAAE,UAAU,QAAQ,CAAA,CAAE,CAAC,EAAE,OAAO,iBAAiBE,EAAEF,GAAGD,EAAE,CAAC,MAAM,CAAA,EAAG,QAAQC,EAAE,SAAS,CAAC,EAAE,MAAM,CAAC,CAAC,EAAEG,CAAC,EAAEG,EAAG,IAAI,KAAK,cAAcH,CAAC,CAAC,CAAE,CAAC,WAAWH,EAAE,CAAC,GAASA,GAAN,KAAQ,OAAOA,EAAE,MAAMD,EAAE,EAAE,KAAK,UAAU,KAAK,WAAWO,EAAG,IAAI,CAAC,KAAK,iBAAiB,OAAON,CAAC,IAAQ,KAAK,iBAAiB,OAA1B,GAAgC,KAAK,WAAWO,CAAC,GAAG,KAAK,KAAK,WAAW,EAAE,EAAE,CAAC,EAAGR,CAAC,EAAE,KAAK,iBAAiB,IAAIC,CAAC,EAAE,KAAK,KAAK,WAAW,EAAE,EAAE,MAAMC,EAAE,IAAI,KAAK,cAAcF,CAAC,EAAE,OAAOC,EAAE,KAAKC,EAAEA,CAAC,EAAED,CAAC,CAAC,WAAW,CAAC,KAAK,iBAAiB,QAAQ,KAAK,iBAAkB,EAAC,KAAK,KAAK,WAAW,EAAE,CAAC,CAAC,cAAcA,EAAED,EAAEE,EAAE,CAAE,EAACC,EAAE,CAAC,MAAME,EAAE,EAAE,KAAK,UAAUH,EAAE,MAAM,KAAK,0BAA0BD,EAAEI,CAAC,EAAE,MAAMC,EAAEH,EAAEF,EAAED,EAAEE,CAAC,EAAE,OAAO,KAAK,WAAWI,EAAED,CAAC,EAAEE,EAAG,IAAI,KAAK,cAAcF,CAAC,CAAC,CAAE,CAAC,0BAA0BJ,EAAED,EAAE,CAAC,MAAM,EAAE,KAAK,4BAA6B,EAACG,EAAED,EAAED,EAAE,EAAE,CAAC,KAAK,GAAG,OAAO,IAAI,EAAE,CAAC,EAAE,OAAO,KAAK,WAAWE,EAAEH,CAAC,EAAEG,CAAC,CAAC,6BAA6B,CAAC,MAAM,IAAI,CAAC,KAAK,cAAcK,CAAC,EAAE,EAAE,KAAK,kBAAkB,MAAMP,EAAE,KAAK,kBAAkB,KAAK,KAAK,UAAU,GAAG,KAAK,KAAK,WAAW,EAAE,EAAE,KAAK,WAAWG,EAAG,IAAI,CAACH,IAAI,KAAK,oBAAoB,KAAK,KAAK,WAAW,KAAK,iBAAiB,KAAK,CAAC,EAAE,KAAK,cAAcO,CAAC,EAAE,CAAG,EAACA,CAAC,CAAC,CAAC,CAAC,EAAEP,EAAE,CAACQ,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,EAAEV,EAAE,UAAU,WAAW,MAAM,EAAEA,EAAEE,EAAE,CAACS,EAAE,mCAAmC,CAAC,EAAEX,CAAC,EAAE,MAAMS,EAAE","x_google_ignoreList":[0]}