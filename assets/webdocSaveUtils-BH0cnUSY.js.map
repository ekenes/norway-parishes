{"version":3,"mappings":"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","names":["I","e","A","t","r","U","o","E","P","M","a","i","n","O","S","V","ye","W","d","T","D","X","he","C","_a","R","s","f","m","pe","Y","k","w","x","G","L","N","$","B","F","K","H","J","q","z","Q","y","h","Z","re","ae","ie","ne","se","le","ee","te","c","oe","me","g","j","ce","l","__vitePreload","b","_","ue","u","fe","de","we","v","p","be","ge","_e"],"ignoreList":[0],"sources":["../../node_modules/@arcgis/core/webdoc/support/webdocSaveUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{MultiOriginJSONSupport as t}from\"../../core/MultiOriginJSONSupport.js\";import{whenOnce as o}from\"../../core/reactiveUtils.js\";import{hasSameCanonicalPortal as r,urlToObject as a}from\"../../core/urlUtils.js\";import{updateOrigins as i}from\"../../core/accessorSupport/originUtils.js\";import n from\"../../geometry/SpatialReference.js\";import{equals as s}from\"../../geometry/support/spatialReferenceUtils.js\";import{webMercatorToGeographic as l}from\"../../geometry/support/webMercatorUtils.js\";import{isServerOrServicesAGOLUrl as p}from\"../../layers/support/arcgisLayerUrl.js\";import{isLayerWithFeatureLayerSource as c,isFeatureCollectionLayer as u}from\"../../layers/support/layerUtils.js\";import m from\"../../portal/Portal.js\";import f from\"../../portal/PortalItem.js\";import{createForItemWrite as d}from\"../../portal/support/jsonContext.js\";import{typeKeyword as w,removeTypeKeyword as y,addTypeKeyword as h,hasTypeKeyword as g}from\"../../portal/support/portalItemUtils.js\";import{project as _}from\"../../rest/geometryService/project.js\";import b from\"../../rest/support/ProjectParameters.js\";import{hasDeveloperBasemapLayer as j,findSpatialReference as R,isDeveloperBasemapLayer as v}from\"../../support/basemapUtils.js\";import{saveResources as W}from\"./resourceUtils.js\";import{beforeSave as P,evaluateWriteErrors as S}from\"./saveUtils.js\";const I=[\"NatGeo_World_Map\",\"Ocean_Basemap\",\"USA_Topo_Maps\",\"World_Imagery\",\"World_Street_Map\",\"World_Terrain_Base\",\"World_Topo_Map\",\"World_Hillshade\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Reference_Overlay\",\"Reference/World_Transportation\"].map((e=>e.toLowerCase()));async function A(e,t,r){r??={},U(e,t),await o((()=>!t.updatingFromView)),await t.load(),await E(t),await P(t),await M(e,t);const a=t.portalItem,{json:i,jsonContext:n}=await O(t,a);return S(n,{errorName:`${e.name}:save`},r),await V(t,a),await ye(e,t,a,i,n),await Promise.all([t.updateItemThumbnail(),W(t.resourceReferences,n)]),a}async function O(e,t){const o=d(t,\"web-map\",!0),r=e.write({},o);return await Promise.all(o.resources.pendingOperations),{json:r,jsonContext:o}}async function T(e,t,r,a){a??={};const i=D(e,r);await o((()=>!t.updatingFromView)),await t.load(),await E(t),await P(t),await M(e,t);const{json:n,jsonContext:s}=await O(t,i);S(s,{errorName:`${e.name}:save`},a),await X(t,i);const l=t.getThumbnailState();return await he(e,t,i,n,s,a)&&(t.resourceReferences.portalItem=i),t.restoreThumbnailFromState(l),await Promise.all([t.updateItemThumbnail(),W(t.resourceReferences,s)]),i}function U(t,o){if(!o.portalItem)throw new e(`${t.name}:portal-item-not-set`,\"Portal item to save to has not been set on the WebMap\");C(t,o.portalItem)}function C(t,o){if(o.type!==t.itemType)throw new e(`${t.name}:portal-item-wrong-type`,`Portal item needs to have type \"${t.itemType}\"`)}async function M(t,r){if(!r.basemap?.baseLayers.length)throw new e(`${t.name}:save`,\"Map does not have a valid basemap with a base layer.\");let a=null;if(await o((()=>{const e=R(r.initialViewProperties,r.basemap);return a=e.spatialReference,!e.updating})),!s(a,r.initialViewProperties.spatialReference))throw new e(`${t.name}:save`,\"The spatial reference of the basemap is not compatible with the one from the map.\",{expected:r.initialViewProperties.spatialReference,actual:a})}function D(e,t){let o=f.from(t);return o.id&&(o=o.clone(),o.id=null),o.type||(o.type=e.itemType),o.portal||(o.portal=m.getDefault()),C(e,o),o}function E(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function V(e,t){t.extent=await pe(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await Y(e,t)}const k=w.JSAPI,x=\"CollectorDisabled\",G=\"Collector\",L=\"Data Editing\",N=\"OfflineDisabled\",$=\"Offline\",B=\"Workforce Project\",F=\"Workforce Worker\",K=\"Workforce Dispatcher\",H=\"Offline Map Areas\",J=\"FieldMapsDisabled\",q=w.DEVELOPER_BASEMAP,z=\"UtilityNetwork\",Q=\"IPS\";async function X(e,t){y(t,x),y(t,J),y(t,w.METADATA),y(t,N),y(t,H),y(t,K),y(t,B),y(t,F),await V(e,t)}async function Y(e,t){h(t,k),await Z(e),re(e,t),ae(e,t),ie(e,t),ne(e,t),se(e,t),le(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,o)=>o.indexOf(e)===t)))}function Z(e){const t=ee(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}function ee(e){return e.allLayers.concat(e.allTables)}function te(e){return ee(e).some((e=>e.loaded&&c(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&(\"subtype-group\"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}function oe(e){return ee(e).filter((e=>\"group\"!==e.type)).every((t=>t.loaded&&me(e,t)))}function re(e,t){g(t,x)||g(t,B)||g(t,F)||g(t,K)||!te(e)?y(t,G):h(t,G)}function ae(e,t){te(e)?h(t,L):y(t,L)}function ie(e,t){!g(t,N)&&oe(e)?h(t,$):y(t,$)}function ne(e,t){j(e.basemap)?h(t,q):y(t,q)}function se(e,t){e.utilityNetworks?.length?h(t,z):y(t,z)}function le(e,t){e.ipsInfo?h(t,Q):y(t,Q)}async function pe(e,t){const o=t.clone().normalize();let r;if(o.length>1)for(const a of o)r?a.width>r.width&&(r=a):r=a;else r=o[0];return ce(e,r)}async function ce(e,t){const o=t.spatialReference;if(o.isWGS84)return t.clone();if(o.isWebMercator)return l(t);const{getGeometryServiceURL:r}=await import(\"../../portal/support/geometryServiceUtils.js\"),a=await r(e),i=new b({geometries:[t],outSpatialReference:n.WGS84});return(await _(a,i))[0]}function ue(e){return u(e)||\"map-notes\"===e.type||\"route\"===e.type}function me(e,t){return c(t)&&t.capabilities.operations.supportsSync||ue(t)&&!t.portalItem||fe(t)&&!de(t)&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}function fe(e){return(\"tile\"===e.type||\"vector-tile\"===e.type)&&(e.capabilities.operations.supportsExportTiles||we(e)||v(e))}function de(e){return\"vector-tile\"===e.type&&Object.keys(e.sourceNameToSource).length>1}function we(e){return\"tile\"===e.type&&(p(e.url)&&I.some((t=>e.url?.toLowerCase().includes(\"/\"+t+\"/\"))))}async function ye(e,t,o,r,a){await o.update({data:r}),be(e,t,o,r,a)}async function he(t,o,r,a,i,n){const s=o.portalItem,l={item:s,authenticated:!(!s?.id||!s.portal.user)},p=r.portal;await p.signIn();const{copyAllowed:c,itemReloaded:u}=await ge(l,p);if(l.authenticated||=u,!c)throw new e(`${t.name}:save-as-copy-not-allowed`,\"Owner of this map does not allow others to save a copy\");const m=await _e(r,l,a,n);return o.portalItem=r,be(t,o,r,a,i),m}async function ge(e,t){const{item:o,authenticated:r}=e;return o?.id&&o.typeKeywords?.includes(\"useOnly\")?o.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await o.reload(),{copyAllowed:\"admin\"===o.itemControl||\"update\"===o.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function _e(e,t,o,a){const i=e.portal,{item:n}=t,{folder:s,copyAllResources:l}=a;let p=!1;if(l&&n?.id&&r(n.portal.url,i.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();p=!!e}if(p){const t=await n.copy({copyResources:\"all\",folder:s});e.id=t.id,e.portal=t.portal;const r=e.toJSON();await e.load(),e.read(r),await e.update({data:o})}else await i.user.addItem({item:e,folder:s,data:o});return p}function be(e,o,r,n,s){t.prototype.read.call(o,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:r.itemUrl?a(r.itemUrl):void 0}),i(s),o.resourceInfo=n}export{O as createJSON,_e as initializeNewItem,ge as isCopyAllowed,A as save,T as saveAs};\n"],"file":"assets/webdocSaveUtils-BH0cnUSY.js"}