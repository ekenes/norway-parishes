{"version":3,"file":"basemapUtils-CpQKNmzZ.js","sources":["../../node_modules/@arcgis/core/support/basemapUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../Basemap.js\";import r from\"../config.js\";import t from\"../core/Collection.js\";import n from\"../core/Logger.js\";import{destroyMaybe as a,mappedFind as i}from\"../core/maybe.js\";import{Url as l,makeAbsolute as s,normalize as u}from\"../core/urlUtils.js\";import{ensureType as o}from\"../core/accessorSupport/ensureType.js\";import{effectEquals as c}from\"../layers/effects/utils.js\";import{esriBasemapDefinitions as f}from\"./basemapDefinitions.js\";const p=()=>n.getLogger(\"esri.support.basemapUtils\");function y(){return{}}function m(e){for(const r in e){const t=e[r];a(t),delete e[r]}}function b(t,n){let a;if(\"string\"==typeof t){const i=t in f,l=!i&&t.includes(\"/\");if(!i&&!l){if(r.apiKey)p().warn(`Unable to find basemap definition for: ${t}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const e=Object.entries(f).filter((([e,r])=>r.classic||r.is3d)).map((([e])=>`\"${e}\"`)).sort().join(\", \");p().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${e}`)}return null}n&&(a=n[t]),a||(a=i?e.fromId(t):new e({style:{id:t}}),n&&(n[t]=a))}else a=o(e,t);return a?.destroyed&&(p().warn(\"The provided basemap is already destroyed\",{basemap:a}),a=null),a}function d(e){return\"Web Scene\"===e.portalItem?.type||e.referenceLayers.some((e=>\"scene\"===e.type))}function L(e){return!!e?.portalItem?.tags?.some((e=>\"beta\"===e.toLowerCase()))}function v(e,r){return e.basemap?.referenceLayers?.some((e=>e.uid===r))||e.basemap?.baseLayers?.some((e=>e.uid===r))}function S(e,r=null){const t=b(e);if(!t)return null;const n=t.clone();return r&&(n.baseLayers=w(n.baseLayers,r.baseLayers),n.referenceLayers=w(n.referenceLayers,r.referenceLayers)),n}let g;function h(e){if(g)return g(e);let r=null;const t=M(e),n=!t?.baseLayers.length;for(const a in f){const e=N(t,C(f[a]),{mustMatchReferences:n});if(\"equal\"===e){r=a;break}\"base-layers-equal\"===e&&(r=a)}return r}function I(e){g=e}function R(e,r){if(e===r)return!0;if(null!=e?.portalItem?.id&&e.portalItem.id===r?.portalItem?.id)return!0;return\"equal\"===N(M(e),M(r),{mustMatchReferences:!0})}function w(e,r){const n=new t;return e.forEach((e=>{const t=r.find((r=>\"scene\"!==r.type&&E($(e),$(r))))||e;n.includes(t)?n.push(e):n.push(t)})),n}function T(e){return!!e?.baseLayers.concat(e.referenceLayers).some(U)}function U(e){if(x(e.url))return!0;if(\"vector-tile\"===e.type)for(const r in e.sourceNameToSource){const t=e.sourceNameToSource[r];if(x(t?.sourceUrl))return!0}return!1}function j(e,r){if(null==r||null==e)return{spatialReference:null,updating:!1};if(\"not-loaded\"===r.loadStatus)return r.load(),{spatialReference:null,updating:!0};if(r.spatialReference)return{spatialReference:r.spatialReference,updating:!1};if(0===r.baseLayers.length)return{spatialReference:null,updating:!1};const t=r.baseLayers.at(0);switch(t.loadStatus){case\"not-loaded\":t.load();case\"loading\":return{spatialReference:null,updating:!0};case\"failed\":return{spatialReference:null,updating:!1}}const n=((\"supportedSpatialReferences\"in t?t.supportedSpatialReferences:null)||[\"tileInfo\"in t?t.tileInfo?.spatialReference:t.spatialReference]).filter(Boolean),a=e.spatialReference;return a?{spatialReference:n.find((e=>a.equals(e)))??n[0]??null,updating:!1}:{spatialReference:n[0],updating:!1}}const q=/^(basemaps|ibasemaps).*-api\\.arcgis\\.com$/i;function x(e){if(!e)return!1;const r=new l(s(e));return!!r.authority&&q.test(r.authority)}function M(e){return e?!e.loaded&&e.resourceInfo?C(e.resourceInfo.data):{baseLayers:k(e.baseLayers),referenceLayers:k(e.referenceLayers)}:null}function k(e){return(t.isCollection(e)?e.toArray():e).map($)}function $(e){return{type:e.type,effect:\"effect\"in e?e.effect:void 0,url:K(\"urlTemplate\"in e&&e.urlTemplate||e.url||\"styleUrl\"in e&&e.styleUrl||\"\"),minScale:\"minScale\"in e&&null!=e.minScale?e.minScale:0,maxScale:\"maxScale\"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:\"map-image\"!==e.type&&\"wms\"!==e.type||null==e.sublayers?void 0:e.sublayers?.map((e=>({id:e.id,visible:e.visible}))),activeLayerId:\"wmts\"===e.type?e.activeLayer?.id:void 0}}function A(e){return e.isReference||\"ArcGISSceneServiceLayer\"===e.layerType}function C(e){return e?{baseLayers:G((e.baseMapLayers??[]).filter((e=>!A(e)))),referenceLayers:G((e.baseMapLayers??[]).filter((e=>A(e))))}:null}function G(e){return e.map((e=>B(e)))}function B(e){let r;switch(e.layerType){case\"VectorTileLayer\":r=\"vector-tile\";break;case\"ArcGISTiledMapServiceLayer\":r=\"tile\";break;case\"ArcGISSceneServiceLayer\":r=\"scene\";break;default:r=\"unknown\"}return{type:r,effect:e.effect,url:K(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function N(e,r,t){if(null!=e!=(null!=r))return\"not-equal\";if(!e||!r)return\"equal\";if(!D(e.baseLayers,r.baseLayers))return\"not-equal\";return D(e.referenceLayers,r.referenceLayers)?\"equal\":t.mustMatchReferences?\"not-equal\":\"base-layers-equal\"}function D(e,r){if(e.length!==r.length)return!1;for(let t=0;t<e.length;t++)if(!E(e[t],r[t]))return!1;return!0}function E(e,r){if(e.type!==r.type||e.url!==r.url||e.minScale!==r.minScale||e.maxScale!==r.maxScale||e.visible!==r.visible||e.opacity!==r.opacity)return!1;if(!c(e.effect,r.effect))return!1;if(null!=e.activeLayerId||null!=r.activeLayerId)return e.activeLayerId===r.activeLayerId;if(null!=e.sublayers||null!=r.sublayers){if(null==e.sublayers||null==r.sublayers||e.sublayers.length!==r.sublayers.length)return!1;for(let t=0;t<e.sublayers.length;t++){const n=e.sublayers.at(t),a=r.sublayers.at(t);if(n?.id!==a?.id||n?.visible!==a?.visible)return!1}}return!0}function K(e){return e?u(e).replace(/^\\s*https?:/i,\"\").toLowerCase():\"\"}function O(e){if(!e)return null;const{thumbnailUrl:r}=e;if(r)return r;const t=h(e);return t?f[t].thumbnailUrl:i(e.baseLayers,V)}function V(e){return\"portalItem\"in e?e.portalItem?.thumbnailUrl:void 0}export{S as clonePreservingTiledLayers,R as contentEquals,y as createCache,m as destroyCache,b as ensureType,j as findSpatialReference,O as getBasemapThumbnailUrl,h as getWellKnownBasemapId,T as hasDeveloperBasemapLayer,d as isBasemap3D,L as isBasemapInBeta,v as isBasemapLayer,U as isDeveloperBasemapLayer,I as overrideGetWellKnownBasemapId};\n"],"names":["p","n","y","m","r","a","b","t","i","f","l","e","o","d","_a","L","_b","h","M","N","C","R","T","U","x","j","q","s","k","$","K","A","G","B","D","E","c","u","O","V"],"mappings":"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","x_google_ignoreList":[0]}