const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Popup-BOUubKuz.js","assets/index-0pHHYqT1.js","assets/index-Ddror8Kk.css","assets/Features-BEIXf-Yz.js","assets/geometryUtils-DeNS-ciH.js","assets/scaleUtils-cTfktxVy.js","assets/substitute-B7ZoV2aS.js","assets/jsxFactory-E4nqU-E1.js","assets/uuid-Cl5lrJ4c.js","assets/ReactiveSet-B2wVSELk.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/AttachmentInfo-eept_wUk.js","assets/featureLayerUtils-o4ogvGp7.js","assets/globalCss-IeUjKp3y.js","assets/Heading-DA91nHq1.js","assets/a11yUtils-u-4mCwef.js","assets/utils-98v4oY_W.js","assets/utils-B0NXzfYL.js","assets/cimSymbolUtils-gotKQIcT.js","assets/mat2df32-orApM5a3.js","assets/webStyleSymbolUtils-PJLQR2R2.js","assets/themeUtils-C3zvZbsE.js","assets/shared-BUFLxX-y.js","assets/TimeOnly-DDwf7-uv.js","assets/FeatureLayer-CLFLYoCH.js","assets/MultiOriginJSONSupport-TbxqwyX4.js","assets/commonProperties-CUfTzj5N.js","assets/FeatureLayerBase-BK564wbX.js","assets/HeightModelInfo-Dpg9rG1D.js","assets/LayerFloorInfo-vgxZ2T0V.js","assets/Relationship-CAcVCOO_.js","assets/serviceCapabilitiesUtils-PSx4Rb3I.js","assets/editsZScale-CvCkWL30.js","assets/APIKeyMixin-BF8uUpas.js","assets/ArcGISService-Dzxg3G3l.js","assets/CustomParametersMixin-RLrsYJRF.js","assets/EditBusLayer-BwLk-_N_.js","assets/FeatureEffectLayer-DLo0B2xh.js","assets/FeatureEffect-BcjtHuez.js","assets/FeatureReductionLayer-7b6Nqwz0.js","assets/FeatureReductionSelection-BoqJWAJO.js","assets/labelingInfo-DEVe8ZeJ.js","assets/labelUtils-CVz6nlM3.js","assets/MD5-C9MwAd2G.js","assets/OperationalLayer-CqOXhR1u.js","assets/OrderedLayer-DbP1K9H4.js","assets/OrderByInfo-BgypIh2b.js","assets/PortalLayer-678mR6Su.js","assets/portalItemUtils-DNXyin3a.js","assets/RefreshableLayer-vaXU4Q7r.js","assets/TemporalLayer-E3LAz_Uz.js","assets/TimeInfo-_kTxLSXI.js","assets/FeatureTemplate-XR48cppx.js","assets/FeatureType-DK7YwK9k.js","assets/fieldProperties-2SiMYHIk.js","assets/versionUtils-2QnhVNd1.js","assets/styleUtils-BTQTWLlk.js","assets/popupUtils-Bu-xDbb_.js","assets/AlphaCutoff-UcccL64p.js","assets/interfaces-CL2NbQte.js","assets/ReactiveMap-Ck4RAkaA.js","assets/NetworkElement-BnQTLBgR.js","assets/Association-DD5sDBdb.js","assets/layerViewUtils-BBXHIFLf.js","assets/GoTo-DdMQYxEZ.js","assets/geometryServiceUtils-Bi_tSBBJ.js","assets/project-CqD2rP75.js","assets/webglDeps-Yyfy7E_b.js","assets/BufferObject-C10XeceA.js","assets/Texture-Cpc1Brh2.js","assets/enums-Dk3osxpS.js","assets/Program-BXWc0cMo.js","assets/NestedMap-GuqgquCN.js","assets/ProgramTemplate-Bs4NAWia.js","assets/VertexArrayObject-BSSrT8UZ.js","assets/mapViewDeps-DEeY8dXV.js","assets/signal-BkGLCg2D.js","assets/fontUtils-DBJCNUib.js","assets/FeatureCommandQueue-C6kQ5TL_.js","assets/CIMSymbolHelper-DsETI0lU.js","assets/BidiEngine-QXap_35O.js","assets/GeometryUtils-sE0nA1vV.js","assets/definitions-DyYHcW4a.js","assets/vec2f32-BbH2jxlN.js","assets/Rect-CUzevAry.js","assets/BoundingBox-CnpCxTZE.js","assets/UpdateTracking2D-CEL_EDY4.js","assets/BindType-BmZEZMMh.js","assets/Util-drMM15qw.js","assets/LabelMetric-DevLzUM3.js","assets/VertexElementDescriptor-BLyltQyJ.js","assets/UpdatingHandles-MC_nWkdo.js","assets/mat3-Cmn8Ioet.js","assets/constants-F8oTIn7N.js","assets/WGLContainer-C15jJhOZ.js","assets/vec32-Bu0nRAs3.js","assets/vec3f32-nZdmKIgz.js","assets/Container-CI9eg57p.js","assets/EffectView-D12fXKHN.js","assets/TileKey-B3LvRA-R.js","assets/StyleDefinition-JDq6w8EM.js","assets/config-BOD8--da.js","assets/earcut-D9gy186-.js","assets/featureConversionUtils-DVJefuuB.js","assets/capabilities-DWNhET5Y.js","assets/QueueProcessor-BqJ50uRm.js","assets/SDFHelper-DiNayBIL.js","assets/floatRGBA-CQ_i1nzQ.js","assets/PieChartMeshWriter-aA1L3I_N.js","assets/TurboLine-0Pmbnl9K.js","assets/enums-BRzLM11V.js","assets/GridShader-cvzb-zT3.js","assets/CircularArray-CujHzHWW.js","assets/testSVGPremultipliedAlpha-BnyEKna8.js","assets/AttributeStore-02c5M6Ir.js","assets/timeSupport-9VApAmMI.js","assets/MaterialPrograms-CH82O_Ez.js","assets/renderState-Dxjj3HoI.js","assets/basicInterfaces-CZwQPxTp.js","assets/interfaces-DDtDqZYj.js","assets/doublePrecisionUtils-B0owpBza.js","assets/CIMResourceManager-CQO_76kE.js","assets/imageUtils-dJNaqoVV.js","assets/rasterizingUtils-h2kfKh13.js","assets/utils-ClpgjD1O.js","assets/grouping-B5H8qDZh.js","assets/MeshWriterRegistry-DFothZE7.js","assets/GraphicsView2D-B-TGvij4.js","assets/Tile-Bjmd8vjp.js","assets/quickselect-QQC62dOK.js","assets/normalizeUtilsSync-DZR61Bup.js","assets/GraphicContainer-DYQQdVwL.js","assets/AGraphicContainer-Ie45Fuo6.js","assets/TechniqueInstance-c-8MvxrN.js","assets/TileContainer-DM-mwmR5.js","assets/requestImageUtils-B0p_1I3X.js","assets/geodesicUtils-Bf-JyfVR.js","assets/CollectionFlattener-BlSS9TyQ.js","assets/TileInfo-CTtt-_xX.js","assets/TileKey-DZd6gJy7.js","assets/ColorBackground-BHAvUgL_.js","assets/basemapUtils-OAcqO5VQ.js","assets/TablesMixin-BQXh6KBa.js","assets/ViewingMode-dBUh39ak.js","assets/unitBezier-BX6NeAEr.js","assets/Scheduler-CQ1fP4zd.js","assets/accessibleHandler-DxYX1nkL.js","assets/ZoomViewModel-C46Ee-27.js","assets/TileLayerView2D-B2Vn0xuG.js","assets/imageUtils-DRDGqfKx.js","assets/Bitmap-hPfoo1MJ.js","assets/LayerView-B67XaYwC.js","assets/utils-BQBvadb7.js","assets/HighlightGraphicContainer-DfaSohpB.js","assets/RefreshableLayerView-Bem9wYRC.js","assets/MapServiceLayerViewHelper-CVxe2pR1.js","assets/languageUtils-DVPBvNgQ.js","assets/ImmutableArray-BPVd6ESQ.js","assets/number-DTrZ_kxp.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/drapedUtils-00d6qPdl.js","assets/sublayerUtils-B8eo1d3p.js","assets/popupUtils-SQHX2chg.js","assets/FeatureLayerView2D-mQBL0lWb.js","assets/timeSupport-DSxoE8OX.js","assets/featureReductionUtils-Caulfaw_.js","assets/HighlightCounter-Czi-fdpx.js","assets/BaseDynamicLayerView2D-DZnlfIig.js","assets/BitmapContainer-DxBPDj4y.js","assets/ExportStrategy-CKhzA_tV.js","assets/CatalogLayerView2D-BmVAtB3z.js","assets/CatalogDynamicGroupLayerView2D-DhWT0Klg.js","assets/CatalogFootprintLayerView2D-D0MITJD6.js","assets/GeoRSSLayerView2D-X3qIE9Nq.js","assets/GraphicsLayerView2D-DhiRYUEn.js","assets/GroupLayerView2D-BX4dWQoY.js","assets/ImageryLayerView2D-BbxBNFMi.js","assets/RasterVFDisplayObject-CHHYFQjn.js","assets/dataUtils-BxT6xRGB.js","assets/pixelRangeUtils-Ba7Ehdiw.js","assets/rasterProjectionHelper-Cfy0JJla.js","assets/ImageryTileLayerView2D-C4TRgdH7.js","assets/multidimensionalUtils-vr4hqi-2.js","assets/rasterUtils-CM0cmtoo.js","assets/RawBlockCache-4DTl5WIi.js","assets/KMLLayerView2D-CVWvW9nQ.js","assets/kmlUtils-BWCm5gb-.js","assets/KnowledgeGraphLayerView2D-D4EhxN6S.js","assets/MapImageLayerView2D-JCMHbD6_.js","assets/ExportImageParameters-ymWDdGqE.js","assets/MapNotesLayerView2D-J9hHUeAF.js","assets/MediaLayerView2D-BcsrEy3v.js","assets/perspectiveUtils-CSkYr9Ul.js","assets/mat3f64-q3fE-ZOt.js","assets/OverlayContainer-CGHhaQ92.js","assets/OGCFeatureLayerView2D-B0gPmz9_.js","assets/RouteLayerView2D-BuF2Ujlk.js","assets/StreamLayerView2D-DazF1Urr.js","assets/SubtypeGroupLayerView2D-CrYq_Njl.js","assets/VectorTileLayerView2D-DNZ7UlMc.js","assets/PooledRBush-CfrWYKr4.js","assets/SourceLayerData-Ow6UvO-L.js","assets/StyleRepository-Z__siZQk.js","assets/VideoLayerView2D-BwX84jGI.js","assets/TelemetryDisplay-bQYB5N-_.js","assets/WMSLayerView2D-CeZQXzDC.js","assets/ExportWMSImageParameters-1eiV0RJv.js","assets/WMTSLayerView2D-DhtUOTRB.js","assets/calcite-button-B-P05OnF.js","assets/calcite-icon-DhYIruxM.js"])))=>i.map(i=>d[i]);
import{j as l,m as h,k as y,ao as w,dx as Z,k8 as wt,an as M,ae as D,v as X,s as $,ny as et,au as ee,gq as $o,V,nR as Co,nS as Io,nT as ss,at as ns,dM as Hi,_ as b,I as E,cl as Zi,w as Se,nU as Do,k2 as Ro,ax as jt,nV as Lo,as as Vo,g_ as ei,ar as qt,gH as oe,ay as pn,hC as Oo,x as dn,av as ti,gr as A,b5 as Bt,nW as Ao,nX as Ie,dG as zo,eV as No,d3 as os,nY as Fo,c4 as Ht,fl as as,M as Ho,aY as _e,aq as Kt,eH as Zo,aR as Pi,cP as Go,nZ as gt,q as Wo,ah as Gi,cF as Uo,bV as jo,cG as qo,gj as Si,hg as Bo,hY as Ko,go as mn,dv as gn,al as pt,gb as Yo,g9 as rs,a9 as fn,lK as Xo,n_ as Jo,ap as dt,aX as ft,n$ as ls,ag as ki,p as Qo,o0 as ea,az as _n,O as ta,gp as Wi,nv as ii,o1 as Pe,lE as It,m0 as Ze,hz as ia,nC as sa,o2 as na,b6 as Ee,by as H,o3 as oa,hA as aa,o4 as ra,kG as la,kd as ha,o5 as ca,o6 as ua,o7 as pa,o8 as da,o9 as ma,gn as ga,oa as fa,ob as _a,oc as ya,od as va,fG as yn,lH as bt,du as Q,aM as si,is as B,ir as wa,oe as ba,hR as Ma,of as Ta,k6 as xa,kA as Ui,j5 as ji,og as vn,c3 as wn,oh as hs,oi as Pa,oj as Sa,ok as cs,ol as bn,Y as us,om as ka,lD as Ea,on as $a,lx as Ca,lA as Ia,oo as Da,op as Ra,cJ as La,c6 as Mt,b2 as Va,P as Oa,ih as Aa,oq as ps,d6 as za,bd as qi,bw as Na,le as Fa,J as Ha,f8 as Za,cE as Ga,or as Wa,nB as Ua,df as ja}from"./index-0pHHYqT1.js";import{n as Mn}from"./CollectionFlattener-BlSS9TyQ.js";import{p as qa,z as Ba}from"./TileInfo-CTtt-_xX.js";import{i as ds,b as Tn,t as ms,u as Ka,B as Yt,n as U,e as Xt,r as Bi,w as Ya}from"./jsxFactory-E4nqU-E1.js";import{h as Jt}from"./UpdatingHandles-MC_nWkdo.js";import{r as Xa}from"./signal-BkGLCg2D.js";import{L as Ja,r as ni,m as Qa}from"./ColorBackground-BHAvUgL_.js";import{v as Ki}from"./HeightModelInfo-Dpg9rG1D.js";import{a as oi}from"./TablesMixin-BQXh6KBa.js";import{s as er}from"./ReactiveMap-Ck4RAkaA.js";import{o as xn}from"./a11yUtils-u-4mCwef.js";import{l as gs}from"./ViewingMode-dBUh39ak.js";import{n as tr}from"./mat2df32-orApM5a3.js";import{r as ir,o as sr,M as fs,h as nr,i as or}from"./mat3-Cmn8Ioet.js";import{t as _s}from"./vec2f32-BbH2jxlN.js";import{t as ar,r as rr}from"./unitBezier-BX6NeAEr.js";import{I as lr,a as ai}from"./Scheduler-CQ1fP4zd.js";import{i as hr,n as ys,s as cr,h as ur}from"./Tile-Bjmd8vjp.js";import{e as pr}from"./TileKey-B3LvRA-R.js";import{g as dr}from"./vec32-Bu0nRAs3.js";import{F as mr,K as gr,Q as Tt,a as vs}from"./definitions-DyYHcW4a.js";import{D as fr,I as ri,O as _r}from"./enums-Dk3osxpS.js";import{p as yr,m as vr}from"./Texture-Cpc1Brh2.js";import{s as wr}from"./imageUtils-dJNaqoVV.js";import{t as br}from"./capabilities-DWNhET5Y.js";import{n as Mr}from"./themeUtils-C3zvZbsE.js";import{e as ae}from"./globalCss-IeUjKp3y.js";import{t as Tr}from"./accessibleHandler-DxYX1nkL.js";import{t as xr}from"./GoTo-DdMQYxEZ.js";import Pn from"./ZoomViewModel-C46Ee-27.js";const Dt={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,s=this.values;return e<=i.xsmall?s.xsmall:e<=i.small?s.small:e<=i.medium?s.medium:e<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,s=this.values;return e<=i.xsmall?s.xsmall:e<=i.small?s.small:e<=i.medium?s.medium:e<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],s=e[1],n=this.values;return s>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},li={xsmall:544,small:768,medium:992,large:1200};function Pr(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function hi(t,e){return e?Dt[t].valueToClassName[e].split(" "):[]}const Sr=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=li}initialize(){this.addHandles(w(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Z))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!Pr(i)){const s=JSON.stringify(li,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s),i=li}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=wt.acquire(),s=wt.acquire();let n,o=!1;for(n in Dt){const a=this[n],r=Dt[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==r&&(o=!0,this[n]=r,hi(n,a).forEach(c=>s.push(c)),hi(n,r).forEach(c=>i.push(c)))}o&&(this._applyClassNameChanges(i,s),wt.release(i),wt.release(s))}_applyClassNameChanges(i,s){const n=this.container;n&&(s.forEach(o=>n.classList.remove(o)),i.forEach(o=>n.classList.add(o)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let s;for(s in Dt)hi(s,this[s]).forEach(n=>i.classList.remove(n))}};return l([h()],e.prototype,"breakpoints",null),l([h()],e.prototype,"orientation",void 0),l([h()],e.prototype,"widthBreakpoint",void 0),l([h()],e.prototype,"heightBreakpoint",void 0),e=l([y("esri.views.BreakpointsOwner")],e),e};let we=class extends M{constructor(){super(...arguments),this.items=new D,this._watchUpdatingTracking=new Jt,this._callbacks=new Map,this._projector=ds(),this._hiddenProjector=ds()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const s of i.added){const n=()=>s.render();this._callbacks.set(s,n),this._projector.append(this.surface,n)}for(const s of i.removed){const n=this._projector.detach(this._callbacks.get(s));this.surface.removeChild(n.domNode),this._callbacks.delete(s)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,s=this._hiddenProjector;let n;const o=()=>(n=e.render(),n);s.append(i,o),s.renderNow();const a={left:0,top:0,right:0,bottom:0};if(n!=null&&n.domNode){const r=n.domNode.getBoundingClientRect();a.left=r.left,a.top=r.top,a.right=r.right,a.bottom=r.bottom}for(s.detach(o);i.firstChild;)i.removeChild(i.firstChild);return a}overlaps(e,i){const s=this.computeBoundingRect(e),n=this.computeBoundingRect(i);return Math.max(s.left,n.left)<=Math.min(s.right,n.right)&&Math.max(s.top,n.top)<=Math.min(s.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const s=!!(i!=null&&i.disableDecorations);if(!this.items.some(o=>o.visible&&!(s&&o.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(o=>{s&&o.isDecoration||(n.save(),o.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};l([h({readOnly:!0})],we.prototype,"surface",void 0),l([h({readOnly:!0})],we.prototype,"items",void 0),l([h({readOnly:!0})],we.prototype,"needsRender",null),l([h({readOnly:!0})],we.prototype,"_watchUpdatingTracking",void 0),l([h({readOnly:!0})],we.prototype,"updating",null),we=l([y("esri.views.overlay.ViewOverlay")],we);const ws=we,ci=[0,0];function kr(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return ci[0]=i.left+((e==null?void 0:e.pageXOffset)??0),ci[1]=i.top+((e==null?void 0:e.pageYOffset)??0),ci}function bs(t){t&&(t.textContent="",t.parentNode&&t.parentNode.removeChild(t))}function Er(t){const e=document.createElement("div");return t.appendChild(e),e}const tt=16,xt=750,$r=512,Cr=2,Ir=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:tt,time:xt},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([w(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),w(()=>this.navigating,s=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",s.toString())})])}initialize(){this.addHandles([w(()=>this.ui,(i,s)=>this._handleUIChange(i,s),Z),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=X(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const s=this._get("container"),n=Tn(i);if(n||typeof i!="string"||$.getLogger(this).error("#container",`element with id '${i}' not found`),s===n)return;if(this._stopMeasuring(),s&&(s.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(bs(this.root),this._set("root",null)),this.userContent&&(ms(this.userContent,s),bs(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",ms(n,o),n.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",n.insertBefore(a,n.firstChild),this._set("root",a);const r=document.createElement("div");r.className="esri-view-surface",r.setAttribute("role","application"),r.tabIndex=0,a.appendChild(r),this._set("surface",r);const c=new ws;a.appendChild(c.surface),this._set("overlay",c),this.addHandles(w(()=>c.needsRender,u=>{u&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=et({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=ee(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,s,n){const o=this.position;return i-=o?o[0]:0,s-=o?o[1]:0,n?(n[0]=i,n[1]=s):n=[i,s],n}containerToPage(i,s,n){const o=this.position;return i+=o?o[0]:0,s+=o?o[1]:0,n?(n[0]=i,n[1]=s):n=[i,s],n}_handleUIChange(i,s){this.removeHandles("ui"),s&&s!==i&&s.destroy(),i&&(i.view=this,this.addHandles(w(()=>this.root,n=>{i.container=n?Er(n):null},Z),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=tt,i.time=xt,this.addHandles([$o(window,"resize",()=>{i.freq=tt,i.time=xt}),et({prepare:s=>{const n=this._measure(),o=this._freqInfo;if(o.time+=s.deltaTime,n&&(o.freq=tt,this._get("resizing")||this._set("resizing",!0)),o.time<o.freq)return;o.time=0;const a=this._position();o.freq=a||n?tt:Math.min(xt,o.freq*Cr),!n&&o.freq>=$r&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,s=i?i.clientWidth:0,n=i?i.clientHeight:0;if(s===0||n===0)return this.suspended||this._set("suspended",!0),!1;const o=this.width,a=this.height;return s===o&&n===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",s),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:o,oldHeight:a,width:s,height:n}),!0)}_position(){const i=this.container,s=this.position,n=i&&kr(i);return!!n&&(!s||n[0]!==s[0]||n[1]!==s[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return l([h()],e.prototype,"container",null),l([h({readOnly:!0})],e.prototype,"focused",null),l([h({readOnly:!0})],e.prototype,"height",void 0),l([h()],e.prototype,"messagesCommon",void 0),l([h({type:ws})],e.prototype,"overlay",void 0),l([h({readOnly:!0})],e.prototype,"position",void 0),l([h({readOnly:!0})],e.prototype,"resizing",void 0),l([h({readOnly:!0})],e.prototype,"root",void 0),l([h({value:null,readOnly:!0})],e.prototype,"size",null),l([h({readOnly:!0})],e.prototype,"surface",void 0),l([h({readOnly:!0})],e.prototype,"suspended",void 0),l([h()],e.prototype,"ui",void 0),l([h({readOnly:!0})],e.prototype,"userContent",void 0),l([h({readOnly:!0})],e.prototype,"width",void 0),l([h()],e.prototype,"widthBreakpoint",void 0),e=l([y("esri.views.DOMContainer")],e),e},Dr=V("mac")?"Meta":"Control",Rr=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),Lr=t=>Rr.has(t);let Vr=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const s of this.keyModifiers)if(!i.has(s))return!1;return!0}},L=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const s of i)this._incomingEventMatches.push(s.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,s){let n;typeof i=="function"?(s=i,n=[]):n=i||[];const o=typeof e=="string"?new Vr(e,n):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},r=p=>{const m=this._incoming[p.match.eventType];if(m){const d=m.indexOf(p);m.splice(d,1),a(),this._manager&&this._manager.updateDependencies()}},c=new Or(o,s,{onPause:r,onRemove:r,onResume:p=>{const m=this._incoming[p.match.eventType];m&&!m.includes(p)&&(m.push(p),a(),this._manager&&this._manager.updateDependencies())}});let u=this._incoming[o.eventType];return u||(u=[],this._incoming[o.eventType]=u),u.push(c),a(),this._manager&&this._manager.updateDependencies(),c}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new Ar(e,{onEmit:(s,n,o,a)=>{var r;(r=this._manager)==null||r.emit(s.eventType,n,o,a)},onRemove:s=>{var n;delete this._outgoing[s.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){var s;const i=this._incoming[e.type];if(i){for(const n of i)if(n.match.matches(e)&&((s=n.callback)==null||s.call(n,e),e.shouldStopPropagation()))break}}},Or=class{constructor(e,i,s){this.match=e,this._callback=i,this._handler=s}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Ar=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,s){this._removed||this._handler.onEmit(this,e,i,s)}remove(){this._removed=!0,this._handler.onRemove(this)}},zr=class extends L{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>this._update(i.data))}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:s,y:n}=e;i===this._value&&this._x===s&&this._y===n||(this._value=i,this._x=s,this._y=n,this._onChange(i,s,n))}},Nr=class extends L{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Xa(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Fr=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const s in e){const n=e[s],o=new Co(n,void 0,void 0,2,2);this._properties[s]={pool:o,acquired:[]}}this._afterDispatchHandle=Io(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const s of i.acquired)ss(s)||i.pool.release(s);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),s=this._properties[e];let n=s.pool.acquire();for(s.acquired.push(n);n===i;)s.acquired.push(n),n=s.pool.acquire();return n}_release(){for(const e in this._properties){const i=this._properties[e];let s=0;for(const n of i.acquired)ss(n)?i.acquired[s++]=n:i.pool.release(n);i.acquired.length=s}}},K=class extends M{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Dr,this._latestPointerType="mouse",this._propertiesPool=new Fr({latestPointerLocation:Gr},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,s=ke.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const n={name:e,handlers:i.map(o=>({handler:o,active:!0,removed:!1,priorityIndex:0,groupPriority:s,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let o=n.handlers.length-1;o>=0;o--){const a=n.handlers[o];this._handlers.push(a),a.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(r,c,u,p,m)=>{this._emitInputEvent(a.priorityIndex+1,r,c,u,m,p)},setPointerCapture:(r,c)=>{this._setPointerCapture(n,a,r,c)},setEventCallback:r=>{a.eventCallback=r},setUninstallCallback:r=>{a.uninstallCallback=r},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(s=>{var n;s.removed=!0,(n=s.uninstallCallback)==null||n.call(s)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):$.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let s=this._handlers.length-1;s>=0;s--){const n=this._handlers[s];n.priorityIndex=s,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let s=this._handlersPriority.length-1;s>=0;s--){const n=this._handlersPriority[s];n.priorityIndex=s;let o=n.handler.hasSideEffects;if(!o){for(const a of n.handler.outgoingEventTypes)if(e.has(a)){o=!0;break}}if(o)for(const a of n.handler.incomingEventMatches){e.add(a.eventType);for(const r of a.keyModifiers)Lr(r)||i.add(r)}n.active=o}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,s){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==i||n.y!==s){const o=this._propertiesPool.get("latestPointerLocation");o.x=i,o.y=s,this._set("latestPointerLocation",o)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const o=i;this._pointerCaptures.delete(o.native.pointerId)}this._updateKeyModifiers(e,i);const s=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,n=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,s,n)}_updateKeyModifiers(e,i){if(!i)return;let s=!1;const n=()=>{s||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),s=!0)},o=(r,c)=>{c&&!this._activeKeyModifiers.has(r)?(n(),this._activeKeyModifiers.add(r)):!c&&this._activeKeyModifiers.has(r)&&(n(),this._activeKeyModifiers.delete(r))};if(e==="key-down"||e==="key-up"){const r=i.key;this._keyModifiers.has(r)&&o(r,e==="key-down")}const a=i.native;o("Alt",!!(a!=null&&a.altKey)),o("Control",!!(a!=null&&a.ctrlKey)),o("Ctrl",!!(a!=null&&a.ctrlKey)),o("Shift",!!(a!=null&&a.shiftKey)),o("Meta",!!(a!=null&&a.metaKey)),o("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new zr((e,i,s)=>this._setLatestPointer(e,i,s)),this._multiTouchHandler=new Nr,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],ke.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,ke.INTERNAL)}_setPointerCapture(e,i,s,n){const o=e.name+"-"+i.priorityIndex,a=this._pointerCaptures.get(s.pointerId)||new Set;this._pointerCaptures.set(s.pointerId,a),n?(a.add(o),a.size===1&&this.eventSource&&this.eventSource.setPointerCapture(s,!0)):a.has(o)&&(a.delete(o),a.size===0&&(this._pointerCaptures.delete(s.pointerId),this.eventSource&&this.eventSource.setPointerCapture(s,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,s,n){this._emitInputEvent(0,e,i,s,n)}_emitInputEvent(e,i,s,n,o,a){const r=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),c=o!==void 0&&o,u={event:new Hr(i,s,r,a||this._activeKeyModifiers,c),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(u):this._doNewPropagation(u)}_doNewPropagation(e){this._currentPropagation={events:new ns,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,s,n;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:o,priorityIndex:a}=e.events.pop(),r=(i=o.data)==null?void 0:i.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[a];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!o.shouldStopPropagation()&&((n=(s=e.currentHandler).eventCallback)==null||n.call(s,o)),o.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(o.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:o,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new ns;i.push(e);const s=this._currentPropagation;if(s){for(;s.events.length;)i.push(s.events.pop());s.events=i,s.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const s of e.handler.incomingEventMatches)for(const n of i.handler.incomingEventMatches){if(s.eventType!==n.eventType)continue;const o=s.keyModifiers.filter(a=>n.keyModifiers.includes(a));if(o.length===s.keyModifiers.length!=(o.length===n.keyModifiers.length))return s.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const s of e){let n=0;for(;n<i.length&&this._compareHandlerPriority(s,i[n])>=0;)n++;i.splice(n,0,s)}return i}get debug(){const e=i=>{const s=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=s};return{injectEvent:(i,s)=>{e(()=>this._onEventReceived(i,s))},disablePointerCapture:e}}};l([h({readOnly:!0})],K.prototype,"hasPendingInputs",null),l([h({constructOnly:!0})],K.prototype,"eventSource",void 0),l([h({constructOnly:!0})],K.prototype,"recognizers",void 0),l([h()],K.prototype,"_latestPointerType",void 0),l([h()],K.prototype,"latestPointerType",null),l([h()],K.prototype,"multiTouchActive",null),l([h({readOnly:!0})],K.prototype,"latestPointerLocation",void 0),l([h()],K.prototype,"_paused",void 0),l([h({readOnly:!0})],K.prototype,"updating",null),K=l([y("esri.views.input.InputManager")],K);let Hr=class{constructor(e,i,s,n,o){this.type=e,this.data=i,this.timestamp=s,this.modifiers=n,this.cancelable=o,this._propagationState=xe.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=xe.STOPPED}shouldStopPropagation(){return!!(this._propagationState&xe.STOPPED)}async(e){this._propagationState|=xe.PAUSED;const i=(s,n)=>{this._propagationState&=~xe.PAUSED;const o=this._resumeCallback;if(this._resumeCallback=null,o&&o(),n)throw s;return s};return(typeof e=="function"?e():e).then(s=>i(s,!1),s=>i(s,!0))}shouldPausePropagation(e){return!!(this._propagationState&xe.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var xe;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(xe||(xe={}));const ke={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Zr=class{};const Gr=Zr;function ve(t){return t!=null&&"open"in t&&"declaredClass"in t}function Ms(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const Wr=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([w(()=>[this.ui,this.popup],([i,s],n)=>{const o="popup",a="manual";if(n){const[r,c]=n;r&&ve(c)&&(c.view=null,Ms(c)&&r.remove(c,o))}i&&ve(s)&&(s.view=this,Ms(s)&&i.add(s,{key:o,position:a,internal:!0}))},Z),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(ve(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),ve(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},ke.WIDGET)]),Hi(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{b(()=>import("./Popup-BOUubKuz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(ve(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void $.getLogger(this).error(new E("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),ve(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,s){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,s),s)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!ve(this.popup))return this._popupSetupTask=Zi(async s=>{const{default:n}=await b(()=>import("./Popup-BOUubKuz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64]));if(Se(s),!this.popup||ve(this.popup))return;const o=this.popup;delete o.open,delete o.close,this.popup=new n(o)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:s},n){const o=[],a=[];let r=!1;const c=Do(n,V("popup-view-fetch-timeout")??jr),u=d=>{const g=new Ur(d);return a.push(g),o.push(g.promise),g},p=d=>{const g=a.at(-1);return g&&g.layerView===d&&!r?g:u(d)};for(const d of s)"graphic"in d?(p(d.layerView).graphics.push(d.graphic),r=!1):(o.push(d.layerView.fetchPopupFeaturesAtLocation(d.mapPoint,c)),r=!0);a.map(d=>d.resolve(c));const m=Ro(o).then(d=>d.filter(g=>!!g).flat());return{pendingFeatures:o,allGraphicsPromise:m,location:i}}async _getPopupHits(i,s){const{hits:n,location:o}=await this.popupHitTest(i);Se(s);const a=[];for(const r of n)if("graphic"in r){if(this._isValidPopupGraphic(r.graphic,s)){const c=this._isValidPopupGraphicsLayerView(r.layerView)?r.layerView:void 0;a.push({graphic:r.graphic,layerView:c})}}else this._isValidPopupLocationLayerView(r.layerView)&&a.push({mapPoint:r.mapPoint,layerView:r.layerView});return{hits:a,location:o}}_isValidPopupGraphic(i,s){return i&&!!i.getEffectivePopupTemplate(s==null?void 0:s.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return l([h()],e.prototype,"popup",void 0),l([h()],e.prototype,"popupEnabled",void 0),e=l([y("esri.views.PopupView")],e),e};let Ur=class{constructor(e){this.layerView=e,this._resolver=jt(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:s,_resolver:n}=this;if(!i)return n.resolve(s),n.promise;let o;return i.fetchPopupFeaturesFromGraphics(s,e).catch(a=>(o=a,null)).then(a=>{a?n.resolve(a):n.reject(o)}),n.promise}};const jr=5e3;let Zt=class extends Lo{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&($.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Zt=l([y("esri.support.AnalysesCollection")],Zt);let be=class extends M{constructor(e){super(e),this.view=null,this.baseLayerViews=new D,this.referenceLayerViews=new D,this._loadingHandle=w(()=>{var i,s;return(s=(i=this.view)==null?void 0:i.map)==null?void 0:s.basemap},i=>{i&&i.load().catch(()=>{})},Z)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,s,n;if((i=this.view)!=null&&i.suspended)return!1;const e=(n=(s=this.view)==null?void 0:s.map)==null?void 0:n.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(o=>o.updating)||this.referenceLayerViews.some(o=>o.updating))}};l([h({constructOnly:!0})],be.prototype,"view",void 0),l([h({readOnly:!0})],be.prototype,"baseLayerViews",void 0),l([h({readOnly:!0})],be.prototype,"referenceLayerViews",void 0),l([h({readOnly:!0})],be.prototype,"suspended",null),l([h({type:Boolean,readOnly:!0})],be.prototype,"updating",null),be=l([y("esri.views.BasemapView")],be);const qr=be;function Br(t){return"tryRecycleWith"in t}function Kr(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let Yr=class{constructor(e,i,s){this.layer=e,this.view=i,this.layerViewImporter=s,this._controller=new AbortController,this._deferred=jt(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,ti(this._controller.signal,()=>{const n=new E("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!Br(this.layerView))return null;const i=this.layer.type,s=this._controller.signal;for(let n=0;n<e.length;n++){const o=e[n];if(o.type!==i)continue;const a=this.layerView.tryRecycleWith(o,{signal:s});if(a){e.splice(n,1),this.layer=o;const r=this.layerView,c=r.view;return this.promise=Promise.race([a.then(()=>(Se(this._controller.signal),o.emit("layerview-destroy",{view:c,layerView:r}),c.emit("layerview-destroy",{view:c,layerView:r}),o.emit("layerview-create",{view:c,layerView:r}),c.emit("layerview-create",{view:c,layerView:r}),r)),new Promise((u,p)=>ti(this._controller.signal,()=>p(pn())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:s}=this;i.emit("layerview-destroy",{view:s,layerView:e}),s.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var n,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:s}=this;this._map=s.map;try{let a,r;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),Jr(i))a=await i.createLayerView(s,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new E("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(i);Se(e),a="default"in p?new p.default({layer:i,view:s}):new p({layer:i,view:s})}const c=()=>{r=ee(r),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};r=ti(e,c),Se(e);try{await a.when()}catch(p){throw c(),p}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(i)))return c(),void this._deferred.reject(new E("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:s,layerView:a}),s.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:s,error:a}),s.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new E("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}},Y=class extends M{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Jt,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var s;const i=(s=this.view.map)==null?void 0:s.allLayers;if(i)for(const n of i)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=jt(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(Vo(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var c,u,p;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const s=new Set,n=[],o=this.view.ready,a=m=>{if(m!=null){for(const d of m)if(d){s.add(d);const g=this._layerLayerViewInfoMap.get(d);g&&o?g.start():g||this._recyclingInfoMap.has(d)||n.push(d),"layers"in d&&d.layers&&a(d.layers)}}};for(const m of this._rootCollectionNames)a(ei(this,m));for(const[m,d]of this._layerLayerViewInfoMap)if(!s.has(m)){this._layerLayerViewInfoMap.delete(d.layer);const g=d.tryRecycle(n);g?(this.notifyChange("updating"),this._recyclingInfoMap.set(d.layer,d),g.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(d.layer),this._layerLayerViewInfoMap.set(d.layer,d),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(d.layer),d.destroy(),this._reschedule()})):d.destroy()}for(const[m,d]of this._recyclingInfoMap)s.has(m)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(d.layer),d.destroy());for(const m of n)this._createLayerView(m);this._refreshCollections();const r=[(c=i==null?void 0:i.ground)==null?void 0:c.layers,(u=i==null?void 0:i.basemap)==null?void 0:u.baseLayers,(p=i==null?void 0:i.basemap)==null?void 0:p.referenceLayers,i==null?void 0:i.layers].filter(m=>!!m);s.forEach(m=>"layers"in m&&r.push(m.layers)),this.addHandles(r.map(m=>this._watchUpdatingTracking.addOnCollectionChange(()=>m,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([qt(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),w(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),oe)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),oi(this._recyclingInfoMap),oi(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(pn()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Oo(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(oi(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new E("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){var o;this.commitProperty("updatingRemaining");const s=this._layerLayerViewInfoMap.get(e);if(!(s!=null&&s.done))return!0;const n=s.layerView;return!(!n||!i||n.parent===i)||!!(s.done&&n&&"layers"in e&&((o=e.layers)!=null&&o.length))&&e.layers.some(a=>this.isCreatingLayerViewsForLayer(a,n))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(ei(this,e),ei(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,s){if(!e||!i)return void(i&&i.removeAll());let n=0;for(const o of e){const a=this._layerLayerViewInfoMap.get(o);if(!(a!=null&&a.layerView))continue;const r=a.layerView;r.layer=o,r.parent=s,i.at(n)!==r&&i.splice(n,0,r),"layers"in o&&Kr(r)&&this._populateLayerViewsOwners(o.layers,r.layerViews,r),n+=1}n<i.length&&i.splice(n,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new Yr(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),s=>{s&&(dn(s)||s.name==="cancelled:layerview-create")||$.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:s}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};l([h()],Y.prototype,"_workPromise",void 0),l([h({readOnly:!0})],Y.prototype,"_watchUpdatingTracking",void 0),l([h({readOnly:!0})],Y.prototype,"_layersToLayerViews",null),l([h({readOnly:!0})],Y.prototype,"_rootCollectionNames",null),l([h()],Y.prototype,"layerViewImporter",void 0),l([h()],Y.prototype,"supportsGround",void 0),l([h({readOnly:!0})],Y.prototype,"updating",null),l([h({readOnly:!0})],Y.prototype,"updatingRemaining",null),l([h({constructOnly:!0})],Y.prototype,"view",void 0),Y=l([y("esri.views.LayerViewManager")],Y);const Xr=Y;function Jr(t){return"createLayerView"in t&&t.createLayerView!=null}let q=class extends M{constructor(e){super(e),this.factor=1.5,this.offset=A(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};l([h({type:Number})],q.prototype,"factor",void 0),l([h({nonNullable:!0})],q.prototype,"offset",void 0),l([h()],q.prototype,"position",void 0),l([h({type:Number,range:{min:0}})],q.prototype,"size",void 0),l([h()],q.prototype,"maskUrl",void 0),l([h()],q.prototype,"maskEnabled",void 0),l([h()],q.prototype,"overlayUrl",void 0),l([h()],q.prototype,"overlayEnabled",void 0),l([h({readOnly:!0})],q.prototype,"version",null),l([h({type:Boolean})],q.prototype,"visible",void 0),q=l([y("esri.views.Magnifier")],q);const Sn=q;function Pt(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let ue=class extends Bt.EventedAccessor{constructor(e){super(e),this._selectionMap=new er,this._sources=new D,this._trashCan=[],this._layerEditHandles=new D,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([w(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),qt(()=>this.sources,"change",i=>{const s=this._selectionMap;for(const n of i.removed)s.delete(n);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new D;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(Pt(i)&&!Ao(i)||Ie(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(ee)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,s]=e;return{layer:i,selection:[...s.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){zo(e,this._sources)}async getSelectedFeatures(e,i={},s="layerView"){const{view:n,selections:o}=this,a=(e!==void 0?o.filter(r=>e.includes(r.layer)):o).filter(r=>r.selection.length>0).map(async r=>{const{layer:c,selection:u}=r,p=Ie(c)?c.parent:c;if(p==null||!xs(p))return null;if(s==="layer")return Ps(p,u,i);if(Ts(p))return null;const m=await n.whenLayerView(p).catch(()=>null);return m?Ps(m,u,i):null});return(await Promise.all(a)).filter(r=>r!=null)}updateSelection(e){const i=new Map;for(const[o,a]of this._selectionMap)i.set(o,[...a.selection]);let s=!1;const n=e.current.concat(e.added);for(const o of n){const a=o.sourceLayer,r=o.getObjectId();if(this.sources.includes(a)&&(Pt(a)||Ie(a))&&r!==null){const c=No(i,a,()=>[]);c.includes(r)||(c.push(r),s=!0)}}for(const o of e.removed){const a=o.sourceLayer,r=o.getObjectId();if(this.sources.includes(a)&&(Pt(a)||Ie(a))&&r!==null){const c=i.get(a),u=c==null?void 0:c.indexOf(r);u!==void 0&&u>=0&&(c==null||c.splice(u,1),s=!0)}}if(s){const{_selectionMap:o,_trashCan:a}=this,r=[];for(const[c,u]of i){const p=o.get(c);p!==void 0&&a.push(p),o.set(c,{selection:u}),r.push({layer:c,selection:u,...os(p!==void 0?p.selection:[],u)})}this._onSelectionChange(r)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){const i=this._selectionMap.get(e);return i==null?void 0:i.selection}appendToSelection(e,i){const s=this._selectionMap.get(e),n=s!==void 0?[...s.selection]:[];for(const o of i)n.includes(o)||n.push(o);this._setSelection(e,n)}removeFromSelection(e,i){const s=this._selectionMap.get(e);if(!s)return;const n=[];for(const o of s.selection)i.includes(o)||n.push(o);this._setSelection(e,n)}toggleInSelection(e,i){const s=this._selectionMap.get(e);if(!s||s.selection.length===0)return void this._setSelection(e,i);const n=new Set(s.selection),o=new Set(i),a=Fo(n,o);this._setSelection(e,Array.from(a))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[s,n]of this._selectionMap.entries())i.push({layer:s,added:[],removed:[...n.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var a;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const r=this._trashCan.pop();(a=r==null?void 0:r.highlightHandle)==null||a.remove()}const{sources:e,view:i,_selectionMap:s,showHighlight:n}=this,o=this._vizTaskId;for(const r of e){const c=s.get(r),u=Ie(r)?r.parent:r;if(u!=null&&xs(u)){if(Ts(u))continue;i.whenLayerView(u).then(p=>{var m;(m=c==null?void 0:c.highlightHandle)==null||m.remove(),c!=null&&n&&o===this._vizTaskId&&"highlight"in p&&typeof p.highlight=="function"&&c.selection.length>0&&(c.highlightHandle=p.highlight(c.selection,"selection"))}).catch(()=>{var p;(p=c==null?void 0:c.highlightHandle)==null||p.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(ee);for(const e of this.sources){const i=Ie(e)?e.parent:e;if(i!=null&&Pt(i)){const s=i.on("edits",n=>{this._handleEditChanges(n,e)});this._layerEditHandles.push(s)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const s=e.deletedFeatures.filter(n=>n.error==null).map(n=>n.objectId).filter(Ht);this.removeFromSelection(i,s)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const s=this._selectionMap.get(e);if(s===void 0||!el(s,{selection:i})){s!==void 0&&this._trashCan.push(s),this._selectionMap.set(e,{selection:[...i]});const n={layer:e,selection:[...i],...os(s!==void 0?s.selection:[],i)};this._onSelectionChange([n])}}};l([h({readOnly:!0,nonNullable:!0})],ue.prototype,"selections",null),l([h({readOnly:!0,nonNullable:!0})],ue.prototype,"count",null),l([h({constructOnly:!0,nonNullable:!0})],ue.prototype,"view",void 0),l([h({readOnly:!0,nonNullable:!0})],ue.prototype,"hasSelection",null),l([h()],ue.prototype,"showHighlight",void 0),l([h()],ue.prototype,"sources",null),ue=l([y("esri.views.SelectionManager")],ue);const Ts=t=>{var e;return Ie(t)?((e=t.parent)==null?void 0:e.isTable)===!0:t.isTable},Qr=t=>t.layer!==void 0,xs=t=>(t==null?void 0:t.when)!==void 0,el=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],s=[...e.selection];if(i.length!==s.length)return!1;i.sort(),s.sort();for(let n=0;n<i.length;n++)if(i[n]!==s[n])return!1}return!0},Ps=async(t,e,i={})=>{let s;if(Qr(t)){const n=t;s=n===void 0?null:await n.queryFeatures(new as({...i,objectIds:e})).then(o=>({data:o,layer:t.layer}))}else{const n=t;s=n===void 0?null:await n.queryFeatures(new as({...i,objectIds:e})).then(o=>({data:o,layer:n}))}return s},tl=ue;let at=class extends Ho(M){constructor(e){super(e),this.accentColor=new _e([255,127,0]),this.textColor=new _e([255,255,255])}};l([h({type:_e,nonNullable:!0})],at.prototype,"accentColor",void 0),l([h({type:_e,nonNullable:!0})],at.prototype,"textColor",void 0),at=l([y("esri.views.Theme")],at);const Ei=at;var Ss;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Ss||(Ss={}));const kn=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],En={};function $n(t){return!!En[t]}function il(t){for(const e of t)if(!$n(e))return!1;return!0}kn.forEach(t=>{En[t]=!0});let sl=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:s},n)=>{var o;return(o=this.inputManager)==null?void 0:o.installHandlers(n,[i],s)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var s;return(s=this.inputManager)==null?void 0:s.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,s,n){const o=Array.isArray(e)?e:e.split(",");if(!il(o))return o.some($n)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,r;Array.isArray(i)?r=i:(a=i,r=[]),typeof s=="function"?a=s:n=s,n=n??ke.DEFAULT;const c=this._createUniqueGroupName(),u=new nl(this.view,o,r,a);this._handlers.set(c,{handler:u,priority:n});for(const p of o){const m=this._handlerCounts.get(p)||0;this._handlerCounts.set(p,m+1)}return this.inputManager&&this.inputManager.installHandlers(c,[u],n),Kt(()=>this._removeHandler(c,o))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const s of i){const n=this._handlerCounts.get(s);n===void 0||(n===1?this._handlerCounts.delete(s):this._handlerCounts.set(s,n-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},nl=class extends L{constructor(e,i,s,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const o of i)switch(o){case"click":this.registerIncoming("click",s,a=>n(rl(e,a)));break;case"double-click":this.registerIncoming("double-click",s,a=>n(ll(e,a)));break;case"immediate-click":this.registerIncoming("immediate-click",s,a=>n(hl(e,a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",s,a=>n(cl(e,a)));break;case"hold":this.registerIncoming("hold",s,a=>n(ul(e,a)));break;case"drag":this.registerIncoming("drag",s,a=>{const r=this._wrapDrag(a);r&&n(r)});break;case"key-down":this.registerIncoming("key-down",s,a=>n(pl(a)));break;case"key-up":this.registerIncoming("key-up",s,a=>n(dl(a)));break;case"pointer-down":this.registerIncoming("pointer-down",s,a=>n(it(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",s,a=>n(it(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",s,a=>n(it(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",s,a=>n(ml(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",s,a=>n(gl(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",s,a=>n(it(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",s,a=>n(it(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",s,a=>{n(fl(a))});break;case"focus":this.registerIncoming("focus",s,a=>{n(ol(a))});break;case"blur":this.registerIncoming("blur",s,a=>{n(al(a))})}}_wrapDrag(e){const i=e.data,{x:s,y:n}=i.center,{action:o,pointerType:a,button:r}=i;if(o==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const c=i.pointer.native,u=i.buttons,{cancelable:p,timestamp:m}=e,d={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return o==="end"&&(this._latestDragStart=void 0),{type:"drag",action:o,x:s,y:n,origin:d,pointerType:a,button:r,buttons:u,radius:i.radius,angle:Zo(i.angle),native:c,timestamp:m,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}};function ol(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function al(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function rl(t,e){const{pointerType:i,button:s,buttons:n,x:o,y:a,native:r,eventId:c}=e.data,{cancelable:u,timestamp:p}=e;return{type:"click",pointerType:i,button:s,buttons:n,x:o,y:a,native:r,timestamp:p,screenPoint:A(o,a),mapPoint:_t(t,o,a),eventId:c,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function ll(t,e){const{pointerType:i,button:s,buttons:n,x:o,y:a,native:r,eventId:c}=e.data,{cancelable:u,timestamp:p}=e;return{type:"double-click",pointerType:i,button:s,buttons:n,x:o,y:a,native:r,timestamp:p,mapPoint:_t(t,o,a),eventId:c,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}function hl(t,e){const{pointerType:i,button:s,buttons:n,x:o,y:a,native:r,eventId:c}=e.data,u=r.pointerId,{cancelable:p,timestamp:m}=e;return{type:"immediate-click",pointerId:u,pointerType:i,button:s,buttons:n,x:o,y:a,native:r,timestamp:m,mapPoint:_t(t,o,a),eventId:c,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function cl(t,e){const{pointerType:i,button:s,buttons:n,x:o,y:a,native:r,eventId:c}=e.data,u=r.pointerId,{cancelable:p,timestamp:m}=e;return{type:"immediate-double-click",pointerId:u,pointerType:i,button:s,buttons:n,x:o,y:a,native:r,timestamp:m,mapPoint:_t(t,o,a),eventId:c,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function ul(t,e){const{pointerType:i,button:s,buttons:n,x:o,y:a,native:r}=e.data,{cancelable:c,timestamp:u}=e;return{type:"hold",pointerType:i,button:s,buttons:n,x:o,y:a,native:r,timestamp:u,mapPoint:_t(t,o,a),cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}function _t(t,e,i){return t.toMap(A(e,i),{exclude:[]})}function pl(t){const{key:e,repeat:i,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:e,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}function dl(t){const{key:e,native:i}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:e,native:i,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function it(t,e){const{x:i,y:s,button:n,buttons:o,native:a,eventId:r}=t.data,c=a.pointerId,u=a.pointerType,{cancelable:p,timestamp:m}=t;return{type:e,x:i,y:s,pointerId:c,pointerType:u,button:n,buttons:o,native:a,timestamp:m,eventId:r,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:d=>t.async(d),preventDefault:()=>t.preventDefault()}}function ml(t){const{x:e,y:i,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,r=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,u=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:m,timestamp:d}=t;return{type:"pointer-drag",x:e,y:i,pointerId:r,pointerType:c,button:a,buttons:s,action:u,origin:p,native:n,timestamp:d,eventId:o,cancelable:m,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}function gl(t){const{cancelable:e,data:i,timestamp:s}=t,{x:n,y:o,deltaY:a,native:r}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:r,timestamp:s,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}function fl(t){const{action:e,state:i,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:r}=i;return{type:"gamepad",device:s,timestamp:o,action:e,buttons:a,axes:r,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}var mt,ks,Es;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(mt||(mt={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(ks||(ks={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Es||(Es={}));function _l(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return $.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function $i(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(mt.USER)&&t.getEditableFlag(mt.MANAGER)}function ie(t){return A(t.x,t.y)}function Cn(t,e){var s;const i=(s=t instanceof HTMLElement?t:t.surface)==null?void 0:s.getBoundingClientRect();return i?A(e.clientX-i.left,e.clientY-i.top):A(0,0)}function In(t,e){return e instanceof Event?Cn(t,e):ie(e)}function Dn(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let yl=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const s=()=>e.stopPropagation();switch(e.type){case"pointer-move":Cs(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(s(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Is(e))break;const n=ie(e),o=Ge(n,e.pointerType,i.forEachTool);if(o==null)break;const a=o.manipulator,r=o.tool;a==null||r==null||!a.interactive||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._releaseManipulatorBeforeDragging(a,e,i),a!=null&&r!=null&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:r,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(o.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),s());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Is(e))break;const n=this._grabbedManipulators.get(e.pointerId),o=n==null?void 0:n.manipulator,a=n==null?void 0:n.tool;if(o==null||a==null)break;const r=ie(e);r.x=Pi(r.x,0,i.view.width),r.y=Pi(r.y,0,i.view.height);const c=n.start,u=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(o.dragging=!0,u?o.events.emit("drag",{action:"update",start:c,screenPoint:r}):o.events.emit("drag",{action:"start",start:c,screenPoint:r,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:o,start:c}));break;case"end":o.dragging=!1,u&&o.events.emit("drag",{action:"end",start:c,screenPoint:r}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}s();break}case"immediate-click":{const n=ie(e),o=Ge(n,e.pointerType,i.forEachTool);if(vl(e)||i.forEachTool(u=>{if((o==null||o.tool!==u||u.automaticManipulatorSelection)&&u.manipulators){let p=!1;u.manipulators.forEach(({manipulator:m})=>{m.selected&&(m.selected=!1,p=!0)}),p&&u.onManipulatorSelectionChanged&&u.onManipulatorSelectionChanged()}}),o==null)break;const{manipulator:a,tool:r}=o;if(!a.interactive)break;a.selectable&&r.automaticManipulatorSelection&&(a.selected=!a.selected,r.onManipulatorSelectionChanged&&r.onManipulatorSelectionChanged());const c=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:c,stopPropagation:s}),ui(a,s);break}case"click":{const n=ie(e),o=Ge(n,e.pointerType,i.forEachTool),a=o==null?void 0:o.manipulator;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:r}),s();break}case"double-click":{const n=ie(e),o=Ge(n,e.pointerType,i.forEachTool),a=o!=null?o.manipulator:null;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:r,stopPropagation:s}),ui(a,s);break}case"immediate-double-click":{const n=ie(e),o=Ge(n,e.pointerType,i.forEachTool),a=o!=null?o.manipulator:null;if(a==null||!a.interactive)break;const r=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:r,stopPropagation:s}),e.pointerType==="mouse"&&ui(a,s);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,s){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:ie(i)}),this._grabbedManipulators.forEach(({manipulator:n},o)=>{n===e&&this._grabbedManipulators.delete(o)}),this._afterManipulatorRelease(s.setActiveTool)}_handlePointerEnd(e,i){var n;const s=(n=this._grabbedManipulators.get(e.pointerId))==null?void 0:n.manipulator;s!=null&&s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:ie(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=$s(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=$s(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,s=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{s.add(n)}),e(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=s.has(n);const o=this._grabbedManipulators.values(),a=Go(o,({tool:r})=>r===n);n.firstGrabbedManipulator=a!=null?a.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:s},n=!0,o){const a=(r,c)=>r===e&&(o==null||o===c);this._grabbedManipulators.forEach(({tool:r,manipulator:c,pointerType:u},p)=>{a(r,c)&&(this._grabbedManipulators.delete(p),c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:u}))}),this._draggedManipulators.forEach(({tool:r,manipulator:c},u)=>{a(r,c)&&(this._draggedManipulators.delete(u),c.dragging=!1,c.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:r,manipulator:c},u)=>{a(r,c)&&(this._hoveredManipulators.delete(u),c.hovering=!1)}),this._afterManipulatorRelease(s),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,s)=>{this._updateHoveredStateForPointerAtScreenPosition(A(i.x,i.y),s,i.pointerType,e)})}handleHoverEvent(e,i){const s=e.type;s!=="pointer-up"&&s!=="immediate-click"&&s!=="pointer-move"||!Cs(e.pointerType)||(s!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(ie(e),e.pointerId,e.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(e,i,s,n){var r;let o=Ge(e,s,n);const a=(r=this._hoveredManipulators.get(i))==null?void 0:r.manipulator;o==null||o.manipulator.interactive||(o=null),o!=null&&a===o.manipulator||(a!=null&&(a.hovering=!1),o!=null?(o.manipulator.hovering=!0,this._hoveredManipulators.set(i,o)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:i},s)=>{e===s&&(this._hoveredManipulators.delete(e),i.hovering=!1)})}};function $s(t){for(const{manipulator:e}of t.values())if(e!=null&&e.interactive){if(e.grabbing&&e.grabCursor)return e.grabCursor;if(e.cursor)return e.cursor}return null}function Ge(t,e,i){let s=null;return i(n=>{if(n.manipulators==null||!$i(n))return!1;const o=n.manipulators.intersect(t,e);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}function Cs(t){return t==="mouse"}function Is(t){return t.pointerType!=="mouse"||t.button===0}function vl(t){return!!t.native.shiftKey}function ui(t,e){t!=null&&t.consumesClicks&&e()}const Ds="attached",pi="tools",wl=1e3;let se=class extends M{constructor(e){super(e),this._updatingHandles=new Jt,this._clock=gt,this._manipulatorState=new yl,this.tools=new D,this.cursor=null,this._interacting=!1,this._interactingTimeout=wl,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const s of this.tools.items)if(i(s))return}}initialize(){this.addHandles([this.view.on(kn,e=>{this._handleInputEvent(e)},ke.TOOL),..._l(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void $.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const s of this.tools){this._updateToolEditableFlag(s);const n=$i(s);this.activeTool!=null&&n||this._manipulatorState.clearPointers(s,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=ee(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([w(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(s=>s.onElevationChange(i)))],Ds):this.addHandles(w(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Ds),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:s})=>e(s,i))})}_handleInputEvent(e){let i=!1;const s={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(s):this._forEachTool(n=>{!i&&n.visible&&n.handleInputEvent(s)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(s,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(s),this._manipulatorState.handleHoverEvent(s,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(pi),this._forEachTool(e=>{if(e instanceof M){const i=w(()=>[e.cursor,e.visible,e.editable],()=>{$i(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,pi)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],pi)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,mt.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};l([h({constructOnly:!0,nonNullable:!0})],se.prototype,"view",void 0),l([h({value:null})],se.prototype,"activeTool",null),l([h({readOnly:!0,type:D})],se.prototype,"tools",void 0),l([h({readOnly:!0})],se.prototype,"cursor",void 0),l([h({readOnly:!0})],se.prototype,"updating",null),l([h()],se.prototype,"_interacting",void 0),l([h({readOnly:!0})],se.prototype,"interacting",null),se=l([y("esri.views.ToolViewManager")],se);let qe=class extends M{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":bl.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Ml[this.deviceType]}};l([h({nonNullable:!0,readOnly:!0})],qe.prototype,"nativeIndex",void 0),l([h({type:String,readOnly:!0})],qe.prototype,"deviceType",null),l([h({type:Number,readOnly:!0})],qe.prototype,"axisThreshold",null),qe=l([y("esri.views.input.gamepad.GamepadInputDevice")],qe);const Yi=qe,bl=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Ml={standard:.15,spacemouse:.025,unknown:0};let rt=class extends M{constructor(...e){super(...e),this.devices=new D,this.enabledFocusMode="document"}};l([h({type:D.ofType(Yi),readOnly:!0})],rt.prototype,"devices",void 0),l([h({type:["document","view","none"]})],rt.prototype,"enabledFocusMode",void 0),rt=l([y("esri.views.input.gamepad.GamepadSettings")],rt);const Tl=rt;let Rt=class extends M{constructor(){super(...arguments),this.gamepad=new Tl}};l([h({readOnly:!0})],Rt.prototype,"gamepad",void 0),Rt=l([y("esri.views.input.Input")],Rt);const xl=Rt;let Me=class extends M{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};l([h({type:Boolean,nonNullable:!0})],Me.prototype,"enabled",void 0),l([h({type:Yi})],Me.prototype,"device",void 0),l([h({type:["pan","zoom"],nonNullable:!0})],Me.prototype,"mode",void 0),l([h({type:["forward-down","forward-up"],nonNullable:!0})],Me.prototype,"tiltDirection",void 0),l([h({type:Number,nonNullable:!0})],Me.prototype,"velocityFactor",void 0),Me=l([y("esri.views.navigation.gamepad.GamepadSettings")],Me);const Rn=Me;let De=class extends M{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Rn,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!xn()}};l([h({type:Boolean})],De.prototype,"browserTouchPanEnabled",void 0),l([h({type:Rn,nonNullable:!0})],De.prototype,"gamepad",void 0),l([h({type:Boolean})],De.prototype,"momentumEnabled",void 0),l([h({type:Boolean})],De.prototype,"mouseWheelZoomEnabled",void 0),De=l([y("esri.views.navigation.Navigation")],De);const Ln=De;var Rs;function Pl(t){var s;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?Wo(t.url):void 0;return!(((s=t.spatialReference)==null?void 0:s.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&Vn(t)&&t.heightModelInfo?t.heightModelInfo:Sl(t)?Ki.deriveUnitFromSR(El,t.spatialReference):null}function Vn(t){return"heightModelInfo"in t}function On(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Sl(t){return On(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):An(t)}function kl(t){return t.layers!=null||An(t)||On(t)||Vn(t)}function An(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"focusArea":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Rs||(Rs={}));const El=new Ki({heightModel:"gravity-related-height"});let Ci,di=null;async function $l(t){di||(di=b(()=>import("./geometryServiceUtils-Bi_tSBBJ.js"),__vite__mapDeps([65,1,2,66])).then(e=>Ci=e)),await di,Se(t)}async function zn(t,e,i,s){if(!t)return null;const n=t.spatialReference;return Uo()||jo(n,e)?Gi(t,e):Ci?Ci.projectGeometry(t,e,i,s):(await Promise.race([$l(s),qo(s)]),zn(t,e,i,s))}let x=class extends M{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Si(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var s,n,o,a;const e=(s=this.map)==null?void 0:s.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(o=e==null?void 0:e.ground)==null?void 0:o.layers},{parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.referenceLayers}),i}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,s=>{const n=this._getSupportedSpatialReferences(s);if(n.length>0){const o=this._narrowDownSpatialReferenceCandidates(e,n);o!=null&&(e=o)}return(e==null?void 0:e.length)===1})&&(e==null?void 0:e.length)!==1)return{updating:!0};const i=this._pickSpatialReferenceCandidate(e);return{spatialReference:(i==null?void 0:i.spatialReference)??null,viewingMode:(i==null?void 0:i.viewingMode)??null,updating:!1}}get _tileInfoTask(){var o,a;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=(o=this.map)==null?void 0:o.call(this),i=this.spatialReference;if(!i)return{updating:this._spatialReferenceTask.updating};let s;const n=this._collectLayers([{parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.baseLayers},{layers:e==null?void 0:e.layers}],r=>{var c;return!(!("tileInfo"in r)||!((c=r.tileInfo)!=null&&c.spatialReference.equals(i)))&&(s=r,!0)},r=>"tileInfo"in r);return s?{tileInfo:s.tileInfo,updating:!1}:{updating:n}}get _heightModelInfoTask(){var s;if(!this.required.heightModelInfo||this.suspended&&((s=this._get("_heightModelInfoTask"))!=null&&s.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};let e={};const i=this._collectLayers(this.mapCollections,n=>{var a,r;const o=Pl(n);return!!o&&(e={heightModelInfo:o,vcsWkid:(a=n.spatialReference)==null?void 0:a.vcsWkid,latestVcsWkid:(r=n.spatialReference)==null?void 0:r.latestVcsWkid},!0)},n=>kl(n));return{...e,updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],i=this._collectLayers(this.mapCollections,s=>{const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(r=>r.spatialReference.equals(this.spatialReference))??o;if(a)return e.push({extent:a,layer:s}),!0;if(this._getSupportedSpatialReferences(s).length>0)for(const r of n)e.push({extent:r,layer:s});return!1});return{candidates:e,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const s=this._pickExtentCandidate(e),n=this.spatialReference;return s.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Si(this._projectExtentTask.task)),this._projectExtentTask={input:s.extent.clone(),output:null,spatialReference:n.clone(),task:Zi(async o=>{try{const a=await zn(s.extent,n,"portalItem"in s.layer?s.layer.portalItem:void 0,o);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(Bo(o))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const s=new Array;for(const n of e)for(const o of i){if(!n.spatialReference.equals(o.spatialReference))continue;const a=Il(n.viewingMode,o.viewingMode);if(a!==!1){s.push({spatialReference:n.spatialReference,viewingMode:a});break}}return s.length>0?s:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:s})=>s.equals(i))&&(e=e.filter(({spatialReference:s})=>s.equals(i))),e.length>1&&e.some(({viewingMode:s})=>s!==gs.Local)&&(e=e.filter(({viewingMode:s})=>s!==gs.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const s=[];for(const n of i){const o=this.getSpatialReferenceSupport(n,e);if(o!=null){const a=o.constraints??[{spatialReference:n,viewingMode:null}];for(const{spatialReference:r,viewingMode:c}of a)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!r.equals(this.userSpatialReference)||s.push({spatialReference:r,viewingMode:c})}}return s}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:s})=>i.equals(s.spatialReference))||e[0]}_collectLayers(e,i,s=()=>!0){var o;if(this._loadMaybe((o=this.map)==null?void 0:o.call(this))!=="loaded")return!0;const n=new Cl(s,i);for(const a of e)if(this._collectCollection(a,n),n.done||n.preloading===this.sourcePreloadCount)break;return n.updating}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const s of e.layers)if(i.layerFilter(s)){switch(this._loadMaybe(s)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":if(i.updating||(i.done=i.pushLayer(s)),i.done||i.preloading===this.sourcePreloadCount)break;"layers"in s&&this._collectCollection({layers:s.layers},i)}if(i.done||i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{dn(i)}),"loading"):e.loadStatus:"loaded"}};l([h()],x.prototype,"required",void 0),l([h({constructOnly:!0})],x.prototype,"map",void 0),l([h({constructOnly:!0})],x.prototype,"getSpatialReferenceSupport",void 0),l([h()],x.prototype,"defaultSpatialReference",void 0),l([h()],x.prototype,"userSpatialReference",void 0),l([h()],x.prototype,"sourcePreloadCount",void 0),l([h()],x.prototype,"priorityCollection",void 0),l([h()],x.prototype,"requiresExtentInSpatialReference",void 0),l([h()],x.prototype,"suspended",void 0),l([h({readOnly:!0})],x.prototype,"ready",null),l([h({readOnly:!0})],x.prototype,"heightModelInfoReady",null),l([h({readOnly:!0})],x.prototype,"spatialReference",null),l([h({readOnly:!0})],x.prototype,"extent",null),l([h({readOnly:!0})],x.prototype,"heightModelInfo",null),l([h({readOnly:!0})],x.prototype,"vcsWkid",null),l([h({readOnly:!0})],x.prototype,"latestVcsWkid",null),l([h({readOnly:!0})],x.prototype,"viewingMode",null),l([h({readOnly:!0})],x.prototype,"tileInfo",null),l([h({readOnly:!0})],x.prototype,"mapCollections",null),l([h({readOnly:!0})],x.prototype,"_spatialReferenceTask",null),l([h({readOnly:!0})],x.prototype,"_tileInfoTask",null),l([h({readOnly:!0})],x.prototype,"_heightModelInfoTask",null),l([h({readOnly:!0})],x.prototype,"_extentCandidatesTask",null),l([h()],x.prototype,"_extentTask",null),l([h()],x.prototype,"_projectExtentTask",void 0),x=l([y("esri.views.support.DefaultsFromMap")],x);let Cl=class{constructor(e,i){this.layerFilter=e,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function Il(t,e){return t!=null?e!=null?t===e&&t:t:e}var lt;let f=lt=class extends Bt.EventedMixin(Ko(M)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new mn,this.updatingHandles=new Jt,this.allLayerViews=new Mn({getCollections:()=>{var e,i,s;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(s=this.basemapView)==null?void 0:s.referenceLayerViews]},getChildrenFunction:Rl}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new gn,this.analyses=new Zt,this.typeSpecificPreconditionsReady=!0,this.layerViews=new D,this.magnifier=new Sn,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new xl,this.navigation=new Ln,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new sl(this),this.persistableViewModels=new D,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(w(()=>this.preconditionsReady,e=>{var s,n;const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,lt.views.add(this)):(this._lockedSpatialReference=null,lt.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)(s=this.toolViewManager)==null||s.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(n=this.layerViewManager)==null||n.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(o){return void queueMicrotask(()=>{this.fatalError=new E("startup-error",null,o)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},pt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Hi(()=>this.ready)))),this.basemapView=new qr({view:this}),this.layerViewManager=new Xr({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new se({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new tl({view:this}),this.addHandles([w(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},oe),w(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},pt),w(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},oe)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([w(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var s;const i=((s=this.map)==null?void 0:s.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const n=Kt(()=>t=Si(t));t=Zi(async o=>{try{await Yo(this.spatialReferenceWarningDelay,null,o)}catch{return}finally{t=null}$.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(n,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(lt.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=X(this.graphics),this.analyses=X(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),X(this.analysisViewManager),this.toolViewManager=X(this.toolViewManager),this.layerViewManager=X(this.layerViewManager),this.selectionManager=X(this.selectionManager),this.basemapView=X(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=X(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return $.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new x({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||rs.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&($.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),rs.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)){const s=t.clone();return s.vcsWkid=this.defaultsFromMap.vcsWkid,s.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,s}return t}set spatialReference(t){const e=!fn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(t){this._userTimeExtent=t}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Xo}set timeZone(t){this._userTimeZone=t,Jo(t)||$.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new Ei}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(t){throw new E("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&$.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(dt(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};f.views=new D,l([h()],f.prototype,"_userSpatialReference",void 0),l([h()],f.prototype,"activeTool",null),l([h({readOnly:!0})],f.prototype,"allLayerViews",void 0),l([h()],f.prototype,"groundView",void 0),l([h()],f.prototype,"animation",null),l([h()],f.prototype,"basemapView",void 0),l([h()],f.prototype,"center",null),l([h()],f.prototype,"defaultsFromMapSettings",null),l([h()],f.prototype,"defaultsFromMap",null),l([h()],f.prototype,"fatalError",void 0),l([h({type:ft})],f.prototype,"extent",null),l([h(ls(gn,"graphics"))],f.prototype,"graphics",void 0),l([h(ls(Zt,"analyses"))],f.prototype,"analyses",void 0),l([h({readOnly:!0,type:Ki})],f.prototype,"heightModelInfo",null),l([h({readOnly:!0})],f.prototype,"interacting",null),l([h({readOnly:!0})],f.prototype,"navigating",null),l([h({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],f.prototype,"preconditionsReady",null),l([h({readOnly:!0})],f.prototype,"typeSpecificPreconditionsReady",void 0),l([h({type:D,readOnly:!0})],f.prototype,"layerViews",void 0),l([h()],f.prototype,"resolution",null),l([h({type:Sn})],f.prototype,"magnifier",void 0),l([h({value:null,type:Ja})],f.prototype,"map",null),l([h()],f.prototype,"padding",void 0),l([h({readOnly:!0})],f.prototype,"ready",void 0),l([h({type:ki})],f.prototype,"spatialReference",null),l([h()],f.prototype,"spatialReferenceWarningDelay",void 0),l([h()],f.prototype,"stationary",null),l([h({readOnly:!0})],f.prototype,"supportsGround",void 0),l([h({type:Qo})],f.prototype,"timeExtent",null),l([h({type:String,nonNullable:!0})],f.prototype,"timeZone",null),l([h()],f.prototype,"tools",null),l([h()],f.prototype,"toolViewManager",void 0),l([h({readOnly:!0})],f.prototype,"type",void 0),l([h({type:Number})],f.prototype,"scale",void 0),l([h({readOnly:!0})],f.prototype,"updating",void 0),l([h({readOnly:!0})],f.prototype,"initialExtentRequired",void 0),l([h({readOnly:!0})],f.prototype,"initialExtent",null),l([h()],f.prototype,"cursor",null),l([h({readOnly:!0})],f.prototype,"input",void 0),l([h({type:Ln,nonNullable:!0})],f.prototype,"navigation",void 0),l([h()],f.prototype,"layerViewManager",void 0),l([h()],f.prototype,"analysisViewManager",void 0),l([h()],f.prototype,"selectionManager",void 0),l([h()],f.prototype,"width",void 0),l([h()],f.prototype,"height",void 0),l([h({readOnly:!0})],f.prototype,"resizing",void 0),l([h({value:null,readOnly:!0})],f.prototype,"size",null),l([h({readOnly:!0})],f.prototype,"suspended",void 0),l([h({readOnly:!0})],f.prototype,"viewEvents",void 0),l([h({readOnly:!0})],f.prototype,"persistableViewModels",void 0),l([h()],f.prototype,"_isValid",void 0),l([h()],f.prototype,"_readyCycleForced",void 0),l([h()],f.prototype,"_lockedSpatialReference",void 0),l([h()],f.prototype,"_userTimeZone",void 0),l([h()],f.prototype,"_lockedTimeZone",void 0),l([h()],f.prototype,"_userTimeExtent",void 0),l([h()],f.prototype,"_lockedTimeExtent",void 0),l([h({type:Ei})],f.prototype,"theme",void 0),l([h({readOnly:!0,type:Ei})],f.prototype,"effectiveTheme",null),f=lt=l([y("esri.views.View")],f);const mi=globalThis.$arcgis;mi&&!mi.views&&Object.defineProperty(mi,"views",{configurable:!1,enumerable:!0,writable:!1,value:f.views});const Dl=f;function Rl(t){return t.layerViews}let Te=class extends ea{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=jt(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new E("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=_n(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};l([h({readOnly:!0})],Te.prototype,"done",null),l([h({readOnly:!0,type:String})],Te.prototype,"state",void 0),l([h()],Te.prototype,"target",void 0),Te=l([y("esri.views.ViewAnimation")],Te),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Te||(Te={}));const Ii=Te;function Lt(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function Ll(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Vl(t,e,i,s,n,o,a,r,c){const u=new Float32Array(9);return u[0]=t,u[1]=e,u[2]=i,u[3]=s,u[4]=n,u[5]=o,u[6]=a,u[7]=r,u[8]=c,u}function Ol(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Ll,create:Lt,createView:Ol,fromValues:Vl},Symbol.toStringTag,{value:"Module"}));function Al(t){return t instanceof Float32Array&&t.length>=2}function zl(t){return Array.isArray(t)&&t.length>=2}function gi(t){return Al(t)||zl(t)}var Di;const le=[0,0];let pe=Di=class extends ta{constructor(t){super(t),this._viewpoint2D={center:Wi(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new ft,this.id=0,this.inverseTransform=ii(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=ii(),this.transformNoRotation=ii(),this.displayMat3=Lt(),this.displayViewMat3=Lt(),this.viewMat3=Lt(),this.viewMat2d=tr(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}get visibleArea(){const[t,e]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,e),this.toMap([0,0],t,e),this.toMap([0,0],t,0)]}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Pe(i,t.viewpoint),this._set("size",It(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Di({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return gi(e)?Ze(t,e,this.inverseTransform):(le[0]=e,le[1]=i,Ze(t,le,this.inverseTransform))}toScreen(t,e,i){return gi(e)?Ze(t,e,this.transform):(le[0]=e,le[1]=i,Ze(t,le,this.transform))}toScreenNoRotation(t,e,i){return gi(e)?Ze(t,e,this.transformNoRotation):(le[0]=e,le[1]=i,Ze(t,le,this.transformNoRotation))}wrapMapCoordinate(t,e){It(t,e);const[i]=e,[s]=this.center,{extent:n,spatialReference:o}=this;let{xmin:a,xmax:r}=n;if(o.isWrappable){const c=ia(o)/2;a=Math.max(a,s-c),r=Math.min(r,s+c)}return(i<a||i>r)&&(t[0]=sa(i,s,o)),t}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size");return na(t,i,n,e,0,s),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:s}=this._viewpoint2D,n=this._get("pixelRatio")||1,o=this._get("size"),a=new Ee({targetGeometry:new H(t[0],t[1],e),scale:i,rotation:s});if(this._set("viewpoint",a),!o||!e||!i)return;this.resolution=oa(a),this.rotation=s,this.scale=i,this.spatialReference=e,It(this.center,t);const r=o[0]!==0?2/o[0]:0,c=o[1]!==0?-2/o[1]:0;ir(this.displayMat3,r,0,0,0,c,0,-1,1,1);const u=sr(this.viewMat3),p=_s(o[0]/2,o[1]/2),m=_s(-o[0]/2,-o[1]/2),d=aa(s);fs(u,u,p),nr(u,u,d),fs(u,u,m),or(this.displayViewMat3,this.displayMat3,u);const g=ra(this.viewMat2d,p);return la(g,g,d),ha(g,g,m),ca(this.extent,a,o),ua(this.transform,a,o,n),pa(this.inverseTransform,this.transform),da(this.transformNoRotation,a,o,n),this.worldScreenWidth=ma(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};l([h({readOnly:!0})],pe.prototype,"id",void 0),l([h({value:1,json:{write:!0}})],pe.prototype,"pixelRatio",null),l([h({json:{write:!0}})],pe.prototype,"size",null),l([h()],pe.prototype,"spatialReference",void 0),l([h({type:Ee,json:{write:!0}})],pe.prototype,"viewpoint",null),l([h({readOnly:!0})],pe.prototype,"visibleArea",null),pe=Di=l([y("esri.views.2d.ViewState")],pe);const Ls=pe;var Ri,Li;let fe=Ri=class extends M{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new Ri({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};l([h()],fe.prototype,"left",void 0),l([h()],fe.prototype,"top",void 0),l([h()],fe.prototype,"right",void 0),l([h()],fe.prototype,"bottom",void 0),fe=Ri=l([y("esri.views.2d.PaddedViewState.Padding")],fe);let Be=Li=class extends Ls{constructor(...t){super(...t),this.paddedViewState=new Ls,this._updateContent=(()=>{const e=Wi();return()=>{const i=this._get("size"),s=this._get("padding");if(!i||!s)return;const n=this.paddedViewState;ga(e,s.left+s.right,s.top+s.bottom),fa(e,i,e),It(n.size,e);const o=n.viewpoint;o&&(this.viewpoint=o)}})(),this.addHandles(w(()=>[this.size,this.padding],()=>this._updateContent(),pt)),this.padding=new fe,this.size=[0,0]}set padding(t){this._set("padding",t||new fe)}set viewpoint(t){if(t){this.paddedViewState.viewpoint=t;let e=t;const i=this._get("padding");i&&(e=_a(t.clone(),t,this._get("size"),i));const{targetGeometry:s,rotation:n,scale:o}=e,{x:a,y:r,spatialReference:c}=s,u=this._viewpoint2D;u.center[0]=a,u.center[1]=r,u.rotation=n,u.scale=o,u.spatialReference=c,this._update()}}clone(){return new Li({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};l([h()],Be.prototype,"paddedViewState",void 0),l([h({type:fe})],Be.prototype,"padding",null),l([h()],Be.prototype,"viewpoint",null),Be=Li=l([y("esri.views.2d.PaddedViewState")],Be);const Xi=Be;let Vs=class{constructor(e){this._view=e,this.viewpoint=new Ee({targetGeometry:new H,scale:0,rotation:0})}get view(){return this._view}get size(){const[e,i]=this._view.size;return Math.sqrt(e*e+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return ya(this.center.spatialReference)}pixelsPerPanAtZoom(e){return 1/(e*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(e){return 1/(e*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(e,i){i.pan=va(this.center,e.center);let s=Math.abs(e.rotation-this.rotation);s=s>=180?360-s:s,i.rotate=yn(s),i.sourceZoom=this.scale,i.targetZoom=e.scale}interpolate(e,i,s){const{pan:n,rotate:o,zoom:a,zoomOffset:r}=s,{center:c}=this;c.spatialReference=e.center.spatialReference,c.x=bt(e.center.x,i.center.x,n),c.y=bt(e.center.y,i.center.y,n),this.viewpoint.scale=bt(e.scale,i.scale+r,a);let u=e.rotation;const p=i.rotation;Math.abs(p-u)>=180&&(u+=360*(u<p?1:-1)),this.viewpoint.rotation=bt(u,p,o)}copyFrom(e){Pe(this.viewpoint,e.viewpoint),this._view=e.view}};const Nn=t=>t*t,Nl=t=>1-Nn(1-t),Fl=t=>2**(10*(t-1)),Hl=t=>1-Fl(1-t);function Zl(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return s=>s<i?t*s*s:e*s-e+1}function Gl(t,e){return(i,s)=>i<e?e*t(i/e,s):1-t((1-i)/(1-e),s)*(1-e)}const Os=Gl(Zl(1),.5);let Wl=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const Gt={desiredScreenFlow:2,minDuration:Q(500),maxDuration:Q(8e3)},Fn={maxDuration:Q(4e3)};let Ul=class Hn{constructor(e){this._createCamera=e,this.compared=new Wl,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Gt.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Hn(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,s){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=s.desiredScreenFlow??Gt.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>si()}get hasFov(){return Math.abs(this.compared.fov)>si()}get hasRotate(){return this.compared.rotate>si()}},jl=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},ql=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>B(e+i.time),B(0))}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let s=0,n=0;const o=this.definition,a=this.segments.reduce((r,c)=>r||c.definition.hasZoom,!1);for(let r=0;r<this.segments.length;r++){const c=this.segments[r],u=c.definition;if(e<=c.time||r===this.segments.length-1){if(this.segmentInterpolateComponentsAt(c,c.time===0?0:e/c.time,i),o.hasPan&&!isNaN(i.pan)&&isFinite(o.compared.pan)?i.pan=(s+u.compared.pan*i.pan)/o.compared.pan:i.pan=1,o.hasRotate&&!isNaN(i.rotate)&&isFinite(o.compared.rotate)?i.rotate=(n+u.compared.rotate*i.rotate)/o.compared.rotate:i.rotate=1,a&&!isNaN(i.zoom)&&isFinite(u.compared.targetZoom)){const{sourceZoom:p,targetZoom:m}=u.compared,d=i.zoom*(m-p)+p,g=this.segments[0].definition.compared.sourceZoom,R=this.segments[this.segments.length-1].definition.compared.targetZoom,v=Math.abs(m-g)>Math.abs(p-g)?m:p;i.zoomOffset=v-R,i.zoom=(d-g)/(v-g)}else i.zoom=1;return i}e-=c.time,s+=u.compared.pan,n+=u.compared.rotate}}segmentInterpolateComponentsAt(e,i,s){e.interpolateComponentsAt(i,s)}},fi=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,s=i.sourceZoom,n=i.targetZoom;this._zoomSign=s>n?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(s);const o=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*o}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:s,hasPan:n,hasRotate:o}=this.definition;let a=0,r=0;s&&(n&&(a=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),o&&(r=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const c=this.definition.desiredPixelFlow;if(s&&n&&o){const u=a+r+a*r;this._zoomPixelFlow=a*r/u*c,this._panPixelFlow=r/u*c,this._rotatePixelFlow=a/u*c}else if(s&&n){const u=1+a;this._zoomPixelFlow=a/u*c,this._panPixelFlow=1/u*c}else if(s&&o){const u=1+r;this._zoomPixelFlow=r/u*c,this._rotatePixelFlow=1/u*c}else if(n&&o){const u=this._panPixelsAtSource/this._rotatePixels,p=1+u;this._panPixelFlow=u/p*c,this._rotatePixelFlow=1/p*c}else n?this._panPixelFlow=c:s?this._zoomPixelFlow=c:o&&(this._rotatePixelFlow=c);if(this._time=B(Math.max(this.rotateTime,this.zoomTime,this.panTime)),this.fovTime>this._time){const u=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=u,this._panPixelFlow/=u,this._rotatePixelFlow/=u}}get rotateTime(){return this.definition.hasRotate?B(this._rotatePixels/this._rotatePixelFlow):B(0)}get zoomTime(){return this.definition.hasZoom?B(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):B(0)}get fovTime(){return this.definition.hasFov?B(Math.abs(this.definition.compared.fov)/Bl):B(0)}get panTime(){if(!this.definition.hasPan)return B(0);if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return B(Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return B(this._panPixelsAtSource/this._panPixelFlow)}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,s=this.definition.compared.targetZoom;return(i*(i/s)**-e-i)/(s-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:s}=this.definition;return i+e*(s-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const Bl=yn(45);function Kl(t,e,i){const s=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(s);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function Yl(t,e,i){const s=1/e,n=Math.log(t.compared.sourceZoom*s),o=1/t.desiredPixelFlow,a=1/Math.LN2,r=e-t.compared.sourceZoom,c=1/r,u=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*o*a*c*u-t.halfWindowSize*n*o*a*c+t.halfWindowSize*n*o*a*u/(r*r)}function Xl(t,e,i){const s=e-t.compared.sourceZoom,n=1/s,o=1/e,a=Math.log(t.compared.sourceZoom*o),r=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(s))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*o*r+2*n*a+2*o-2*a*r/(s*s)-r/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Jl(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Ql(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function eh(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function th(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function ih(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function sh(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function nh(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function oh(t,e,i){const s=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=-e+t.compared.targetZoom,r=1/a,c=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*s*n*o*r+t.halfWindowSize*s*n*o*c/(a*a)+t.halfWindowSize*n*o*r*c/e}function ah(t,e,i){const s=e-t.compared.targetZoom,n=1/s,o=1/e,a=Math.log(e/t.compared.targetZoom),r=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*o*r-2*n*a+2*o+2*a*r/(s*s)-r/(e*e))/(t.desiredPixelFlow*Math.LN2)}function rh(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function lh(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function hh(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function ch(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,s=e,n=t.halfWindowPanAtZoom(s),o=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*n);return t.compared.sourceZoom<=t.compared.targetZoom?o*(i-n):o*(i+n)}function uh(t,e){let i=ph(t,e);const s={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=s.ascensionFactor===0,o=s.descensionFactor===0,a=n?Jl:Kl,r=n?Ql:Yl,c=n?eh:Xl,u=o?rh:nh,p=o?lh:oh,m=o?hh:ah,d=T=>a(t,T,s)+th(t,T,s)+u(t,T,s),g=T=>r(t,T,s)+ih(t,T,s)+p(t,T,s),R=T=>c(t,T,s)+sh(t,T,s)+m(t,T,s);let v=d(i);const C=ch(t);let k;const te=e.maximumIterations||20,P=e.maximumDistance!=null?e.maximumDistance:1/0;for(k=0;k<te;k++){const T=e.desiredSlope??1e-6;let N=g(i);Math.abs(N)>T&&(N+=T);const j=N/R(i);if(isNaN(j)||i>=P&&j<0){if(!isFinite(P))return null;i=P,v=d(i);break}if(i-=j,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const re=d(i);if(Math.abs(re-v)/v<=.005)break;v=re}return v>C*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function ph(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),s=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return s<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,s):s}let dh=class extends ql{constructor(e,i){super(),this._preallocSegments=[new fi,new fi,new fi],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const s=i!=null&&i.apex?uh(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,s?this._updateWithApex(s,i==null?void 0:i.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,s){e.interpolateComponentsAt(i,s),e===this._ascensionSegment?s.zoom=Nl(s.zoom):e===this._descensionSegment&&(s.zoom=Nn(s.zoom))}_updateWithApex(e,i){const[s,n,o]=this._preallocSegments,a=(i==null?void 0:i.ascensionFactor)??.5,r=Math.min(1-a,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),c=1-a-r;s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.definition.segmentEnd=a,s.update(),this._ascensionSegment=s,this.segments.push(s),c>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*c,n.definition.compared.rotate=this.definition.compared.rotate*c,n.definition.segmentStart=s.definition.segmentEnd,n.definition.segmentEnd=s.definition.segmentEnd+c,n.update(),this.segments.push(n)),o.definition?o.definition.copyFrom(this.definition):o.definition=this.definition.clone(),o.definition.compared.sourceZoom=e,o.definition.compared.pan=this.definition.compared.pan*r,o.definition.compared.rotate=this.definition.compared.rotate*r,o.definition.segmentStart=a+c,o.update(),this._descensionSegment=o,this.segments.push(o)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const mh=new jl;let gh=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=Q(0),this._easing=Os,this.definition=new Ul(e),this.path=new dh}update(e,i,s){this.definition.update(e,i,s),this.path.update(this.definition,s),this._time=this._applyTimeSettings(wa(isFinite(this.path.time)?this.path.time:B(0)),s),this._easing=s.easing??(this._time>=1e3?Os:Hl)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const s=this.path.interpolateComponentsAt(e,mh);i.interpolate(this.definition.source,this.definition.target,s)}_normalizedEasing(e){const i=this._easing(0,this._time),s=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(s-i)}_applyTimeSettings(e,i){const s=i.speedFactor!=null?i.speedFactor:1,n=i.minDuration??Gt.minDuration/s,o=i.maxDuration??Gt.maxDuration/s;return e=i.duration!=null?i.duration:Q(Math.min(Math.max(e/s,n),o))}};const As=2e3,fh=64;let _h=class{constructor(e){this._view=e,this._animation=new gh(()=>new Vs(this._view)),this._current=new Vs(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(e,i,s={}){Pe(this._current.viewpoint,e),Pe(this._source.viewpoint,e),Pe(this._target.viewpoint,i),this._animation.update(this._source,this._target,s)}applyRatio(e,i){this._animation.cameraAt(i,this._current),Pe(e,this._current.viewpoint)}},Ke=class extends M{constructor(e){super(e),this._animation=null,this._destinationViewState=new Xi,this.updateFunction=null,this.easing=ar.ease,this.viewpoint=new Ee({targetGeometry:new H,scale:0,rotation:0}),this._updateTask=et({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new _h(e.view)}destroy(){this._updateTask=ee(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,i,s){this.stop();const n=this.viewpoint;Pe(n,i);const o=(typeof(s==null?void 0:s.easing)=="string"?rr(s.easing):s==null?void 0:s.easing)||this.easing,a=e.target;this._transition.update(this.viewpoint,a,{apex:{maximumDistance:Math.min(Math.min(i.scale,a.scale)*fh,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:s==null?void 0:s.duration,maxDuration:(s==null?void 0:s.animationMode)==="auto"?Q(1/0):(s==null?void 0:s.maxDuration)??Fn.maxDuration,speedFactor:s==null?void 0:s.speedFactor,easing:typeof o=="function"?c=>o(c):void 0}),(s==null?void 0:s.animationMode)==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=a,yh(this._transition.animation,s,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,a,{duration:Q(0)}));const r=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,i){this.stop(),this.updateFunction=i,this.viewpoint=e;const s=new Ii({target:e.clone()}),n=()=>{this.animation===s&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return s.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=s,s}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){var s,n;const i=this.animation;if(i&&i.state!==Ii.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),(s=this.animation)==null||s.update(this.viewpoint);else{const o=performance.now()-this._startTime,a=this._transition.duration,r=a>0?o/a:1,c=r>=1;this._transition.applyRatio(this.viewpoint,r),c&&((n=this.animation)==null||n.finish())}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function yh(t,e,i,s){if((e==null?void 0:e.duration)!=null)return!0;const{time:n,isLinear:o}=t,a=(e==null?void 0:e.speedFactor)||1,r=(e==null?void 0:e.maxDuration)??Fn.maxDuration/a;if(V("esri-goto-debug")&&(console.log("speed factor:",a),console.log("adjusted duration:		",n),console.log("adjusted max duration:	",r),console.log("is linear:",o)),n>r)return V("esri-goto-debug")&&console.warn(`failed "auto" heuristic: animations must be shorter than ${r/1e3}s`),!1;if(o){const u=Wi(),p=A(...s.toScreen(u,...i.center)),m=A(...i.toScreen(u,...s.center)),d=m!=null&&m.x>-1*i.size[0]&&m.x<(1.5+.5)*i.size[0]&&m.y>-1*i.size[1]&&m.y<(1.5+.5)*i.size[1],g=p!=null&&p.x>-1*s.size[0]&&p.x<(1.5+.5)*s.size[0]&&p.y>-1*s.size[1]&&p.y<(1.5+.5)*s.size[1];if(V("esri-goto-debug")&&(console.log(`dest is within ${1.5} screens at start view:`,d),console.log(`start is within ${1.5} screens at dest view:`,g)),n>As/a&&!d&&!g)return V("esri-goto-debug")&&console.warn(`failed "auto" heuristic: linear animations must be...
  - shorter than ${As/1e3/a}s, or
  - shorter than ${r/1e3}s and the destination is close enough to the starting screen, or
  - shorter than ${r/1e3}s and the start point is close enough to the destination screen`),!1}return!0}l([h()],Ke.prototype,"easing",void 0),l([h()],Ke.prototype,"view",void 0),l([h()],Ke.prototype,"viewpoint",void 0),Ke=l([y("esri.views.2d.AnimationManager")],Ke);const vh=Ke;let wh=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=lr(),this.stationary=!0,this.prepare=()=>{var i;this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),((i=this.view.animation)==null?void 0:i.target)==null||_n(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=i=>{var r;if(this._updateRequested=!1,(r=this.view)==null?void 0:r.destroyed)return;const{allLayerViews:s,graphicsView:n,labelManager:o,state:{id:a}}=this.view;s.forEach(this._updateLayerView,this),o!=null&&(o.lastUpdateId!==a&&(o.viewChange(),o.lastUpdateId=a),o.updateRequested&&o.processUpdate(this._updateParameters)),n!=null&&(n.lastUpdateId!==a&&(n.viewChange(),n.lastUpdateId=a),n.updateRequested&&n.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=ai.ANIMATING:this.view.interacting?this._scheduler.state=ai.INTERACTING:this._scheduler.state=ai.IDLE,this._scheduler.updateBudget(i)&&this._scheduler.frame()}}destroy(){this.stop(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,targetState:new Xi,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=w(()=>e.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=et(this),this.requestUpdate()}stop(){var e;this._frameTaskHandle&&(this._updateRequested=!1,(e=this._stationaryHandle)==null||e.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){var n;if(!e.attached)return void this.requestUpdate();const i=this.view.state,s=e.lastUpdateId;s!=null&&(this.stationary||e.moving)||(e.moving=!0),s!==i.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=i.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&((n=e.layerViews)==null||n.forEach(this._updateLayerView,this))}},Vt=class extends M{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,i){if(!e)return void $.getLogger(this).error("#goTo()","target cannot be null or undefined");const s=new Ii;this.view.animation=s,await Hi(()=>this.view.ready,i);const n={...i,animate:(i==null?void 0:i.animate)??!xn(),animationMode:(i==null?void 0:i.animationMode)??"auto"},{extent:o,spatialReference:a,size:r,viewpoint:c,constraints:u,padding:p,allLayerViews:m}=this.view,d=ba(e,{extent:o,spatialReference:a,size:r,viewpoint:c,constraints:u,padding:p,allLayerViews:m,pickClosestTarget:(i==null?void 0:i.pickClosestTarget)??!0});return s==null||s.update(d),this._gotoTask={},n.animate?this._gotoAnimated(d,n):this._gotoImmediate(d,n)}_gotoImmediate(e,i){const s=this._gotoTask,n=this.view.animation,o=e.then(a=>{if(Se(i),s!==this._gotoTask)throw new E("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=n.target=a,n.finish()});return this._cancellableGoTo(s,n,o,i)}_gotoAnimated(e,i){const s=this._gotoTask,n=this.view.animation;if(!n)return Promise.resolve();const o=e.then(a=>{if(Se(i),s!==this._gotoTask)throw new E("view:goto-interrupted","Goto was interrupted");return n.update(a),this.view.animationManager.animate(n,this.view.viewpoint,i),n.when().then(()=>{},()=>{})});return this._cancellableGoTo(s,n,o,i)}_cancellableGoTo(e,i,s,n){const o=()=>e===this._gotoTask;return Ma(s,n).finally(()=>{o()&&(i.done||i.stop())})}};l([h({constructOnly:!0})],Vt.prototype,"view",void 0),Vt=l([y("esri.views.2d.GoToManager")],Vt);function S(){return Promise.all([b(()=>import("./webglDeps-Yyfy7E_b.js"),__vite__mapDeps([67,68,1,2,69,70,71,72,73,74])),b(()=>import("./mapViewDeps-DEeY8dXV.js"),__vite__mapDeps([75,1,2,76,77,78,79,80,81,82,19,83,84,85,86,87,88,69,70,71,68,89,90,60,91,92,74,93,94,73,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,67,72,111,112,113,114,23,115,42,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,5,136,137,138,139,7,8,140,141,142,28,15,143,144,145,21,13,146,64,147]))])}const st=()=>S().then(()=>b(()=>import("./TileLayerView2D-B2Vn0xuG.js"),__vite__mapDeps([148,1,2,107,82,86,87,88,69,70,71,68,89,90,85,83,60,91,81,79,80,77,19,84,98,97,94,74,73,92,95,96,99,100,101,102,103,110,111,112,113,114,23,115,42,78,93,104,105,76,108,109,117,118,119,127,128,129,130,149,150,134,151,152,63,153,132,133,154,155,156,157,22,158,5,159,160,161,162,145,137,138,139,7,8,140,141,142,28,15,143,144,122,21,13,146,64,147]))),$e=()=>S().then(()=>b(()=>import("./FeatureLayerView2D-mQBL0lWb.js").then(t=>t.F),__vite__mapDeps([163,1,2,98,103,38,164,140,137,141,142,151,152,97,63,91,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,78,79,80,77,81,84,93,104,105,76,112,128,129,165,46,41,42,106,107,166,159,162,154]))),zs={"base-dynamic":()=>S().then(()=>b(()=>import("./BaseDynamicLayerView2D-DZnlfIig.js"),__vite__mapDeps([167,1,2,168,94,82,89,69,70,71,68,90,85,83,74,73,19,92,95,96,97,98,99,100,101,102,103,151,152,63,91,169,138,139,150,128,105,60,76,129,154,137,7,8,140,141,142,28,15,143,144,145,122,104,21,13,146,64,147]))),"base-tile":st,"bing-maps":st,catalog:()=>S().then(()=>b(()=>import("./CatalogLayerView2D-BmVAtB3z.js"),__vite__mapDeps([170,1,2,151,152,97,98,63,91,137,138,139,7,8,76,140,141,142,28,60,15,143,19,92,83,144,145,128,99,105,129,95,82,70,69,122,104,21,13,146,64,147]))),"catalog-dynamic-group":()=>S().then(()=>b(()=>import("./CatalogDynamicGroupLayerView2D-DhWT0Klg.js"),__vite__mapDeps([171,1,2,151,152,97,98,63,91,137,138,139,7,8,76,140,141,142,28,60,15,143,19,92,83,144,145,128,99,105,129,95,82,70,69,122,104,21,13,146,64,147]))),"catalog-footprint":()=>S().then(()=>b(()=>import("./CatalogFootprintLayerView2D-D0MITJD6.js"),__vite__mapDeps([172,1,2,163,98,103,38,164,140,137,141,142,151,152,97,63,91,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,78,79,80,77,81,84,93,104,105,76,112,128,129,165,46,41,42,106,107,166,159,162,154,138,139,7,8,28,15,143,144,145,122,21,13,146,64,147]))),csv:$e,"geo-rss":()=>S().then(()=>b(()=>import("./GeoRSSLayerView2D-X3qIE9Nq.js"),__vite__mapDeps([173,1,2,151,152,97,98,63,91,131,132,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,103,78,79,80,77,81,84,93,104,105,76,127,114,23,115,42,128,129,130,137,138,139,7,8,140,141,142,28,15,143,144,145,122,21,13,146,64,147]))),feature:$e,geojson:$e,parquet:$e,graphics:()=>S().then(()=>b(()=>import("./GraphicsLayerView2D-DhiRYUEn.js"),__vite__mapDeps([174,1,2,151,152,97,98,63,91,131,132,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,103,78,79,80,77,81,84,93,104,105,76,127,114,23,115,42,128,129,130,166,137,138,139,7,8,140,141,142,28,15,143,144,145,122,21,13,146,64,147]))),group:()=>S().then(()=>b(()=>import("./GroupLayerView2D-BX4dWQoY.js"),__vite__mapDeps([175,1,2,151,152,97,98,63,91,137,138,139,7,8,76,140,141,142,28,60,15,143,19,92,83,144,145,128,99,105,129,95,82,70,69,122,104,21,13,146,64,147]))),imagery:()=>S().then(()=>b(()=>import("./ImageryLayerView2D-BbxBNFMi.js"),__vite__mapDeps([176,1,2,177,68,69,70,74,90,178,179,94,82,89,71,85,83,73,19,92,95,96,97,98,99,100,101,102,103,151,152,63,91,127,79,80,77,81,84,114,23,115,86,87,88,60,42,78,93,104,105,76,128,129,130,153,132,133,134,168,150,169,138,139,180,164,140,137,141,142,162,154,7,8,28,15,143,144,145,122,21,13,146,64,147]))),"imagery-tile":()=>S().then(()=>b(()=>import("./ImageryTileLayerView2D-C4TRgdH7.js"),__vite__mapDeps([181,1,2,182,177,68,69,70,74,90,178,179,94,82,89,71,85,83,73,19,92,95,96,97,98,99,100,101,102,103,151,152,63,91,183,134,138,139,184,180,128,105,60,76,129,145,104,164,140,137,141,142,162,154,7,8,28,15,143,144,122,21,13,146,64,147]))),kml:()=>S().then(()=>b(()=>import("./KMLLayerView2D-CVWvW9nQ.js"),__vite__mapDeps([185,1,2,186,150,92,83,97,98,70,69,168,94,82,89,71,68,90,85,74,73,19,95,96,99,100,101,102,103,151,152,63,91,131,132,133,86,87,88,60,134,78,79,80,77,81,84,93,104,105,76,127,114,23,115,42,128,129,130,180,116,67,72,117,118,119,113,107,120,183,137,138,139,7,8,140,141,142,28,15,143,144,145,122,21,13,146,64,147]))),"knowledge-graph":()=>S().then(()=>b(()=>import("./KnowledgeGraphLayerView2D-D4EhxN6S.js"),__vite__mapDeps([187,1,2,151,152,97,98,63,91,137,138,139,7,8,76,140,141,142,28,60,15,143,19,92,83,144,145,128,99,105,129,95,82,70,69,122,104,21,13,146,64,147]))),"link-chart":()=>S().then(()=>b(()=>import("./KnowledgeGraphLayerView2D-D4EhxN6S.js"),__vite__mapDeps([187,1,2,151,152,97,98,63,91,137,138,139,7,8,76,140,141,142,28,60,15,143,19,92,83,144,145,128,99,105,129,95,82,70,69,122,104,21,13,146,64,147]))),"knowledge-graph-sublayer":$e,"map-image":()=>S().then(()=>b(()=>import("./MapImageLayerView2D-JCMHbD6_.js"),__vite__mapDeps([188,1,2,168,94,82,89,69,70,71,68,90,85,83,74,73,19,92,95,96,97,98,99,100,101,102,103,151,152,63,91,127,79,80,77,81,84,114,23,115,86,87,88,60,42,78,93,104,105,76,128,129,130,153,132,133,134,169,138,139,150,189,5,159,161,164,140,137,141,142,154,155,156,157,22,158,160,162,7,8,28,15,143,144,145,122,21,13,146,64,147]))),"map-notes":()=>S().then(()=>b(()=>import("./MapNotesLayerView2D-J9hHUeAF.js"),__vite__mapDeps([190,1,2,151,152,97,98,63,91,131,132,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,103,78,79,80,77,81,84,93,104,105,76,127,114,23,115,42,128,129,130,137,138,139,7,8,140,141,142,28,15,143,144,145,122,21,13,146,64,147]))),media:()=>S().then(()=>b(()=>import("./MediaLayerView2D-BcsrEy3v.js"),__vite__mapDeps([191,1,2,192,130,92,193,95,107,82,86,87,88,69,70,71,68,89,90,85,83,60,91,81,79,80,77,19,84,98,97,94,74,73,96,99,100,101,102,103,110,111,112,113,114,23,115,42,78,93,104,105,76,108,109,117,118,119,127,128,129,124,125,194,151,152,63,145,137,138,139,7,8,140,141,142,28,15,143,144,122,21,13,146,64,147]))),"ogc-feature":()=>S().then(()=>b(()=>import("./OGCFeatureLayerView2D-B0gPmz9_.js"),__vite__mapDeps([195,1,2,163,98,103,38,164,140,137,141,142,151,152,97,63,91,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,78,79,80,77,81,84,93,104,105,76,112,128,129,165,46,41,42,106,107,166,159,162,154,138,139,7,8,28,15,143,144,145,122,21,13,146,64,147]))),"open-street-map":st,"oriented-imagery":$e,route:()=>S().then(()=>b(()=>import("./RouteLayerView2D-BuF2Ujlk.js").then(t=>t.i),__vite__mapDeps([196,1,2,137,151,152,97,98,63,91,131,132,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,103,78,79,80,77,81,84,93,104,105,76,127,114,23,115,42,128,129,130]))),stream:()=>S().then(()=>b(()=>import("./StreamLayerView2D-DazF1Urr.js"),__vite__mapDeps([197,1,2,163,98,103,38,164,140,137,141,142,151,152,97,63,91,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,78,79,80,77,81,84,93,104,105,76,112,128,129,165,46,41,42,106,107,166,159,162,154,138,139,7,8,28,15,143,144,145,122,21,13,146,64,147]))),"subtype-group":()=>S().then(()=>b(()=>import("./SubtypeGroupLayerView2D-CrYq_Njl.js"),__vite__mapDeps([198,1,2,163,98,103,38,164,140,137,141,142,151,152,97,63,91,133,82,86,87,88,69,70,71,68,89,90,85,83,60,134,94,74,73,19,92,95,96,99,100,101,102,78,79,80,77,81,84,93,104,105,76,112,128,129,165,46,41,42,106,107,166,159,162,154,138,139,7,8,28,15,143,144,145,122,21,13,146,64,147]))),tile:st,"vector-tile":()=>S().then(()=>b(()=>import("./VectorTileLayerView2D-DNZ7UlMc.js"),__vite__mapDeps([199,1,2,110,84,70,69,123,107,93,99,128,105,60,76,129,92,81,68,74,101,94,82,89,71,90,85,83,73,19,95,96,97,98,100,102,103,138,139,134,200,201,202,144,151,152,63,91,154,145,137,7,8,140,141,142,28,15,143,122,104,21,13,146,64,147]))),video:()=>S().then(()=>b(()=>import("./VideoLayerView2D-BwX84jGI.js"),__vite__mapDeps([203,1,2,204,194,92,83,96,94,82,89,69,70,71,68,90,85,74,73,19,95,97,98,99,100,101,102,103,78,79,80,77,81,84,86,87,88,60,91,93,104,105,76,151,152,63,131,132,133,134,127,114,23,115,42,128,129,130,137,138,139,7,8,140,141,142,28,15,143,144,145,122,21,13,146,64,147]))),wcs:()=>S().then(()=>b(()=>import("./ImageryTileLayerView2D-C4TRgdH7.js"),__vite__mapDeps([181,1,2,182,177,68,69,70,74,90,178,179,94,82,89,71,85,83,73,19,92,95,96,97,98,99,100,101,102,103,151,152,63,91,183,134,138,139,184,180,128,105,60,76,129,145,104,164,140,137,141,142,162,154,7,8,28,15,143,144,122,21,13,146,64,147]))),"web-tile":st,wfs:$e,wms:()=>S().then(()=>b(()=>import("./WMSLayerView2D-CeZQXzDC.js"),__vite__mapDeps([205,1,2,168,94,82,89,69,70,71,68,90,85,83,74,73,19,92,95,96,97,98,99,100,101,102,103,151,152,63,91,169,138,139,150,128,105,60,76,129,154,206,164,140,137,141,142,7,8,28,15,143,144,145,122,104,21,13,146,64,147]))),wmts:()=>S().then(()=>b(()=>import("./WMTSLayerView2D-DhtUOTRB.js"),__vite__mapDeps([207,1,2,149,150,92,83,97,98,70,69,94,82,89,71,68,90,85,74,73,19,95,96,99,100,101,102,103,134,151,152,63,91,128,105,60,76,129,154,145,137,138,139,7,8,140,141,142,28,15,143,144,122,104,21,13,146,64,147]))),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,focusArea:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};function bh(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new E(`${i}:view-not-supported`,`${e} is not supported in 2D`)}const Ns={hasLayerViewModule:t=>zs[t.type]!=null,importLayerView:t=>{const e=zs[t.type];if(e==null)throw bh(t);return e(t)}};function Mh(t,e){const{spatialReference:i}=e,s=[e.x,e.y];let n=Number.POSITIVE_INFINITY,o=0,a=0;const r=[0,0],c=t.type==="extent"?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const u of c)for(let p=0;p<u.length-1;p++){Ta(r,s,u,p);const m=xa(s,r);m<n&&(n=m,o=r[0],a=r[1])}return{coordinate:new H({x:o,y:a,spatialReference:i}),distance:n}}var Vi;let Ae=Vi=class extends Ui(M){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return Gi(this.geometry,this.spatialReference)}catch(t){return $.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(this.normalizedGeometry==null)return t;const i=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?ji(this.normalizedGeometry,i):vn(this.normalizedGeometry,i))return t;const{coordinate:s}=Mh(this.normalizedGeometry,i);return s&&(t.targetGeometry=s),t}clone(){var t,e;return new Vi({geometry:(t=this.geometry)==null?void 0:t.clone(),spatialReference:(e=this.spatialReference)==null?void 0:e.clone()})}};l([h({constructOnly:!0})],Ae.prototype,"geometry",void 0),l([h({readOnly:!0})],Ae.prototype,"normalizedGeometry",null),l([h({constructOnly:!0})],Ae.prototype,"spatialReference",void 0),Ae=Vi=l([y("esri.views.2d.constraints.GeometryConstraint")],Ae);var Oi;let ht=Oi=class extends Ui(M){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new Oi({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};l([h()],ht.prototype,"enabled",void 0),l([h()],ht.prototype,"rotationEnabled",void 0),ht=Oi=l([y("esri.views.2d.constraints.RotationConstraint")],ht);const Zn=ht;var Ai;let W=Ai=class extends Ui(M){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:s,minZoom:n,maxZoom:o}=this,a=-1,r=-1,c=!1,u=!1;if(i!==0&&s!==0&&i<s&&([i,s]=[s,i]),!(e!=null&&e.length))return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",s);e=e.map(p=>p.clone()),e.sort((p,m)=>m.scale-p.scale),e.forEach((p,m)=>p.level=m);for(const p of e)!c&&i>0&&i>=p.scale&&(a=p.level,c=!0),!u&&s>0&&s>=p.scale&&(r=t?t.level:-1,u=!0),t=p;n===-1&&(n=i===0?0:a),o===-1&&(o=s===0?e.length-1:r),n=Math.max(n,0),n=Math.min(n,e.length-1),o=Math.max(o,0),o=Math.min(o,e.length-1),n>o&&([n,o]=[o,n]),i=e[n].scale,s=e[o].scale,e.splice(0,n),e.splice(o-n+1,e.length),e.forEach((p,m)=>{this._lodByScale[p.scale]=p,this._scales[m]=p.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",n),this._set("effectiveMaxZoom",o),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",s)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,s=this.effectiveMaxScale,n=t.targetGeometry,o=e&&e.targetGeometry,a=s!==0&&t.scale<s,r=i!==0&&t.scale>i;if(a||r){const c=r?i:s;if(e&&o){const u=(c-e.scale)/(t.scale-e.scale);n.x=o.x+(n.x-o.x)*u,n.y=o.y+(n.y-o.y)*u}t.scale=c}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.floor(t),s=Math.ceil(t);return e[i]+(t-i)*(e[s]-e[i])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,s;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let n=0;n<e.length-1;n++){if(i=e[n],s=e[n+1],s===t)return n+this.effectiveMinZoom+1;if(i>t&&s<t)return n+this.effectiveMinZoom+1-(t-s)/(i-s)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new Ai({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e,this._scales[0])),this._lodByScale[t].scale}};l([h({readOnly:!0})],W.prototype,"effectiveLODs",void 0),l([h({readOnly:!0})],W.prototype,"effectiveMinZoom",void 0),l([h({readOnly:!0})],W.prototype,"effectiveMaxZoom",void 0),l([h({readOnly:!0})],W.prototype,"effectiveMinScale",void 0),l([h({readOnly:!0})],W.prototype,"effectiveMaxScale",void 0),l([h()],W.prototype,"lods",void 0),l([h()],W.prototype,"minZoom",void 0),l([h()],W.prototype,"maxZoom",void 0),l([h()],W.prototype,"minScale",void 0),l([h()],W.prototype,"maxScale",void 0),l([h()],W.prototype,"snapToZoom",void 0),W=Ai=l([y("esri.views.2d.constraints.ZoomConstraint")],W);const Gn=W,Th={base:null,key:"type",typeMap:{extent:ft,polygon:wn}};let I=class extends M{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new D}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){var e,i,s;return`${(e=this._zoom)==null?void 0:e.uid}/${(i=this._rotation)==null?void 0:i.uid}/${(s=this._geometry)==null?void 0:s.uid}`}get _geometry(){var i,s;const e=this._get("_geometry");return e&&this.geometry===e.geometry&&((i=this.view)==null?void 0:i.constraintsInfo.spatialReference)===e.spatialReference?e:new Ae({geometry:this.geometry,spatialReference:(s=this.view)==null?void 0:s.constraintsInfo.spatialReference})}get _rotation(){return new Zn({rotationEnabled:this.rotationEnabled})}get _zoom(){var c;const e=this._get("_zoom"),i=this.lods||((c=this.view)==null?void 0:c.constraintsInfo.lods),s=this.minZoom,n=this.maxZoom,o=this.minScale,a=this.maxScale,r=this.snapToZoom;return e&&e.lods===i&&e.minZoom===s&&e.maxZoom===n&&e.minScale===o&&e.maxScale===a&&e.snapToZoom===r?e:new Gn({lods:i,minZoom:s,maxZoom:n,minScale:o,maxScale:a,snapToZoom:r})}canZoomInTo(e){const i=this.effectiveMaxScale;return i===0||e>=i}canZoomOutTo(e){const i=this.effectiveMinScale;return i===0||e<=i}constrain(e,i){return this._zoom.constrain(e,i),this._rotation.constrain(e,i),this._geometry.constrain(e,i),this.customConstraints.forEach(s=>s.constrain(e,i)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(i=>{var s;return(s=i.applyPanConstraint)==null?void 0:s.call(i,e)}),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};l([h({readOnly:!0})],I.prototype,"effectiveLODs",null),l([h({readOnly:!0})],I.prototype,"effectiveMinScale",null),l([h({readOnly:!0})],I.prototype,"effectiveMaxScale",null),l([h({readOnly:!0})],I.prototype,"effectiveMinZoom",null),l([h({readOnly:!0})],I.prototype,"effectiveMaxZoom",null),l([h({types:Th,value:null})],I.prototype,"geometry",null),l([h({type:[qa]})],I.prototype,"lods",void 0),l([h()],I.prototype,"minScale",void 0),l([h()],I.prototype,"maxScale",void 0),l([h()],I.prototype,"minZoom",void 0),l([h()],I.prototype,"maxZoom",void 0),l([h()],I.prototype,"rotationEnabled",void 0),l([h()],I.prototype,"snapToZoom",void 0),l([h({type:D})],I.prototype,"customConstraints",void 0),l([h()],I.prototype,"view",void 0),l([h({readOnly:!0})],I.prototype,"version",null),l([h({type:Ae,readOnly:!0})],I.prototype,"_geometry",null),l([h({type:Zn})],I.prototype,"_rotation",null),l([h({readOnly:!0,type:Gn})],I.prototype,"_zoom",null),I=l([y("esri.views.2d.MapViewConstraints")],I);const Wn=I;let z=class extends M{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([w(()=>{var i;return(i=this.constraints)==null?void 0:i.version},i=>{this.constraints&&i&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},pt)])}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:i}=this.state.paddedViewState;return this.state.commitProperty("id"),new H({x:e[0],y:e[1],spatialReference:i})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let i;try{i=this._project(e,this.state.spatialReference)}catch(n){return void $.getLogger(this).error(new E("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:n}))}const s=this.viewpoint;hs(s,s,i),this.viewpoint=s}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void $.getLogger(this).error(new E("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let i;try{i=this._project(e,this.state.spatialReference)}catch(n){return void $.getLogger(this).error(new E("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:n}))}const s=this.viewpoint;Pa(s,s,i,this.state.size,{constraints:this.constraints}),this.viewpoint=s}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const i=this.viewpoint;Sa(i,i,e),this.viewpoint=i}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);const s=this._get("extent");return void(s&&(this._set("extent",void 0),this._set("center",s.center)))}const i=this.viewpoint;cs(i,i,e),this.viewpoint=i}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){var o;if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let i,s;try{i=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?s=new E("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(s=new E("mapview:invalid-viewpoint","geometry not defined"))}catch(a){s=new E("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:a})}if(s)return void $.getLogger(this).error(s);this._scaleBeforeChangingSpatialReference=null;const n=new Ee({targetGeometry:new H,scale:0,rotation:0});Pe(n,i),(o=this.constraints)==null||o.constrain(n,this.state.paddedViewState.viewpoint),this.state.viewpoint=n,this._set("viewpoint",n)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){var e;return this.ready?((e=this.constraints)==null?void 0:e.scaleToZoom(this.scale))??-1:this._get("zoom")}set zoom(e){var n,o;if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);const a=this._get("extent");return void(a&&(this._set("extent",void 0),this._set("center",a.center)))}const i=((n=this.constraints)==null?void 0:n.zoomToScale(e))??0;if(!i)return void this._set("zoom",-1);const s=this.viewpoint;cs(s,s,i),this.viewpoint=s,this._set("zoom",((o=this.constraints)==null?void 0:o.scaleToZoom(this.scale))??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:i,constraints:s}=this,n=this._get("center"),o=this._get("extent"),a=this._get("scale"),r=this._get("rotation"),c=this._get("viewpoint"),u=this._get("zoom"),p=u!=null&&s!=null&&s.zoomToScale(u)||void 0;let m,d,g;const R=c==null?void 0:c.rotation,v=c==null?void 0:c.targetGeometry;(v==null?void 0:v.type)==="extent"?m=v:(v==null?void 0:v.type)==="point"&&(d=v,g=c==null?void 0:c.scale);const C=o??m;return{center:n??d??(C==null?void 0:C.center),rotation:r??R,scale:(a??p??g??(C&&bn(C,[e[0]-i.left-i.right,e[1]-i.top-i.bottom])))||void 0}}startup(e,i,s,n){var a;const o=e.targetGeometry;try{this._project(e,s)}catch(r){$.getLogger(this).warn(new us("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:o.toJSON(),spatialReference:s,error:r})),e.targetGeometry=n||new H({x:0,y:0,spatialReference:s})}(a=this.constraints)==null||a.fit(e),this._set("state",new Xi({padding:this.padding,size:i,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[e,i],spatialReference:s,rotation:n,scale:o}=this.state.paddedViewState,a=new H({x:e,y:i,spatialReference:s});this._set("viewpoint",null),this._set("extent",null),this._set("center",a),this._set("zoom",-1),this._set("rotation",n),this._set("scale",o),this._set("state",null)}changeSpatialReference(e){var c;const i=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=i.scale;else{const u=i.viewpoint.clone();u.scale=this._scaleBeforeChangingSpatialReference,i.viewpoint=u}const s=i.clone(),[n,o]=i.center;let a=null;try{a=this._project(new H({x:n,y:o,spatialReference:i.spatialReference}),e)}catch(u){ka()||$.getLogger(this).warn(new us("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:a==null?void 0:a.toJSON(),spatialReference:e,error:u}))}a||(a=new H({x:0,y:0,spatialReference:e}));const r=hs(new Ee({targetGeometry:new H,scale:0,rotation:0}),i.viewpoint,a);s.viewpoint=r;try{const p=[i.size[0]/2,i.size[1]/2],m=[p[0]+20,p[1]],d=i.toMap([0,0],m),{x:g,y:R}=this._project(new H({x:d[0],y:d[1],spatialReference:i.spatialReference}),e);d[0]=g,d[1]=R,s.toScreen(d,d);const v=Ea(p,d,m),C=Math.hypot(d[0]-p[0],d[1]-p[1])/20;!Number.isFinite(C)||Math.abs(C)>4?(r.rotation=0,r.targetGeometry=new H({x:0,y:0,spatialReference:e})):(r.scale*=C,r.scale>V("mapview-srswitch-adjust-rotation-scale-threshold")?r.rotation=0:r.rotation+=Number.isFinite(v)?v:0)}catch{}(c=this._get("constraints"))==null||c.constrain(r,void 0),this._get("state").viewpoint=r}resize(e,i){var a;if(!this.ready)return;const s=this.state;let n=this.state.paddedViewState.viewpoint;const o=this.state.paddedViewState.size.slice();s.size=[e,i],$a(n,n,o,this.state.paddedViewState.size,this.resizeAlign),n=((a=this.constraints)==null?void 0:a.constrain(n,void 0))??n,this.state.viewpoint=n}toMap(e){if(!this.ready)return null;const i=[0,0],[s,n]=this.state.toMap(i,[e.x,e.y]),o=this.state.spatialReference;return new H({x:s,y:n,spatialReference:o})}toScreen(e,i){if(!this.ready)return null;const s=this._project(e,this.state.spatialReference),n=[s.x,s.y];return(i==null?void 0:i.pickClosestTarget)===!1||this.state.paddedViewState.wrapMapCoordinate(n,n),this.state.toScreen(n,n),A(n[0],n[1])}_project(e,i){var o;const s=(e==null?void 0:e.targetGeometry)||e;if(!i)return e;if(!s)return null;if(i.imageCoordinateSystem||(o=s.spatialReference)!=null&&o.imageCoordinateSystem||fn(i,s.spatialReference))return e;const n=Gi(s,i);if(!n)throw new E("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:s,spatialReference:i});return xh(e)?(e.targetGeometry=n,e):n}};function xh(t){return(t==null?void 0:t.declaredClass)==="esri.Viewpoint"}l([h({type:H})],z.prototype,"center",null),l([h()],z.prototype,"constraints",void 0),l([h({type:ft})],z.prototype,"extent",null),l([h({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],z.prototype,"padding",null),l([h()],z.prototype,"ready",void 0),l([h()],z.prototype,"resizeAlign",void 0),l([h({readOnly:!0})],z.prototype,"resolution",null),l([h({type:Number})],z.prototype,"rotation",null),l([h({type:Number})],z.prototype,"scale",null),l([h({readOnly:!0})],z.prototype,"state",void 0),l([h({type:Ee})],z.prototype,"viewpoint",null),l([h({readOnly:!0})],z.prototype,"visibleArea",null),l([h()],z.prototype,"zoom",null),z=l([y("esri.views.2d.ViewStateManager")],z);function Ji(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}let Fs=class extends L{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,s=>this._handleDoubleClick(s,i))}_handleDoubleClick(e,i){Ji(e.data,"primary")&&(e.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},Ph=class extends L{constructor(e,i,s){super(!0),this.view=e,this.pointerType=i,this.registerIncoming("double-tap-drag",s,n=>this._handleDoubleTapDrag(n))}_handleDoubleTapDrag(e){const{data:i}=e,{pointerType:s}=i;if(s!==this.pointerType)return;e.stopPropagation();const{action:n,delta:o}=i,{view:a}=this,{mapViewNavigation:r}=a;switch(n){case"begin":{const{scale:c}=a;this._startScale=c,this._currentScale=c,this._previousDelta=o,r.begin();break}case"update":{if(this._previousDelta.y===o.y)return;this._previousDelta=o;const c=1.015**o.y,u=this._startScale*c,p=u/this._currentScale;r.setViewpointImmediate(p),this._currentScale=u;break}case"end":{const{constraints:c}=a,{effectiveLODs:u,snapToZoom:p}=c;if(!p||!u)return void r.end();const m=c.snapScale(this._currentScale),d=(o.y>0?Math.max(m,c.snapToPreviousScale(this._startScale)):Math.min(m,c.snapToNextScale(this._startScale)))/this._currentScale;r.zoom(d).then(()=>{r.end()});break}}}},Qt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,s=i.pointers.size;switch(i.action){case"start":this._currentCount=s,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=s,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=s,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,s;this._startEvent=e,(s=(i=this._callbacks).condition)!=null&&s.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,s;(s=(i=this._callbacks).condition)!=null&&s.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,s;(s=(i=this._callbacks).condition)!=null&&s.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Sh=class extends L{constructor(e,i,s){super(!0),this.view=e,this.pointerAction=i,this.registerIncoming("drag",s,n=>this._handleDrag(n)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new Qt({start:(i,s)=>{this.view.mapViewNavigation.pan.begin(this.view,s.data),s.stopPropagation()},update:(i,s)=>{this.view.mapViewNavigation.pan.update(this.view,s.data),s.stopPropagation()},end:(i,s)=>{this.view.mapViewNavigation.pan.end(this.view,s.data),s.stopPropagation()},condition:(i,s)=>i===1&&Ji(s.data,this.pointerAction)})}_handleDrag(e){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},kh=class extends L{constructor(e,i,s){super(!0),this._view=e,this.pointerAction=i;const n=this._view.mapViewNavigation;this._dragEventSeparator=new Qt({start:(o,a)=>{n.rotate.begin(this._view,a.data),a.stopPropagation()},update:(o,a)=>{n.rotate.update(this._view,a.data),a.stopPropagation()},end:(o,a)=>{n.rotate.end(),a.stopPropagation()},condition:(o,a)=>o===1&&Ji(a.data,this.pointerAction)}),this.registerIncoming("drag",s,o=>this._dragEventSeparator.handle(o))}};function J(t){let e=t*t;return t<0&&(e*=-1),e}function Eh(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function $h(t,e,i){const s=i,n=t.state,o=t.device,a=e.tiltDirection==="forward-down"?1:-1,r=1;return o.deviceType==="standard"?(s.translation[0]=J(n.axes[0]),s.translation[1]=J(n.axes[1]),s.translation[2]=J(n.buttons[7])-J(n.buttons[6]),s.heading=J(n.axes[2]),s.tilt=J(n.axes[3])):o.deviceType==="spacemouse"&&(s.translation[0]=1.2*J(n.axes[0]),s.translation[1]=1.2*J(n.axes[1]),s.translation[2]=2*-J(n.axes[2]),s.heading=1.2*J(n.axes[5]),s.tilt=1.2*J(n.axes[3])),s.tilt*=a,dr(s.translation,s.translation,r),s}function Ch(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Ih=class extends L{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new mn,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([w(()=>{var i;return(i=this._view.navigation.gamepad)==null?void 0:i.enabled},i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=et({update:s=>this._frameUpdate(s.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Z)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const i=this._view.navigation.gamepad.device;i&&e.data.device!==i||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,Eh(this._transformation)):(this._currentDevice=e.data.device,$h(e.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(e){const i=this._transformation;if(Ch(i))return;const s=this._view.viewpoint.clone(),n=this._view.navigation.gamepad.velocityFactor,o=Rh*n*e;Ca(s,s,[i.translation[0]*o,-i.translation[1]*o]);const a=1+i.translation[2]*Lh*e,r=this._view.constraints.rotationEnabled?-i.heading*Dh*e:0,c=this._view.size,u=[c[0]/2,c[1]];Ia(s,s,a,r,u,c);const p=this._view.constraints.constrain(s,this._view.viewpoint);this._view.viewpoint=p}};const Dh=.06,Rh=.7,Lh=6e-4;function Un(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Kt(()=>document.removeEventListener("visibilitychange",e))}let Vh=class extends L{constructor(e,i,s){super(!0),this.view=e,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=n=>{const o=this._keyMap[n.data.key];if(n.modifiers.has("Meta")||n.modifiers.has("Control"))return void this._stopMovement();if(o==null)return;n.stopPropagation(),n.preventDefault();const a=n.type==="key-down";if(this._pressedKeys[a?"add":"delete"](o),a){if(this._direction===o)return;this._direction=o,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{const r=this._timeout===void 0,c=this._pressedKeys.size>0;r||c?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",s,this._handleKey),this.registerIncoming("key-up",s,this._handleKey),this.registerIncoming("blur",s,this._stopMovement),this._visibilityHandle=Un(n=>n?null:this._stopMovement())}onUninstall(){var e;this._stopMovement(),(e=this._visibilityHandle)==null||e.remove()}get _direction(){return this._currentDirection}set _direction(e){const i=this._currentDirection!=null;if(e!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==e)switch(e){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=e}_setTimeout(e){clearTimeout(this._timeout),this._timeout=e===void 0?void 0:setTimeout(()=>{this._timeout=void 0,e()},this._stickyKeyDuration)}},Oh=class extends L{constructor(e,i,s){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",s,n=>this._handleKeyDown(n)),this.registerIncoming("key-up",s,n=>this._handleKeyUp(n)),this.registerIncoming("blur",s,()=>this._handleStop()),this._visibilityHandle=Un(n=>n?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const s=e.modifiers;if(s.size>0&&!s.has("Shift")||!this.view.constraints.rotationEnabled)return;const n=this._keyToDirection[e.data.key];if(this._pressed=n!=null,this._pressed){if(e.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var Je;(function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"})(Je||(Je={}));let Ah=class extends L{constructor(e,i,s){super(!0),this.view=e,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",s,n=>this._handleKeyDown(n)),i.zoomIn.forEach(n=>this._keysToZoomAction[n]=Je.IN),i.zoomOut.forEach(n=>this._keysToZoomAction[n]=Je.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const i=e.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:s}=e.data;if(!(s in this._keysToZoomAction))return;const n=this._keysToZoomAction[s],{mapViewNavigation:o}=this.view;let a=null;switch(n){case Je.IN:a=o.zoomIn();break;case Je.OUT:a=o.zoomOut();break;default:return}o.begin(),a.then(()=>o.end()),e.stopPropagation()}};const zh=.6;let Nh=class extends L{constructor(e,i){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,s=>this._handleMouseWheel(s))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:s,y:n,deltaY:o}=e.data,a=1/zh**(1/60*o),r=i.zoom(a,[s,n]);r&&(this._canZoom=!1,r.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}},Fh=class extends L{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new Qt({start:(s,n)=>{i.pinch.begin(this.view,n.data),n.stopPropagation()},update:(s,n)=>{i.pinch.update(this.view,n.data),n.stopPropagation()},end:(s,n)=>{i.pinch.end(this.view),n.stopPropagation()},condition:s=>s>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function Hs(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>Gh(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Hh(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Zh(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Gh(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let Wh=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=o=>{this._connectGamepad(o.gamepad)},this._onDisconnectGamepad=o=>{const a=o.gamepad,r=a.index,c=this._inputDevices[r];c&&(this._emitGamepadEvent(a,Hs(c),!1),this._inputDevices.splice(r,1),this._latestUpdate.splice(r,1),this._input.gamepad.devices.remove(c),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const s="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=s&&n,this.supported&&(Zs(o=>this._connectGamepad(o)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new Yi(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=et({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),s=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;Zs(n=>{const o=this._inputDevices[n.index];if(!o)return;const a=this._latestUpdate[n.index],r=Hs(o),c=s||Zh(r);a&&(a.timestamp===n.timestamp||!a.active&&c||Hh(a.state,r))||this._emitGamepadEvent(n,r,!c)})}_emitGamepadEvent(e,i,s){const n=this._latestUpdate[e.index],o=n&&n.active;if(!o&&!s)return;const a=!o&&s?"start":o&&s?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:s},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:a})}};function Uh(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function Zs(t){for(const e of navigator.getGamepads())Uh(e)&&t(e)}const Gs=V("edge"),jh=V("chrome"),qh=V("ff"),Bh=V("safari"),Ws="esri-view-surface",We={touchNone:`${Ws}--touch-none`,touchPan:`${Ws}--touch-pan`};let jn=class qn{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Wh(e,this._input),this._gamepadSource.onEvent=s=>this._callback("gamepad",s)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=X(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const s=this._active[i];this._element.removeEventListener(_i[i],s),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&_i[i]){const s=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(_i[i],s),this._active[i]=s}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?We.touchNone:We.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?We.touchPan:We.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(We.touchNone),this._element.classList.remove(We.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const s=Cn(this._element,e);return qn.test.disableSubpixelCoordinates&&(s.x=Math.round(s.x),s.y=Math.round(s.y)),i.x=s.x,i.y=s.y,i}_handleKey(e,i){const{key:s}=i;s&&e==="key-up"&&this._keyDownState.delete(s);const n={native:i,key:s,repeat:!!s&&this._keyDownState.has(s)};s&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,i){const s=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,s)}_handlePointerPreventDefault(e,i){const s=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,s)}_getDeltaFromTrackpadOrMouseWheel(e){return e.shiftKey&&V("mac")&&e.deltaY===0?e.deltaX:e.deltaY}_handleMouseWheel(e,i){let s=this._getDeltaFromTrackpadOrMouseWheel(i);switch(i.deltaMode){case 0:Gs&&(s=s/document.documentElement.clientHeight*600);break;case 1:s*=30;break;case 2:s*=900}Gs?s*=.7:jh||Bh?s*=.6:qh&&(s*=1.375);const n=100,o=Math.abs(s);o>n&&(s=s/o*200/(1+Math.exp(-.02*(o-n))));const a=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:s});this._callback(e,a)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const s={native:i};i.preventDefault(),this._callback(e,s)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};jn.test={disableSubpixelCoordinates:!1};const _i={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Kh=class extends L{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const O={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Wt(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Yh(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}function Xh(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:A()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[P,T]=t,[N,j]=[T.x-P.x,T.y-P.y];return e.radius=Math.sqrt(N*N+j*j)/2,e.center.x=(P.x+T.x)/2,e.center.y=(P.y+T.y)/2,e}let i=0,s=0;for(let P=0;P<t.length;P++)i+=t[P].x,s+=t[P].y;i/=t.length,s/=t.length;const n=t.map(P=>P.x-i),o=t.map(P=>P.y-s);let a=0,r=0,c=0,u=0,p=0,m=0,d=0;for(let P=0;P<n.length;P++){const T=n[P],N=o[P],j=T*T,re=N*N;a+=j,r+=re,c+=T*N,u+=j*T,p+=re*N,m+=T*re,d+=N*j}const g=.5*(u+m),R=.5*(p+d),v=a*r-c*c,C=(g*r-R*c)/v,k=(a*R-c*g)/v,te=A(C+i,k+s);return{radius:Math.sqrt(C*C+k*k+(a+r)/t.length),center:te}}function ze(t){const{native:e}=t,{pointerId:i,button:s,pointerType:n}=e;return n==="mouse"?`${i}:${s}`:`${n}`}let Jh=class extends L{constructor(e=O.maximumDoubleClickDelay,i=O.maximumDoubleClickDistance,s=O.maximumDoubleTouchDelay,n=O.maximumDoubleTouchDistance,o=gt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=s,this._maximumDoubleTouchDistance=n,this._clock=o,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=A(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new Qt({start:(a,r)=>this._dragStart(a,r),update:(a,r)=>this._dragUpdate(r),end:(a,r)=>this._dragEnd(r)}),this.registerIncoming("drag",a=>this._dragEventSeparator.handle(a)),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=ee(e.doubleTapTimeout)})}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(e){const i=this._pointerState.get(e);i&&(i.doubleTapTimeout=ee(i.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_dragStart(e,i){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:s,modifiers:n}=i,{center:o}=s;this._dragStartCenter=o;const a=yi("begin",A(0,0),s);this._doubleTapDrag.emit(a,void 0,n),i.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:s}=e,{center:n}=i,o=yi("update",A(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(o,void 0,s),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:s}=e,{center:n}=i,o=yi("end",A(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(o,void 0,s),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:i}=e,s=ze(i),n=this._pointerState.get(s),{pointerType:o}=i.native;if(n){const a=o==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(s),Wt(n.event.data,i)>a?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:i}=e,{pointerType:s}=i.native,n=ze(i),o=s==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._clearPointerDown(n),o);this._pointerState.set(n,{event:e,doubleTapTimeout:a}),this.refreshHasPendingInputs()}};function yi(t,e,i){const{button:s,buttons:n,pointer:o,pointers:a,pointerType:r,timestamp:c}=i;return{action:t,delta:e,button:s,buttons:n,pointer:o,pointers:a,pointerType:r,timestamp:c}}let Qh=class extends L{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,s,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:ec(this._activePointerMap),pointer:i,angle:s.angle,radius:s.radius,center:s.center}}_addPointer(e){const i=e.native.pointerId,s=St(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);const o=Ot(n,Bn(this._activePointerMap));n.initialAngle=o,n.lastAngle=o,this._updatePointerAngles(s)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,s=this._activePointerMap.get(i);s?s.event=e:this._addPointer(e)}_removePointer(e){const i=St(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=St(this._activePointerMap);this._activePointerMap.forEach(s=>{s.initialAngle=Ot(s,i)-e,s.lastAngle=Ot(s,i)-e})}_emitEvent(e,i,s){const n=St(this._activePointerMap);this._drag.emit(this._createPayload(e,i,n,s),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,s=Q(e.timestamp);this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,s),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,Q(e.timestamp))))}_handlePointerDrag(e){const i=e.data,s=i.currentEvent,n=Q(e.timestamp);switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(s.native.pointerId)?(this._updatePointer(s),!this._isCurrentDragSuppressed&&this._emitEvent("update",s,n)):(this._addPointer(s),this._emitEvent("added",s,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(s),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",s,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function Bn(t){const e=[];return t.forEach(i=>{e.push(A(i.event.x,i.event.y))}),Xh(e)}function St(t){const e=Bn(t);let i=0;return t.forEach(s=>{let n=Ot(s,e),o=n-s.lastAngle;for(;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;n=s.lastAngle+o,s.lastAngle=n;const a=n-s.initialAngle;i+=a}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function ec(t){const e=new Map;return t.forEach((i,s)=>e.set(s,i.event)),e}function Ot(t,e){const i=t.event,s=i.x-e.center.x,n=i.y-e.center.y;return Math.atan2(n,s)}var Us;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Us||(Us={}));let tc=class extends L{constructor(e=O.maximumDoubleClickDelay,i=O.maximumDoubleClickDistance,s=O.maximumDoubleTouchDelay,n=O.maximumDoubleTouchDistance,o=gt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=s,this._maximumDoubleTouchDistance=n,this._clock=o,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,s=ze(i);if(!this._pointerState.has(s)){const n={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(s,n),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,s=ze(i),n=this._pointerState.get(s);if(n&&n.downButton===i.native.button){const o=n.immediateDoubleClick,a=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;o?(o.timeoutHandle.remove(),Wt(o,e.data)>a?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,o.modifiers),this._removeState(i))):Wt(n,e.data)>a?this._removeState(i):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,i){const s=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),s)}}_removeState(e){const i=ze(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},ic=class extends L{constructor(e=O.maximumClickDelay,i=O.movementUntilMouseDrag,s=O.movementUntilPenDrag,n=O.movementUntilTouchDrag,o=O.holdDelay,a=gt){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=s,this._movementUntilTouchDrag=n,this._holdDelay=o,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",r=>this._handlePointerDown(r)),this.registerIncoming("pointer-up",r=>this._handlePointerLoss(r,"pointer-up")),this.registerIncoming("pointer-capture-lost",r=>this._handlePointerLoss(r,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",r=>this._handlePointerLoss(r,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",r=>this._handlePointerMove(r)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=ee(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,s=i.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const a=this._pointerState.get(s);if(a){if(!a.isDragging){const r=a.previousEvent;this._pointerHold.emit(r,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._holdDelay));const o={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(s,o),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.isDragging?this._pointerDrag.emit(kt("update",n,i),void 0,n.modifiers):Yh(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),n.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,s=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,s===n.startEvent.native.pointerId?this._pointerDrag.emit(kt("start",n,i)):this._pointerDrag.emit(kt("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const s=e.data,n=s.native.pointerId,o=this._pointerState.get(n);o&&(o.holdTimeout!=null&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging?this._pointerDrag.emit(kt("end",o,i==="pointer-up"?s:o.previousEvent),void 0,o.modifiers):i==="pointer-up"&&o.downButton===s.native.button&&e.timestamp-o.startTimestamp<=this._maximumClickDelay&&!o.holdEmitted&&this._immediateClick.emit(s),this._pointerState.delete(n),this.stopCapturingPointer(s.native),this._pointerState.size===0&&this._moveHandle.pause())}};function kt(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let sc=class extends L{constructor(e=O.maximumDoubleClickDelay,i=O.maximumDoubleClickDistance,s=O.maximumDoubleTouchDelay,n=O.maximumDoubleTouchDistance,o=gt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=s,this._maximumDoubleTouchDistance=n,this._clock=o,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",a=>this._handleImmediateClick(a)),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=ee(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,i){const s=this._pointerState.get(e);s&&(s.doubleClickTimer=ee(s.doubleClickTimer),i&&this._click.emit(s.event.data,void 0,s.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:s}=i.native,n=nc(i);if(!this._pointerState.has(n))return void this._startClick(e);const o=this._pointerState.get(n),{data:a,modifiers:r}=o.event,c=s==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Wt(a,i)>c?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),o.pointerDownCount===2&&this._doubleClick.emit(a,void 0,r))}_handlePointerDown(e){const i=ze(e.data),s=this._pointerState.get(i);s&&(s.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:s}}=i,n=ze(i),o=s==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),o);this._pointerState.set(n,{event:e,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}};function nc(t){const{pointerId:e,pointerType:i,button:s}=t.native;return i==="mouse"?`${e}:${s}`:`${i}`}const Et={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let Re=class extends M{initialize(){const t=()=>{var e;return(e=this.view)==null?void 0:e.ready};this.addHandles([dt(()=>!t(),()=>this._disconnect()),dt(t,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){var t;return(t=this._inputManager)==null?void 0:t.latestPointerType}get latestPointerLocation(){var t;return(t=this._inputManager)==null?void 0:t.latestPointerLocation}get multiTouchActive(){var t;return((t=this._inputManager)==null?void 0:t.multiTouchActive)??!1}isModifierKeyDown(t){var e;return((e=this._inputManager)==null?void 0:e.isModifierKeyDown(t))??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=X(this._inputManager)}_connect(){const t=this.view.surface,e=new jn(t,this.view.input),i=[new tc,new ic,new sc,new Qh(this.view.navigation),new Jh],s=new K({eventSource:e,recognizers:i});s.installHandlers("prevent-context-menu",[new Kh],ke.INTERNAL),s.installHandlers("navigation",[new Fh(this.view),new Ih(this.view),new Nh(this.view),new Fs(this.view),new Fs(this.view,[Et.counter]),new Sh(this.view,"primary"),new Vh(this.view,Et.pan),new Ah(this.view,Et.zoom),new Oh(this.view,Et.rotate),new kh(this.view,"secondary"),new Ph(this.view,"touch")],ke.INTERNAL),this.view.viewEvents.connect(s),this._source=e,this._inputManager=s,w(()=>{var n,o;return(o=(n=this.view)==null?void 0:n.navigation)==null?void 0:o.browserTouchPanEnabled},n=>{this._source&&(this._source.browserTouchPanningEnabled=!n)},Z)}get test(){}};l([h()],Re.prototype,"view",void 0),l([h()],Re.prototype,"latestPointerType",null),l([h()],Re.prototype,"latestPointerLocation",null),l([h()],Re.prototype,"multiTouchActive",null),Re=l([y("esri.views.2d.input.MapViewInputManager")],Re);const oc=Re,Ce={added:[],removed:[]},vi=new Set,ac=new pr(0,0,0,0);function rc(t,e){const i=La(e);if(!i)return null;const[s,n]=i.valid;return t[2]>n?[Mt([t[0],t[1],n,t[3]]),Mt([s,t[1],s+t[2]-n,t[3]])]:t[0]<s?[Mt([s,t[1],t[2],t[3]]),Mt([n-(s-t[0]),t[1],n,t[3]])]:null}let lc=class extends Bt{constructor(e){super(),this._tiles=new Map,this._index=hr(9,V("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}getIntersectingTiles(e){if(!e||Da(e)===0||Ra(e)===0)return[];const i=rc(e,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const i={added:[],removed:[]};for(const s of e.added)if(!this.has(s)){const n=new ys(this.tileScheme,s);this._tiles.set(s,n),this._index.insert(n),i.added.push(n)}for(const s of e.removed)if(this.has(s)){const n=this.get(s);this._tiles.delete(s),this._index.remove(n),i.removed.push(n)}this.tiles.length=0,this._tiles.forEach(s=>this.tiles.push(s)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(e){const i=this.tileScheme.getTileCoverage(e,0);if(!i)return;const{spans:s,lodInfo:n}=i,{level:o}=n;if(s.length>0)for(const{row:a,colFrom:r,colTo:c}of s)for(let u=r;u<=c;u++){const p=ac.set(o,a,n.normalizeCol(u),n.getWorldForColumn(u)).id;if(vi.add(p),!this.has(p)){const m=new ys(this.tileScheme,p);this._tiles.set(p,m),this._index.insert(m),this.tiles.push(m),Ce.added.push(m)}}for(let a=this.tiles.length-1;a>=0;a--){const r=this.tiles[a];vi.has(r.id)||(this._tiles.delete(r.id),this.tiles.splice(a,1),this._index.remove(r),Ce.removed.push(r))}(Ce.added.length||Ce.removed.length)&&this.emit("update",Ce),cr.pool.release(i),vi.clear(),Ce.added.length=0,Ce.removed.length=0}};const hc=1,Xp=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],Jp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],nt=256,cc=new _e("cyan"),uc=1,pc=.25;new _e("black");const dc="default",mc="temporary",gc=new _e("yellow");let Le=class extends M{constructor(e){super(e),this.color=cc.clone(),this.haloOpacity=uc,this.fillOpacity=pc}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity}};l([h({type:_e})],Le.prototype,"color",void 0),l([h({type:_e})],Le.prototype,"haloColor",void 0),l([h()],Le.prototype,"haloOpacity",void 0),l([h()],Le.prototype,"fillOpacity",void 0),Le=l([y("esri.views.support.HighlightOptions")],Le);const fc=Le;var zi;let ct=zi=class extends fc{constructor(t){super(t),this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(t){return super.equals(t)&&this.haloWidth===t.haloWidth&&this.haloBlur===t.haloBlur}get optionsKey(){return`${this.color};${this.haloColor};${this.haloOpacity};${this.fillOpacity};${this.haloWidth};${this.haloBlur}`}clone(){var t;return new zi({color:this.color.clone(),haloColor:(t=this.haloColor)==null?void 0:t.clone(),haloOpacity:this.haloOpacity,fillOpacity:this.fillOpacity,haloWidth:this.haloWidth,haloBlur:this.haloBlur})}};l([h()],ct.prototype,"haloWidth",void 0),l([h()],ct.prototype,"haloBlur",void 0),ct=zi=l([y("esri.views.2d.support.HighlightOptions")],ct);const Ne=ct,wi=()=>$.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function _c(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=(1-t.haloBlur)*t.haloWidth,e.outerHaloWidth=t.haloBlur*t.haloWidth/2,e.innerHaloWidth=t.haloBlur*t.haloWidth/2,e.outlinePosition=0}const yc=[0,0,0,0];let Kn=class{constructor(){this.type="single",this._highlightOptions=new Ne,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*nt),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,i){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,mr),i.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){var e;(e=this._shadeTex)==null||e.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<gr)-1,activeGradient:this}]}_updateGradientTexture(e){const{optionsKey:i}=this._highlightOptions;if(i===this._optionsShadeTexKey)return;this._optionsShadeTexKey=i,_c(this._highlightOptions,this._convertedHighlightOptions);const s=this._convertedHighlightOptions,n=s.outlinePosition-s.outlineWidth/2-s.outerHaloWidth,o=s.outlinePosition-s.outlineWidth/2,a=s.outlinePosition+s.outlineWidth/2,r=s.outlinePosition+s.outlineWidth/2+s.innerHaloWidth,c=Math.sqrt(Math.PI/2)*hc,u=Math.abs(n)>c?Math.round(10*(Math.abs(n)-c))/10:0,p=Math.abs(r)>c?Math.round(10*(Math.abs(r)-c))/10:0;let m;u&&!p?wi().error("The outer rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!u&&p?wi().error("The inner rim of the highlight is "+p+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):u&&p&&wi().error("The highlight is "+Math.max(u,p)+"px away from the edge of the feature; consider reducing some width values.");const d=[void 0,void 0,void 0,void 0];function g(v,C,k){d[0]=(1-k)*v[0]+k*C[0],d[1]=(1-k)*v[1]+k*C[1],d[2]=(1-k)*v[2]+k*C[2],d[3]=(1-k)*v[3]+k*C[3]}const{_texelData:R}=this;for(let v=0;v<nt;++v)m=n+v/(nt-1)*(r-n),m<n?(d[0]=0,d[1]=0,d[2]=0,d[3]=0):m<o?g(yc,s.outlineColor,(m-n)/(o-n)):m<a?[d[0],d[1],d[2],d[3]]=s.outlineColor:m<r?g(s.outlineColor,s.fillColor,(m-a)/(r-a)):[d[0],d[1],d[2],d[3]]=s.fillColor,R[4*v]=255*d[0],R[4*v+1]=255*d[1],R[4*v+2]=255*d[2],R[4*v+3]=255*d[3];if(this._minMaxDistance[0]=n,this._minMaxDistance[1]=r,!this._shadeTex){const v=new yr;v.wrapMode=fr.CLAMP_TO_EDGE,v.width=nt,v.height=1,this._shadeTex=new vr(e,v)}this._shadeTex.updateData(0,0,0,nt,1,this._texelData)}},vc=class{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let i=0;i<e.length;i++)this.gradients[i]||(this.gradients[i]=new Kn),this.gradients[i].setHighlightOptions(e[i].options);for(let i=e.length+1;i<this.gradients.length;i++)this.gradients[i].destroy();this.gradients.length=e.length}destroy(){for(const e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1;const i=[];for(let s=0;s<this.gradients.length;s++){const n=this.gradients[s];i.push({activeReasons:e,activeGradient:n}),e<<=1}return i}};var js,qs,Bs,Ks,Ys,Xs,Ut,Js,Qs;(function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT",t[t.LABEL=4]="LABEL"})(js||(js={})),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LABEL=2]="LABEL",t[t.LABEL_ALPHA=4]="LABEL_ALPHA",t[t.HITTEST=8]="HITTEST",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.CLIP=32]="CLIP",t[t.DEBUG=64]="DEBUG",t[t.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(qs||(qs={})),function(t){t[t.SIZE=0]="SIZE",t[t.COLOR=1]="COLOR",t[t.OPACITY=2]="OPACITY",t[t.ROTATION=3]="ROTATION"}(Bs||(Bs={})),function(t){t[t.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",t[t.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",t[t.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",t[t.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(Ks||(Ks={})),function(t){t[t.SPRITE=0]="SPRITE",t[t.GLYPH=1]="GLYPH"}(Ys||(Ys={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SIMPLE=1]="SIMPLE",t[t.DOT_DENSITY=2]="DOT_DENSITY",t[t.OUTLINE_FILL=3]="OUTLINE_FILL",t[t.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",t[t.HEATMAP=5]="HEATMAP",t[t.PIE_CHART=6]="PIE_CHART"}(Xs||(Xs={})),function(t){t[t.All=0]="All",t[t.Highlight=1]="Highlight",t[t.InsideEffect=2]="InsideEffect",t[t.OutsideEffect=3]="OutsideEffect"}(Ut||(Ut={})),function(t){t[t.BATCHING=0]="BATCHING",t[t.STRICT_ORDER=1]="STRICT_ORDER",t[t.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(Js||(Js={})),function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT"}(Qs||(Qs={}));const Yn={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:_r.EQUAL,mask:255,op:{fail:ri.KEEP,zFail:ri.KEEP,zPass:ri.REPLACE}}}},wc={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},bc={...Yn,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function Mc({pixelRatio:t,state:e,displayLevel:i,requiredLevel:s},n){const o=1/2**(i-n.key.level),a=1/2**(s-n.key.level);return{displayMat3:e.displayMat3,displayViewMat3:e.displayViewMat3,displayViewScreenMat3:n.transforms.displayViewScreenMat3,viewMat3:e.viewMat3,tileMat3:n.transforms.tileMat3,displayZoomFactor:o,requiredZoomFactor:a,tileOffset:[n.x,n.y],currentScale:e.scale,currentZoom:i,metersPerSRUnit:Va(e.spatialReference),rotation:e.rotation,pixelRatio:t}}function Xn(t){var e;return((e=t.passOptions)==null?void 0:e.type)==="highlight"}function Jn(t){var e;return((e=t.passOptions)==null?void 0:e.type)==="hittest"}function Tc(t){if(!Jn(t))return null;const{position:e,distance:i,smallSymbolDistance:s,smallSymbolSizeThreshold:n}=t.passOptions;return{position:e,distance:i,smallSymbolDistance:s,smallSymbolSizeThreshold:n}}function xc(t){if(!Xn(t))return null;const{activeReasons:e,highlightAll:i}=t.passOptions;return{activeReasons:e,highlightAll:i?1:0}}function id(t,e,i){const s={};for(const n in i)i[n]instanceof Function?s[n]=i[n](t,e):s[n]=i[n];return s}function sd(t,e){const{attributeView:i,context:s}=t;return{storage:i.getUniforms(s),view:Mc(t,e),hittestRequest:Tc(t),highlight:xc(t)}}function nd(t){return{inside:t.selection===Ut.InsideEffect,outside:t.selection===Ut.OutsideEffect}}function Pc(t){return Jn(t)?wc:Xn(t)&&t.passOptions.stepType==="clear"?bc:Yn}function od(t){const{row:e,col:i}=t.key,s=i*vs,n=e*vs;return{tileOffsetFromLocalOrigin:[s%Tt,n%Tt],maxIntsToLocalOrigin:[Math.floor(s/Tt),Math.floor(n/Tt)]}}const Sc=new Oa({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function ad(t){return Sc.toJSON(t)}function rd(t){const{bandCount:e,attributeTable:i,colormap:s,pixelType:n}=t.raster.rasterInfo;return e===1&&(i!=null||s!=null||n==="u8"||n==="s8")}function kc(t,e){return e==null?(t==null||t.destroy(),null):((t==null?void 0:t.type)==="single"&&Array.isArray(e)&&(t.destroy(),t=null),(t==null?void 0:t.type)!=="multi"||Array.isArray(e)||(t.destroy(),t=null),t||(t=Array.isArray(e)?new vc:new Kn),Array.isArray(e)?t.type==="multi"&&t.setHighlightOptions(e):t.type==="single"&&t.setHighlightOptions(e),t)}function ld(t,e,i,s){const{painter:n,highlightGradient:o}=t,{highlight:a}=n.effects;if(!o)return;const r=t.passOptions,c=o.getReasonsWithGradients();for(let u=0;u<c.length;u++){const p={...t,passOptions:{type:"highlight",activeGradient:s!=null?c[s].activeGradient:c[u].activeGradient,activeReasons:c[u].activeReasons,stepType:"burn",highlightAll:e}};if(a.bind(p),i(p),u<c.length-1){let d=0;for(let g=u+1;g<c.length;g++)d|=c[g].activeReasons;i({...t,passOptions:{type:"highlight",activeGradient:s!=null?c[s].activeGradient:c[u].activeGradient,activeReasons:d,stepType:"clear",highlightAll:e}})}const m={...t,passOptions:{type:"highlight",activeGradient:s!=null?c[s].activeGradient:c[u].activeGradient,activeReasons:c[u].activeReasons,stepType:"draw",highlightAll:e}};n.setPipelineState(Pc(t)),n.updatePipelineState(t.context),a.draw(m),a.unbind()}t.passOptions=r}const $t=t=>parseFloat(t)/100;function Ec(t,e,i){const s=typeof t.left=="string"?$t(t.left)*e:t.left,n=typeof t.right=="string"?$t(t.right)*e:t.right,o=typeof t.top=="string"?$t(t.top)*i:t.top,a=typeof t.bottom=="string"?$t(t.bottom)*i:t.bottom,r=o;return{xmin:s,xmax:Math.max(e-n,s),ymin:r,ymax:Math.max(i-a,o)}}function Qn(t,e,i,s){switch(e.type){case"rect":{const{width:n,height:o}=t,{xmin:a,xmax:r,ymin:c,ymax:u}=Ec(e,n,o),{x:p,y:m}=i;return p>a&&p<r&&m>c&&m<u}case"path":return e.path.length===0||!Array.isArray(e.path[0][0])||Aa(e.path,[i.x,i.y]);case"geometry":return e.geometry==null||(e.geometry.type==="polygon"?vn(e.geometry,s):ji(e.geometry,s))}}var Ni;let Qe=Ni=class extends M{constructor(...t){super(...t),this.name="default",this.options=new Ne}clone(){return new Ni({name:this.name,options:this.options.clone()})}};l([h({type:String})],Qe.prototype,"name",void 0),l([h({type:Ne})],Qe.prototype,"options",void 0),Qe=Ni=l([y("esri.views.2d.support.HighlightGroup")],Qe);const eo=D.ofType(Qe);function to(){return new eo([{name:dc,options:new Ne},{name:mc,options:new Ne({color:gc})}])}to().items.map(t=>t.name);function $c(t){if(!t.highlights)return null;const e=t.highlights.findIndex(i=>i.name==="default");return e===-1?null:t.highlights.items[e].options}function Cc(t,e){if(!t.highlights){if(!e)return;t.highlights=new eo([{name:"default",options:new Ne}])}const i=t.highlights.findIndex(s=>s.name==="default");e?t.highlights.items[i].options=e:t.highlights.removeAt(i)}async function Ic(t,e,i){const s=Dn(e)?In(t,e):e;if(!t.ready||isNaN(s.x)||isNaN(s.y))return{screenPoint:s,results:[]};let n=new Set;const o=new Set;let a=!1,r=null,c=null;i!=null&&i.include?tn(i.include,en(t,d=>{n.add(d),bi(d,g=>o.add(g))},(d,g)=>{o.add(d),n.add(g)},d=>{r||(r=new Set),r.add(d)},d=>n.add(d),()=>a=!0)):(a=!0,n=new Set(t.allLayerViews),n.forEach(d=>{bi(d,g=>o.add(g))})),i!=null&&i.exclude&&tn(i.exclude,en(t,d=>{n.delete(d),bi(d,g=>o.delete(g))},d=>o.delete(d),d=>{c||(c=new Set),c.add(d)}));const u=t.toMap(s),p=t.allLayerViews.filter(d=>!d.suspended&&n.has(d)&&d.clips.every(g=>Qn(t,g,s,u))).reverse();let m=[...a?t.graphicsView.hitTest(u).map(d=>({type:"graphic",graphic:d,layer:null,mapPoint:u})):[],...await Promise.all(p.map(d=>d.hitTest(u,s)).toArray())].filter(Ht).flat().filter(Ht);return m=m.filter(d=>{var g;return d.type!=="graphic"||((g=d.layer)==null?void 0:g.type)!=="subtype-group"||o.has(d.graphic.layer)}),r&&(m=m.filter(d=>!("graphic"in d)||!d.graphic||(r==null?void 0:r.has(Fi(d.graphic))))),c&&(m=m.filter(d=>!("graphic"in d)||!d.graphic||!(c!=null&&c.has(Fi(d.graphic))))),{screenPoint:s,results:m}}function en(t,e,i,s,n,o){return a=>{if(a instanceof za){if(a.layer===t)o==null||o();else{const r=t.allLayerViews.find(c=>c.layer===a.layer);r&&(n==null||n(r))}s(Fi(a))}else if(!("layer"in a&&"element"in a))if(a.type==="subtype-sublayer"){const r=t.allLayerViews.find(c=>c.layer===a.parent);r&&i(a,r)}else{const r=t.allLayerViews.find(c=>c.layer===a);r&&e(r)}}}function tn(t,e){if(t)if(ps(t))for(const i of t)if(ps(i))for(const s of i)e(s);else e(i);else e(t)}function Fi(t){var i,s;const e=t.getObjectId();return e?`${((i=t.layer)==null?void 0:i.uid)??((s=t.sourceLayer)==null?void 0:s.uid)??"MapView"}/${e}`:`"MapView/${t.uid}`}function bi({layer:t},e){(t==null?void 0:t.type)==="subtype-group"&&t.sublayers.forEach(i=>{e(i)})}function io(t,e,i){const{ctx:s,canvas:n}=no(t,i),o=s.getImageData(0,0,t.width,t.height),a=ao(n,e);return oo(n),{dataUrl:a,data:o}}function so(t,e){const{ctx:i,canvas:s}=no(t,e),n=i.getImageData(0,0,t.width,t.height);return oo(s),n}function no(t,e){const i=Dc();e.premultipliedAlpha&&Oc(t),i.width=t.width,i.height=t.height;const s=i.getContext("2d",{willReadFrequently:!0});return s.putImageData(t,0,0),e.flipY&&Vc(s),{ctx:s,canvas:i}}function oo(t){t.width=0,t.height=0}function Dc(){return Mi==null&&(Mi=document.createElement("canvas")),Mi}let Mi=null;function ao(t,e){const i=Ac[e.format],s=e.quality/100;return t.toDataURL(i,s)}function ro(t,e){const i=Lc(t),s=Nc[i];return{format:i,quality:Pi(e??s,0,100)}}function lo(t,e){return e/Math.max(t[0],t[1])}function Rc(t,e,i,s=0,n=0,o=t.width-s,a=t.height-n,r=!1){const{data:c}=t,{width:u,height:p,data:m}=e,d=o/u,g=a/p,R=Math.ceil(d/2),v=Math.ceil(g/2),C=t.width;for(let k=0;k<p;k++)for(let te=0;te<u;te++){const P=4*(te+(r?p-k-1:k)*u);let T=0,N=0,j=0,re=0,Qi=0,es=0;const So=(k+.5)*g;for(let yt=Math.floor(k*g);yt<(k+1)*g;yt++){const ts=Math.abs(So-(yt+.5))/v,ko=(te+.5)*d,Eo=ts*ts;for(let vt=Math.floor(te*d);vt<(te+1)*d;vt++){const is=Math.abs(ko-(vt+.5))/R,Fe=Math.sqrt(Eo+is*is);if(Fe>=1)continue;let ye=2*Fe*Fe*Fe-3*Fe*Fe+1;const He=4*(s+vt+(n+yt)*C);es+=ye*c[He+3],N+=ye,!i&&c[He+3]<255&&(ye=ye*c[He+3]/255),j+=ye*c[He],re+=ye*c[He+1],Qi+=ye*c[He+2],T+=ye}}m[P]=j/T,m[P+1]=re/T,m[P+2]=Qi/T,m[P+3]=es/N}return e}function Lc(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return zc}}function Vc(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Oc(t){const e=t.data,i=e.length;for(let s=0;s<i;s+=4){const n=e[s+3];if(n!==255&&n>0){const o=255/n;e[s]=e[s]*o,e[s+1]=e[s+1]*o,e[s+2]=e[s+2]*o}}}const Ac={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},sn=98,zc="png",Nc={png:100,jpg:sn,jpeg:sn},hd=Object.freeze(Object.defineProperty({__proto__:null,createEmptyImageData:wr,encode:io,encodeData:so,getFormatAndQuality:ro,getMaximumResolutionScale:lo,resampleHermite:Rc,toDataUrl:ao},Symbol.toStringTag,{value:"Module"})),ho={flipY:!0,premultipliedAlpha:!0};async function Fc(t,e){const i=await co(t,e),{format:s,quality:n}=ro(e==null?void 0:e.format,e==null?void 0:e.quality);return io(i,{format:s,quality:n},ho)}async function Hc(t,e){const i=await co(t,e);return so(i,ho)}function co(t,e){const i=Wc(e||{},Gc(t.stage,t.size),t.size,t.padding),s=Zc(e,t.allLayerViews);return t.stage.takeScreenshot(i,s,t.backgroundColor,e==null?void 0:e.rotation)}function Zc(t={},e){if(!t.layers)return;const i=[];return t.layers.forEach(s=>{const n=e.find(o=>o.layer.id===s.id);n!=null&&n.container&&i.push(n.container)}),i}function Gc(t,e){return Math.min(4,lo(e,Math.min(4096,t.context.parameters.maxTextureSize)))}function Wc(t,e,i,s){t.ignorePadding&&(s={left:0,right:0,top:0,bottom:0});let n=null;t.width!=null&&t.height!=null?n=[t.width,t.height]:t.width==null&&t.height!=null?n=[t.height,t.height]:t.width!=null&&t.height==null?n=[t.width,t.width]:t.width==null&&t.height==null&&(n=null);const o=i[0]-(s.left+s.right),a=i[1]-(s.top+s.bottom);let r,c,u=t.area||{x:0,y:0,width:o,height:a};if(n){const p=o/a,m=n[0]/n[1];if(m>p){const d=u.width/m;u={x:u.x,y:Math.round(u.y+(u.height-d)/2),width:u.width,height:Math.round(d)}}else{const d=u.height*m;u={x:Math.round(u.x+(u.width-d)/2),y:u.y,width:Math.round(d),height:u.height}}}else n=[u.width,u.height];return n[0]>u.width?(r=Math.min(n[0]/u.width,e),c=n[0]/u.width/r):(r=1,c=n[0]/u.width),{cropArea:{x:Math.round((u.x+s.left)*r),y:Math.round((u.y+s.top)*r),width:Math.round(u.width*r),height:Math.round(u.height*r)},outputScale:c,resolutionScale:r}}const nn=160;let ut=class extends M{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=nn&&this.clear()},nn))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};l([h()],ut.prototype,"_timer",void 0),l([h()],ut.prototype,"stationary",null),ut=l([y("esri.views.2d.support.StationaryManager")],ut);const Uc=t=>t.includes("Brush");let uo=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),Uc(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function jc(t){const e=br();return e.available?t==="3d"&&e.majorPerformanceCaveat?new E("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new E("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new E("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new E("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function qc(t){return t&&"nodeType"in t}function Bc(t){return t&&typeof t.render=="function"}const on={component:"esri-component"};let Ve=class extends M{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,i;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((i=this.node)==null?void 0:i.id)}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(on.component),i&&i.classList.remove(on.component),this._set("node",e))}castNode(e){var i;return(i=this.widget)==null||i.destroy(),e?typeof e=="string"||qc(e)?(this._set("widget",null),Tn(e)):(Bc(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};l([h()],Ve.prototype,"id",null),l([h()],Ve.prototype,"node",null),l([qi("node")],Ve.prototype,"castNode",null),l([h({readOnly:!0})],Ve.prototype,"widget",void 0),Ve=l([y("esri.views.ui.Component")],Ve);const At=Ve,Kc={left:0,top:0,bottom:0,right:0},po={bottom:30,top:15,right:15,left:15},he="esri-ui",G={ui:he,corner:`${he}-corner`,innerContainer:`${he}-inner-container`,manualContainer:`${he}-manual-container`,cornerContainer:`${he}-corner-container`,topLeft:`${he}-top-left`,topRight:`${he}-top-right`,bottomLeft:`${he}-bottom-left`,bottomRight:`${he}-bottom-right`};function Yc(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function Ct(t){return t===0?"0":`${t}px`}function Ti(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function xi(t,{top:e,bottom:i,left:s,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=s,t.style.right=n}let ne=class extends Bt.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Na(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&xi(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&xi(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([w(()=>{var t;return[(t=this.view)==null?void 0:t.padding,this.container]},this._applyViewPadding,Z),w(()=>this.padding,this._applyUIPadding,Z),w(()=>[this.container,this._locale],([t,e])=>{t&&t.setAttribute("lang",e)},Z),Fa(t=>{this._locale=t})])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(G.ui),Mr(t),this._attachContainers(t)),e&&(e.classList.remove(G.ui),xi(e,{top:"",bottom:"",left:"",right:""}),e.textContent=""),this._set("container",t))}get height(){var n;const t=((n=this.view)==null?void 0:n.height)??0;if(t===0)return t;const e=this._getViewPadding(),{top:i,bottom:s}=e;return Math.max(t-i-s,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return typeof t=="number"?{bottom:t,top:t,right:t,left:t}:{...po,...t}}get width(){var n;const t=((n=this.view)==null?void 0:n.width)??0;if(t===0)return t;const e=this._getViewPadding(),{left:i,right:s}=e;return Math.max(t-i-s,0)}add(t,e){let i,s,n;if(Array.isArray(t))return void t.forEach(a=>this.add(a,e));const o=Ti(t);o&&({index:i,position:e,component:t,key:s}=o),e&&typeof e=="object"&&({index:i,key:s,position:e,internal:n}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,i,s,n)}remove(t,e){var s,n;if(!t)return;if(Array.isArray(t))return t.map(o=>this.remove(o,e));const i=this._find(t);if(i){if(this._componentMap.has(i)&&((s=this._componentMap.get(i))==null?void 0:s.key)!==e)return;const o=this._components.indexOf(i),a=i.node.parentNode;return a==null||a.removeChild(i.node),this._componentMap.delete(i),(n=i.widget)==null||n.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(o,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const n of t)this.empty(n,e);return}const i=this._positionNameToContainerLookup[t??"manual"],s=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||e.removeInternal});for(const n of s)this.remove(n)}move(t,e){if(Array.isArray(t)&&t.forEach(o=>this.move(o,e)),!t)return;let i;const s=Ti(t)||Ti(e);if(s&&(i=s.index,e=s.position,t=s.component||t),e&&!this._isValidPosition(e))return;const n=this.remove(t);n&&this.add(n,{position:e,index:i})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.flatMap(i=>this._getComponentsAtPosition(i,e)):this._getComponentsAtPosition(t,e):this._components.filter(i=>{var s;return e.includeInternal||!((s=this._componentMap.get(i))!=null&&s.internal)}).map(({widget:i,node:s})=>i??s)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,i,s,n){t instanceof At||(t=new At({node:t}));const{widget:o}=t;o!=null&&o instanceof M&&o.addHandles(Kt(()=>{queueMicrotask(()=>this.remove(t))}),this._removeWidgetHandleKey),this._place({component:t,position:e,index:i}),this._components.push(t),this._componentMap.set(t,{key:s,internal:n})}_find(t){return t?t instanceof At?this._findByComponent(t):typeof t=="string"?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){var t;return((t=this.view)==null?void 0:t.padding)??Kc}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(G.innerContainer,G.cornerContainer);const e=document.createElement("div");e.classList.add(G.innerContainer,G.manualContainer);const i=document.createElement("div");i.classList.add(G.topLeft,G.corner),t.appendChild(i);const s=document.createElement("div");s.classList.add(G.topRight,G.corner),t.appendChild(s);const n=document.createElement("div");n.classList.add(G.bottomLeft,G.corner),t.appendChild(n);const o=document.createElement("div");o.classList.add(G.bottomRight,G.corner),t.appendChild(o),this._innerContainer=t,this._manualContainer=e;const a=Ka();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:i,"top-trailing":a?i:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){var c,u;const e=t.position??"manual",{component:i,index:s}=t,n=this._positionNameToContainerLookup[e],o=s!=null&&s>-1;if(Yc(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.from(n.children);if(s===0){const{firstChild:p}=n;return void(p?(c=p.parentNode)==null?void 0:c.insertBefore(i.node,p):n.appendChild(i.node))}if(s>=a.length)return void n.appendChild(i.node);const r=a[s];(u=r.parentNode)==null||u.insertBefore(i.node,r)}_toPixelPosition(t){return{top:Ct(t.top),left:Ct(t.left),right:Ct(t.right),bottom:Ct(t.bottom)}}_findByComponent(t){return this._components.find(e=>e===t)??null}_findById(t){return this._components.find(({id:e})=>e===t)??null}_findByNode(t){return this._components.find(({node:e})=>e===t)??null}_getComponentsAtPosition(t,e){const i=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(Ht).filter(s=>{var n;return e.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};l([h()],ne.prototype,"_locale",void 0),l([h()],ne.prototype,"container",null),l([h()],ne.prototype,"height",null),l([h({value:po})],ne.prototype,"padding",null),l([qi("padding")],ne.prototype,"castPadding",null),l([h()],ne.prototype,"view",void 0),l([h()],ne.prototype,"width",null),ne=l([y("esri.views.ui.UI")],ne);const Xc=ne,Jc=new Map;function Qc(t){return Jc.get(t)}function an(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function eu(t,e){return t.length!==e.length||t.some((i,s)=>i.text!==e[s].text)}function ot(t,e,i){!i||!e||t.find(s=>s.layerView===e&&s.text===i)||t.push({text:i,layerView:e})}function tu(t){return t.type==="bing-maps"}const ce=[];let Ye=class extends M{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new D,this.view=null,this._allLayerViewsChange=e=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const i=(s=this.view)==null?void 0:s.allLayerViews;i&&(this.addHandles(i.map(n=>w(()=>{var o;return[n.suspended,(o=n.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(n=>{n.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(n.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),e!=null&&e.removed&&e.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([qt(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),dt(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var t;return(t=this.view)!=null&&t.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t==null?void 0:t.allLayerViews;if(ce.length=0,!t||!e)return void this._clear();e.forEach(s=>{var a,r;if(s.suspended||!((a=s.layer)!=null&&a.attributionVisible))return;const n=s.layer;if(an(n,"user"))return void ot(ce,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const c=this._fetchedAttributionData.get(s);return void(c?ot(ce,s,this._getDynamicAttribution(c,t,n)):an(n)&&ot(ce,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?(r=n.portalItem)==null?void 0:r.accessInformation:void 0;ot(ce,s,o||n.copyright)});const i=e.find(s=>{var n;return((n=s.layer)==null?void 0:n.type)==="integrated-mesh-3dtiles"});if(this.view&&i){const s=Qc(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)ot(ce,i,n[o])}}eu(this.items,ce)&&(this.items.removeAll(),this.items.addMany(ce)),ce.length=0,this.notifyChange("state")}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await Ha(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const i=e.ok?this._createContributionIndex(e.value,tu(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,s={};if(!i)return s;for(let n=0;n<i.length;n++){const o=i[n],a=o.coverageAreas;if(!a)return;for(const r of a){const c=r.bbox,u=r.zoomMin-(e&&r.zoomMin?1:0),p=r.zoomMax-(e&&r.zoomMax?1:0),m=new ft({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:ki.WGS84}),d={extent:Za(m),attribution:o.attribution||"",score:r.score!=null?r.score:100,id:n};for(let g=u;g<=p;g++)s[g]??(s[g]=[]),s[g].push(d)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(t,e,i){var u;const{extent:s,scale:n}=e;let o=((u=i.tileInfo)==null?void 0:u.scaleToZoom(n))??0;if(o=Math.min(t.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=t[o],r=Ga(s.center.clone().normalize(),ki.WebMercator),c=new Set;return a?a.filter(p=>{const m=p.id,d=!c.has(m)&&r&&p.extent&&ji(p.extent,r);return d&&c.add(m),d}).sort((p,m)=>m.score-p.score||p.objectId-m.objectId).map(p=>p.attribution).join(", "):""}};l([h({readOnly:!0,type:D})],Ye.prototype,"items",void 0),l([h({readOnly:!0})],Ye.prototype,"state",null),l([h()],Ye.prototype,"view",void 0),Ye=l([y("esri.widgets.Attribution.AttributionViewModel")],Ye);const mo=Ye,Ue="esri-attribution",je={base:Ue,poweredBy:`${Ue}__powered-by`,sources:`${Ue}__sources`,open:`${Ue}--open`,sourcesOpen:`${Ue}__sources--open`,link:`${Ue}__link`};let F=class extends Yt{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(s=>s.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new mo}initialize(){this.addHandles(qt(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[je.open]:this._isOpen};return U("div",{bind:this,class:this.classes(je.base,ae.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return U("div",{class:je.poweredBy},"Powered by"," ",U("a",{class:je.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,s=i?0:void 0,{attributionText:n}=this,o={[je.sourcesOpen]:e,[ae.interactive]:i};return U("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(je.sources,o),innerHTML:n,tabIndex:s})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:s,clientWidth:n,scrollWidth:o}=e,a=o>n,r=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,r&&(i=!0),this._isOpen){const c=s<this._prevSourceNodeHeight;this._prevSourceNodeHeight=s,c&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};l([h()],F.prototype,"_isOpen",void 0),l([h()],F.prototype,"_isInteractive",null),l([h()],F.prototype,"_attributionTextOverflowed",void 0),l([h()],F.prototype,"_prevSourceNodeHeight",void 0),l([h({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],F.prototype,"attributionText",null),l([h()],F.prototype,"icon",null),l([h()],F.prototype,"itemDelimiter",void 0),l([h()],F.prototype,"label",null),l([h(),Xt("esri/widgets/Attribution/t9n/Attribution")],F.prototype,"messages",void 0),l([h()],F.prototype,"view",null),l([h({type:mo})],F.prototype,"viewModel",void 0),l([Tr()],F.prototype,"_toggleState",null),F=l([y("esri.widgets.Attribution")],F);const iu=F;function su(){const t=V("mapview-essential-goto-duration");return t==null?t:Q(t)}function nu(t){var e,i;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((i=t==null?void 0:t.spatialReference)==null?void 0:i.isGeographic)||!1}let Oe=class extends xr(M){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(w(()=>this.view,this._updateRotationWatcher,Z))}destroy(){this.view=null}get canShowNorth(){return nu(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var e,i;(e=this.view)!=null&&e.ready&&(((i=this.view)==null?void 0:i.type)==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:su()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?w(()=>e==null?void 0:e.rotation,this._updateForRotation,Z):w(()=>e==null?void 0:e.camera,this._updateForCamera,Z))}};l([h({readOnly:!0})],Oe.prototype,"canShowNorth",null),l([h({readOnly:!0})],Oe.prototype,"orientation",void 0),l([h({readOnly:!0})],Oe.prototype,"state",null),l([h()],Oe.prototype,"view",void 0),Oe=l([y("esri.widgets.Compass.CompassViewModel")],Oe);const go=Oe,rn="esri-compass",ln={base:rn,iconContainer:`${rn}__icon-container`};let de=class extends Yt{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new go,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=s=>({transform:`rotateZ(${s.z}deg)`})}loadDependencies(){return Bi({button:()=>b(()=>import("./calcite-button-B-P05OnF.js"),__vite__mapDeps([208,1,2])),icon:()=>b(()=>import("./calcite-icon-DhYIruxM.js"),__vite__mapDeps([209,1,2]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:s}=this;return U("div",{class:this.classes(ln.base,ae.widget)},U("calcite-button",{class:ae.widgetButton,disabled:i==="disabled",kind:"neutral",label:s.reset,onclick:this._reset,round:!0,scale:"s",title:s.reset},U("div",{"aria-hidden":"true",class:ln.iconContainer,title:s.reset},U("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};l([h()],de.prototype,"goToOverride",null),l([h()],de.prototype,"icon",null),l([h()],de.prototype,"label",null),l([h(),Xt("esri/widgets/Compass/t9n/Compass")],de.prototype,"messages",void 0),l([h()],de.prototype,"view",null),l([h({type:go})],de.prototype,"viewModel",void 0),de=l([y("esri.widgets.Compass")],de);const ou=de,hn="esri-navigation-toggle",cn={base:hn,isLayoutHorizontal:`${hn}--horizontal`};let Xe=class extends M{constructor(t){super(t),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(dt(()=>{var t;return(t=this.view)==null?void 0:t.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var t,e;return(t=this.view)!=null&&t.ready&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(t){this._navigationMode=t,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){var e;const t=(e=this.view)==null?void 0:e.inputManager;t&&(t.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};l([h({readOnly:!0})],Xe.prototype,"state",null),l([h()],Xe.prototype,"_navigationMode",void 0),l([h()],Xe.prototype,"view",void 0),Xe=l([y("esri.widgets.NavigationToggle.NavigationToggleViewModel")],Xe);const fo=Xe;let me=class extends Yt{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new fo,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var n;const s=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan"?this._rotateButton:this._panButton;Ya(s),this.toggle()}}loadDependencies(){return Bi({button:()=>b(()=>import("./calcite-button-B-P05OnF.js"),__vite__mapDeps([208,1,2]))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var n,o;const e=((n=this.viewModel)==null?void 0:n.state)==="disabled",i=((o=this.viewModel)==null?void 0:o.navigationMode)==="pan",s=this.messages.toggle;return U("div",{class:this.classes(cn.base,ae.widget,{[cn.isLayoutHorizontal]:this.layout==="horizontal"})},U("calcite-button",{afterCreate:a=>{this._panButton=a},appearance:i?"outline-fill":"solid",class:ae.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:s,onclick:this._toggle,tabIndex:i?void 0:-1,title:s}),U("calcite-button",{afterCreate:a=>{this._rotateButton=a},appearance:i?"solid":"outline-fill",class:ae.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:s,onclick:this._toggle,tabIndex:i?-1:void 0,title:s}))}};l([h()],me.prototype,"icon",null),l([h()],me.prototype,"label",null),l([h({value:"vertical"})],me.prototype,"layout",null),l([h(),Xt("esri/widgets/NavigationToggle/t9n/NavigationToggle")],me.prototype,"messages",void 0),l([h()],me.prototype,"view",null),l([h({type:fo})],me.prototype,"viewModel",void 0),me=l([y("esri.widgets.NavigationToggle")],me);const au=me,un={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let ge=class extends Yt{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new Pn,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Bi({button:()=>b(()=>import("./calcite-button-B-P05OnF.js"),__vite__mapDeps([208,1,2]))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[un.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:s}=this.viewModel,{zoomIn:n,zoomOut:o}=this.messages;return U("div",{class:this.classes(un.base,ae.widget,e)},U("calcite-button",{class:ae.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:n,onclick:this.zoomIn,title:n}),U("calcite-button",{class:ae.widgetButton,disabled:!s,iconStart:"minus",kind:"neutral",label:o,onclick:this.zoomOut,title:o}))}};l([h()],ge.prototype,"icon",null),l([h()],ge.prototype,"label",null),l([h({value:"vertical"})],ge.prototype,"layout",null),l([h(),Xt("esri/widgets/Zoom/t9n/Zoom")],ge.prototype,"messages",void 0),l([h()],ge.prototype,"view",null),l([h({type:Pn})],ge.prototype,"viewModel",void 0),ge=l([y("esri.widgets.Zoom")],ge);const ru=ge;function lu(t){return(t==null?void 0:t.view)!==void 0}let zt=class extends Xc{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(i=>{const s=this._find(i),n=s==null?void 0:s.widget;lu(n)&&(n.view=e)})},this._componentsWatcher=(e,i)=>{this._removeComponents(i),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([w(()=>this.components,this._componentsWatcher,Z),w(()=>this.view,this._updateViewAwareWidgets,Z)])}_add(t,e,i,s,n){let o=t;if(typeof t=="string"&&this._defaultPositionLookup[t]){if(this._find(t))return;o=this._createComponent(t)}super._add(o,e,i,s,n)}_removeComponents(t){t.forEach(e=>{const i=this._find(e);i&&(this.remove(i),i.destroy())})}_adjustPadding(t){if(!t.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(t){this.constructed&&t.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(t){const e=this._createWidget(t);return new At({id:t,node:e})}_createWidget(t){const e=this.view;switch(t){case"attribution":return new iu({view:e});case"compass":return new ou({view:e});case"navigation-toggle":return new au({view:e});case"zoom":return new ru({view:e})}}};l([h()],zt.prototype,"components",void 0),zt=l([y("esri.views.ui.DefaultUI")],zt);const _o=zt;let Nt=class extends _o{constructor(t){super(t),this.components=["attribution","zoom"]}};l([h()],Nt.prototype,"components",void 0),Nt=l([y("esri.views.ui.2d.DefaultUI2D")],Nt);const yo=Nt;let vo,wo,bo,Mo,To,xo,Po;async function hu(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:s,MagnifierView2D:n,GridView2D:o,Stage:a}]=await Promise.all([b(()=>import("./webglDeps-Yyfy7E_b.js"),__vite__mapDeps([67,68,1,2,69,70,71,72,73,74])),b(()=>import("./mapViewDeps-DEeY8dXV.js"),__vite__mapDeps([75,1,2,76,77,78,79,80,81,82,19,83,84,85,86,87,88,69,70,71,68,89,90,60,91,92,74,93,94,73,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,67,72,111,112,113,114,23,115,42,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,5,136,137,138,139,7,8,140,141,142,28,15,143,144,145,21,13,146,64,147]))]);wo=t,bo=e,Mo=i,To=s,xo=n,Po=o,vo=a}let _=class extends Sr(Wr(Ir(Dl))){constructor(t){super(t),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new Mn({getCollections:()=>{var e,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.goToManager=new Vt({view:this}),this.graphicsView=null,this.stateManager=new z({constraints:new Wn({view:this})}),this.stationaryManager=new ut,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.frameTask=new wh(this),this.floors=new D,this.grid=null,this.highlights=to(),this.inputManager=new oc({view:this}),this.map=null,this.spatialReferenceLocked=!1,this.timeline=new uo,this.type="2d",this.view2dType=null,this.ui=new yo,this.test={takeScreenshot:async e=>Hc(this._getScreenshotView(e),e)},this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([w(()=>this.viewpoint,()=>this.stationaryManager.flip(),pt),this.on("resize",e=>this.stateManager.resize(e.width,e.height))]),Wa()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=X(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new lc(this.featuresTilingScheme)}get constraintsInfo(){var i,s;const t=(i=this.defaultsFromMap)==null?void 0:i.tileInfo,e=this.spatialReference;return{lods:(s=t==null?void 0:t.spatialReference)!=null&&s.equals(e)?t.lods:null,spatialReference:e}}get state(){return this.stateManager.state}get initialExtentRequired(){var a;if(!this.stateManager)return!1;const{scale:t,constraints:e,center:i,viewpoint:s,extent:n}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((a=this.map.initialViewProperties)!=null&&a.viewpoint))&&!n&&(e!=null&&e.effectiveLODs||(o=-1),(!i||t===0&&o===-1)&&((s==null?void 0:s.targetGeometry)==null||s.targetGeometry.type!=="extent"&&!s.scale))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const t=this._getDefaultViewpoint();if(!t)return!1;const e=t.targetGeometry,i=this.spatialReference;return Ua(e.spatialReference,i)}set animation(t){const e=this._get("animation");if(t===e)return;if(e&&e.stop(),t!==this.animationManager.animation&&this.animationManager.stop(),!t||t.isFulfilled())return void this._set("animation",null);this._set("animation",t);const i=()=>{var s;this.destroyed||t===this._get("animation")&&(this._set("animation",null),(s=this.frameTask)==null||s.requestFrame())};t.when(i,i)}get background(){return ni(this.map)?this.map.initialViewProperties.background:null}set background(t){this._override("background",t)}get center(){var t;return((t=this.stateManager)==null?void 0:t.center)??null}set center(t){this.stateManager.center=t}get constraints(){var t;return(t=this.stateManager)==null?void 0:t.constraints}set constraints(t){t.view=this;const e=this.stateManager.constraints;this.stateManager.constraints=t,e==null||e.destroy()}get extent(){var t;return((t=this.stateManager)==null?void 0:t.extent)??null}set extent(t){this.stateManager.extent=t}get highlightOptions(){return $c(this)}set highlightOptions(t){Cc(this,t)}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}get rendering(){var t;return((t=this.stage)==null?void 0:t.renderRequested)??!1}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(t){this.stateManager.resizeAlign=t}get resolution(){return this.stateManager.resolution??0}get rotation(){return this.stateManager.rotation??0}set rotation(t){const{rotationEnabled:e}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=t,this.constraints.rotationEnabled=e}get scale(){var t;return((t=this.stateManager)==null?void 0:t.scale)??0}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}get tileInfo(){var t;return(t=this.featuresTilingScheme)==null?void 0:t.tileInfo}get updating(){var i,s,n,o;const t=!(!this.magnifier.visible||this.magnifier.position===null||!((i=this._magnifierView)!=null&&i.updatingHandles.updating)),e=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(a=>!a.destroyed&&!("layerViews"in a)&&a.updating===!0)||t);if(V("esri-2d-log-updating")){const a=this.allLayerViews.reduce((r,c)=>({...r,[`${c.layer.id}(${c.layer.type})`]:!c.destroyed&&!("layerViews"in c)&&c.updating}),{});console.log(`Updating MapView: ${e}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(s=this.layerViewManager)==null?void 0:s.updating}
-> labelManager.updating: ${(n=this.labelManager)==null?void 0:n.updating}
-> graphicsView.updating: ${(o=this.graphicsView)==null?void 0:o.updating}
-> allLayerViews: ${JSON.stringify(a)}
-> updatingMagnifier: ${t}
`)}return e}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(t){this.stateManager.viewpoint=t,this.frameTask.requestFrame()}get visibleArea(){const t=this.stateManager.visibleArea;return t&&new wn({rings:[t.map(e=>[e[0],e[1]])],spatialReference:this.spatialReference})}get zoom(){return this.stateManager.zoom??-1}set zoom(t){this.stateManager.zoom=t}get navigating(){var t;return((t=this.mapViewNavigation)==null?void 0:t.interacting)??!1}goTo(t,e){return this.goToManager.goTo(t,e)}async hitTest(t,e){return Ic(this,t,e)}async takeScreenshot(t){return Fc(this._getScreenshotView(t),t)}toMap(t){if(!this.ready)return null;const e=Dn(t)?In(this,t):t;return this.stateManager.toMap(e)}toScreen(t,e){return this.stateManager.toScreen(t,e)}on(t,e,i,s){return this.inputManager&&this.viewEvents.on(t,e,i,s)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}whenLayerView(t){return super.whenLayerView(t)}graphicChanged(t){this.graphicsView&&this.graphicsView.graphicUpdateHandler(t)}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t;return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||((t=this.defaultsFromMap)==null?void 0:t.spatialReference)||null}getDefaultTimeZone(){return ni(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return ni(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(t){return Ns.hasLayerViewModule(t)}importLayerView(t){return Ns.importLayerView(t)}pixelSizeAt(){return this.ready?this.resolution:($.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(t){var c;const e=this.toMap(t),i=await this.hitTest(t),s=this.allLayerViews.toArray().filter(u=>u.clips.every(p=>Qn(this,p,t,e))).reverse(),n=new globalThis.Map(s.map(u=>[u.layer.uid,u])),o=[];let a=0,r=0;for(;a<i.results.length||r<s.length;){const u=i.results.at(a);if(u&&u.type!=="graphic"){++a;continue}const p=n.get((c=(u==null?void 0:u.layer)??(u==null?void 0:u.graphic.layer))==null?void 0:c.uid);if((!u||p)&&r<s.length&&s.at(r)!==p){const m=s.at(r);"fetchPopupFeaturesAtLocation"in m&&o.push({mapPoint:e,layerView:m}),++r}else u&&(o.push({graphic:u.graphic,layerView:p}),++a)}return{hits:o,location:e}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let t=jc(this.type);if(V("safari")&&V("safari")<9&&(t=new E("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:V("safari")})),t!=null)throw $.getLogger(this).warn("#validate()",t.message),t}loadAsyncDependencies(){return hu()}_getDefaultViewpoint(){var v;const{constraints:t,initialExtent:e,map:i,padding:s,size:n}=this;if(!t)return null;const o=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,a=this.stateManager.getUserStartupOptions(this.size),r=o==null?void 0:o.viewpoint,c=((v=r==null?void 0:r.targetGeometry)==null?void 0:v.extent)??e,u=c==null?void 0:c.center,p=(r==null?void 0:r.rotation)??0,m=(r==null?void 0:r.scale)||c&&bn(c,[n[0]-s.left-s.right,n[1]-s.top-s.bottom]),d=a.center??u,g=a.rotation??p,R=a.scale??m;return d&&R?new Ee({targetGeometry:d,scale:R,rotation:g}):null}_startup(){var a;this.timeline.begin("MapView Startup");const t=this._getDefaultViewpoint();this.stateManager.startup(t,this.size,this.spatialReference,(a=this.defaultsFromMap.extent)==null?void 0:a.center),this.graphics.owner=this;const e=new vo(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=e,this._magnifierView=new xo,this._magnifierView.magnifier=this.magnifier,this._gridView=new Po;const i=new Mo({view:this});this._set("labelManager",i);const s=new vh({view:this});this._set("animationManager",s);const n=new To({view:this,animationManager:s});this._set("mapViewNavigation",n),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),e.on("webgl-error",r=>this.fatalError=r.error),w(()=>this.stationary,r=>e.stationary=r,oe),w(()=>this.background,r=>{e.backgroundColor=r==null?void 0:r.color,this._magnifierView.backgroundColor=r==null?void 0:r.color},oe),w(()=>this.magnifier,r=>this._magnifierView.magnifier=r,oe),w(()=>this.grid,r=>this._gridView.grid=r,oe),w(()=>this.renderingOptions,r=>e.renderingOptions=r,oe),w(()=>this.highlights.items.map(r=>({name:r.name,options:{fillColor:r.options.color,haloColor:r.options.haloColor,fillOpacity:r.options.fillOpacity,haloOpacity:r.options.haloOpacity,haloWidth:r.options.haloWidth,haloBlur:r.options.haloBlur}})),()=>{e.highlightGradient=kc(e.highlightGradient,this.highlights.items)},oe),w(()=>this.state.id,()=>e.state=this.state,oe)],"map-view"),this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach(r=>r(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(e=>{this.stage.addChild(e.container)});const t=this.graphicsView;this.stage.addChild(t.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const t=new ur(Ba.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",t);const e=new wo({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new bo(t)});this._set("graphicsView",e)}_destroySpatialReferenceDependentProperties(){const t=this.graphicsView;this._set("graphicsView",null),t.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(t){var o;const{allLayerViews:e,padding:i,size:s,stage:n}=this;return{allLayerViews:e,backgroundColor:t!=null&&t.ignoreBackground?null:(o=this.background)==null?void 0:o.color,padding:i,size:s,stage:n}}_spatialReferenceChanged(t){if(this.ready){this.frameTask.stop();for(const e of this.allLayerViews)e.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(t),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const e of this.allLayerViews)e.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};_.type="2d",l([h({readOnly:!0})],_.prototype,"animationManager",void 0),l([h({constructOnly:!0})],_.prototype,"deactivatedWebGLExtensions",void 0),l([h({constructOnly:!0})],_.prototype,"debugWebGLExtensions",void 0),l([h({readOnly:!0})],_.prototype,"featuresTilingScheme",void 0),l([h({readOnly:!0})],_.prototype,"fullOpacity",void 0),l([h()],_.prototype,"goToManager",void 0),l([h({readOnly:!0})],_.prototype,"graphicsTileStore",null),l([h()],_.prototype,"graphicsView",void 0),l([h()],_.prototype,"stateManager",void 0),l([h()],_.prototype,"constraintsInfo",null),l([h({readOnly:!0})],_.prototype,"state",null),l([h()],_.prototype,"initialExtentRequired",null),l([h()],_.prototype,"labelManager",void 0),l([h({readOnly:!0})],_.prototype,"mapViewNavigation",void 0),l([h({constructOnly:!0})],_.prototype,"renderCanvas",void 0),l([h()],_.prototype,"renderingOptions",void 0),l([h({constructOnly:!0})],_.prototype,"supersampleScreenshotsEnabled",void 0),l([h({readOnly:!0})],_.prototype,"supportsGround",void 0),l([h()],_.prototype,"defaultsFromMapSettings",null),l([h({readOnly:!0})],_.prototype,"typeSpecificPreconditionsReady",null),l([h()],_.prototype,"animation",null),l([h({type:Qa})],_.prototype,"background",null),l([h()],_.prototype,"center",null),l([h({type:Wn})],_.prototype,"constraints",null),l([h()],_.prototype,"extent",null),l([h()],_.prototype,"floors",void 0),l([h()],_.prototype,"grid",void 0),l([h({type:Ne})],_.prototype,"highlightOptions",null),l([h({type:D.ofType(Qe)})],_.prototype,"highlights",void 0),l([h({readOnly:!0})],_.prototype,"inputManager",void 0),l([h()],_.prototype,"map",void 0),l([h()],_.prototype,"padding",null),l([h({readOnly:!0})],_.prototype,"rendering",null),l([h()],_.prototype,"resizeAlign",null),l([h({readOnly:!0})],_.prototype,"resolution",null),l([h()],_.prototype,"rotation",null),l([h()],_.prototype,"scale",null),l([h({constructOnly:!0})],_.prototype,"spatialReferenceLocked",void 0),l([h()],_.prototype,"stationary",null),l([h({readOnly:!0})],_.prototype,"tileInfo",null),l([h({type:uo,readOnly:!0})],_.prototype,"timeline",void 0),l([h({readOnly:!0})],_.prototype,"type",void 0),l([h({readOnly:!0})],_.prototype,"updating",null),l([h({readOnly:!0})],_.prototype,"view2dType",void 0),l([h()],_.prototype,"viewpoint",null),l([h({readOnly:!0})],_.prototype,"visibleArea",null),l([h()],_.prototype,"zoom",null),l([h({readOnly:!0})],_.prototype,"navigating",null),l([h(),qi(t=>t instanceof _o?t:ja(yo,t))],_.prototype,"ui",void 0),_=l([y("esri.views.View2D")],_);const cu=_;let Ft=class extends cu{constructor(t){super(t),this.view2dType="map"}};l([h({readOnly:!0})],Ft.prototype,"view2dType",void 0),Ft=l([y("esri.views.MapView")],Ft);const uu=Ft,_d=Object.freeze(Object.defineProperty({__proto__:null,default:uu},Symbol.toStringTag,{value:"Module"}));export{Ys as A,hd as B,_d as C,qs as E,Bs as L,Pc as M,Js as N,Ut as R,Qs as S,ke as _,kc as a,Ll as b,su as c,ad as d,Lt as e,Jn as f,Jp as g,ld as h,Qe as i,hc as j,uo as k,Ne as l,Cc as m,Ec as n,rd as o,sd as p,id as q,$c as r,Xn as s,Xp as t,Mc as u,Dr as v,od as w,mt as x,nd as y,ie as z};
//# sourceMappingURL=MapView-Dq7I7tn2.js.map
