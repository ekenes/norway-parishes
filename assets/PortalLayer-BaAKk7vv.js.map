{"version":3,"mappings":"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","names":["j","_","l","t","r","P","_a","__vitePreload","n","p","a","u","e","i","s","U","o","I","d","c","E","_b","v","w","m","h","f","y","g"],"ignoreList":[0],"sources":["../../node_modules/@arcgis/core/layers/mixins/PortalLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import e from\"../../config.js\";import{id as r}from\"../../kernel.js\";import s from\"../../request.js\";import{result as i}from\"../../core/asyncUtils.js\";import o from\"../../core/Error.js\";import a from\"../../core/Logger.js\";import{destroyMaybe as l}from\"../../core/maybe.js\";import{throwIfAborted as n,isAbortError as p,throwIfAbortError as u}from\"../../core/promiseUtils.js\";import{hasSameCanonicalPortal as c,normalize as d,hasSamePortal as m}from\"../../core/urlUtils.js\";import{property as h}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import{reader as f}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as g}from\"../../core/accessorSupport/decorators/subclass.js\";import{writer as y}from\"../../core/accessorSupport/decorators/writer.js\";import{getOwningPortalUrl as I}from\"../support/layerUtils.js\";import v from\"../../portal/Portal.js\";import P from\"../../portal/PortalItem.js\";import w from\"../../portal/PortalUser.js\";import{getUserPrivileges as U}from\"../../portal/support/portalItemUtils.js\";const j=j=>{let _=class extends j{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=l(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(t){t!==this._get(\"portalItem\")&&(this.removeOrigin(\"portal-item\"),this._set(\"portalItem\",t))}readPortalItem(t,e,r){if(e.itemId)return new P({id:e.itemId,portal:r?.portal})}writePortalItem(t,e){t?.id&&(e.itemId=t.id)}async loadFromPortal(t,e){if(this.portalItem?.id)try{const{load:r}=await import(\"../../portal/support/layersLoader.js\");return n(e),await r({instance:this,supportedTypes:t.supportedTypes,validateItem:t.validateItem,supportsData:t.supportsData,layerModuleTypeMap:t.layerModuleTypeMap},e)}catch(r){throw p(r)||a.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\\n  ${r}`),r}}async finishLoadEditablePortalLayer(t){this._set(\"userHasEditingPrivileges\",await this._fetchUserHasEditingPrivileges(t).catch((t=>(u(t),!0))))}async setUserPrivileges(t,r){if(!e.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:e,fullEdit:s},content:{updateItem:i}}=await this._fetchUserPrivileges(t,r);this._set(\"userHasEditingPrivileges\",e),this._set(\"userHasFullEditingPrivileges\",s),this._set(\"userHasUpdateItemPrivileges\",i)}catch(s){u(s)}}async _fetchUserPrivileges(t,e){let s=this.portalItem;if(!t||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(e);const i=t===s.id;if(i&&s.portal.user)return U(s);let o,a;if(i)o=s.portal.url;else try{o=await I(this.url,e)}catch(d){u(d)}if(!o||!c(o,s.portal.url))return this._fetchFallbackUserPrivileges(e);try{const t=null!=e?e.signal:null;a=await(r?.getCredential(`${o}/sharing`,{prompt:!1,signal:t}))}catch(d){u(d)}const l=!0,n=!1,p=!1;if(!a)return{features:{edit:l,fullEdit:n},content:{updateItem:p}};try{if(i?await s.reload():(s=new P({id:t,portal:{url:o}}),await s.load(e)),s.portal.user)return U(s)}catch(d){u(d)}return{features:{edit:l,fullEdit:n},content:{updateItem:p}}}async _fetchFallbackUserPrivileges(t){let e=!0;try{e=await this._fetchUserHasEditingPrivileges(t)}catch(r){u(r)}return{features:{edit:e,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(t){const e=this.url?r?.findCredential(this.url):null;if(!e)return!0;const s=E.credential===e?E.user:await this._fetchEditingUser(t);return E.credential=e,E.user=s,null==s?.privileges||s.privileges.includes(\"features:user:edit\")}async _fetchEditingUser(t){const e=this.portalItem?.portal?.user;if(e)return e;const o=r?.findServerInfo(this.url??\"\");if(!o?.owningSystemUrl)return null;const a=`${o.owningSystemUrl}/sharing/rest`,l=v.getDefault();if(l&&l.loaded&&d(l.restUrl)===d(a))return l.user;const n=`${a}/community/self`,p=null!=t?t.signal:null,u=await i(s(n,{authMode:\"no-prompt\",query:{f:\"json\"},signal:p}));return u.ok?w.fromJSON(u.value.data):null}read(t,e){e&&(e.layer=this),super.read(t,e)}write(t,e){const r=e?.portal,s=this.portalItem?.id&&(this.portalItem.portal||v.getDefault());return r&&s&&!m(s.restUrl,r.restUrl)?(e.messages&&e.messages.push(new o(\"layer:cross-portal\",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(t,{...e,layer:this})}};return t([h({type:P})],_.prototype,\"portalItem\",null),t([f(\"web-document\",\"portalItem\",[\"itemId\"])],_.prototype,\"readPortalItem\",null),t([y(\"web-document\",\"portalItem\",{itemId:{type:String}})],_.prototype,\"writePortalItem\",null),t([h({clonable:!1})],_.prototype,\"resourceReferences\",void 0),t([h({type:Boolean,readOnly:!0})],_.prototype,\"userHasEditingPrivileges\",void 0),t([h({type:Boolean,readOnly:!0})],_.prototype,\"userHasFullEditingPrivileges\",void 0),t([h({type:Boolean,readOnly:!0})],_.prototype,\"userHasUpdateItemPrivileges\",void 0),_=t([g(\"esri.layers.mixins.PortalLayer\")],_),_},E={credential:null,user:null};export{j as PortalLayer};\n"],"file":"assets/PortalLayer-BaAKk7vv.js"}