{"version":3,"file":"OverlayContainer-DObjrIQu.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/OverlayShader.js","../../node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/overlay/OverlayTechnique.js","../../node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as t,a as o}from\"../../../../../../../chunks/tslib.es6.js\";import{location as e,uniform as r,GraphShaderModule as p,VertexInput as i,UniformGroup as s,FragmentOutput as n,input as d,FragmentInput as a}from\"../../GraphShaderModule.js\";import{Float as l,dot as v,Vec3 as c,Vec2 as y,Vec4 as u,texture2D as f,Mat3 as g,Sampler2D as m}from\"../../graph/glsl.js\";class x extends i{}t([e(0,y)],x.prototype,\"pos\",void 0),t([e(1,y)],x.prototype,\"uv\",void 0);class h extends a{}class w extends s{}t([r(g)],w.prototype,\"dvs\",void 0);class S extends s{}t([r(y)],S.prototype,\"perspective\",void 0),t([r(y)],S.prototype,\"texSize\",void 0),t([r(l)],S.prototype,\"wrapAroundShift\",void 0),t([r(l)],S.prototype,\"opacity\",void 0),t([r(m)],S.prototype,\"texture\",void 0);class j extends p{vertex(t){const o=t.uv.divide(this.config.texSize),e=new l(1).add(v(o,this.config.perspective)),r=new c(t.pos.add(new y(this.config.wrapAroundShift,0)),1),p=this.transform.dvs.multiply(r);return{uv:o,glPosition:new u(p.xy.multiply(e),0,e)}}fragment(t){const o=f(this.config.texture,t.uv).multiply(this.config.opacity),e=new n;return e.glFragColor=o,e}}t([r(w)],j.prototype,\"transform\",void 0),t([r(S)],j.prototype,\"config\",void 0),t([o(0,d(x))],j.prototype,\"vertex\",null),t([o(0,d(h))],j.prototype,\"fragment\",null);export{j as OverlayShader};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{destroyMaybe as e}from\"../../../../../../../core/maybe.js\";import{Mesh as t}from\"../../../meshing/Mesh.js\";import{simplePipelineState as s}from\"../../utils.js\";import{Technique as i}from\"../Technique.js\";import{TechniqueType as o}from\"../TechniqueType.js\";import{OverlayShader as r}from\"../shaders/OverlayShader.js\";import{CompareFunction as n,StencilOperation as a,DataType as p,PrimitiveType as h}from\"../../../../../../webgl/enums.js\";class u extends i{constructor(){super(...arguments),this.type=o.Overlay,this._mesh=null,this.shaders={overlay:new r}}render(e,t){const{context:i,painter:o}=e,r=this._getMesh(e,t);o.setPipelineState(s);const{isWrapAround:p,wrapAroundShift:h}=t.config,u={...t.config,wrapAroundShift:0},m={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:u},defines:null,optionalAttributes:null,useComputeBuffer:!1};o.setPipelineState({...s,stencil:{write:!1,test:{compare:n.EQUAL,op:{fail:a.KEEP,zFail:a.KEEP,zPass:a.REPLACE},ref:0,mask:255}}}),o.submitDrawMeshUntyped(i,m,r),p&&(u.wrapAroundShift=h,o.submitDrawMeshUntyped(i,m,r))}shutdown(){e(this._mesh)}_getMesh(e,s){const{context:i}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get(\"positions\");if(!e)throw new Error(\"Buffer not found\");e.setData(s.position)}else{const e=null!=s.index?s.index.length:s.position.length/2;this._mesh=new t(i,{vertex:{positions:s.position,uvs:s.tex},index:null!=s.index?{index:s.index}:void 0,groups:[{attributes:[{name:\"pos\",count:2,type:p.FLOAT,location:0,vertex:\"positions\",stride:8,offset:0},{name:\"tex\",count:2,type:p.UNSIGNED_SHORT,location:1,vertex:\"uvs\",stride:4,offset:0}],index:null!=s.index?\"index\":void 0,primitive:h.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}export{u as OverlayTechnique};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{toRadian as t}from\"../../../../core/libs/gl-matrix-2/math/common.js\";import{identity as e,multiply as r,translate as o,scale as i,rotate as s}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as a}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as l}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as c}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as h}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as m}from\"../../viewpointUtils.js\";import{WGLDrawPhase as d}from\"./enums.js\";import p from\"./WGLContainer.js\";import{OverlayTechnique as f}from\"./shaderGraph/techniques/overlay/OverlayTechnique.js\";class u extends p{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=a(),this._overlayTechnique=new f}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}doRender(t){if(t.drawPhase!==d.MAP||!this.visible)return;super.doRender(t);const e=this._overlayTechnique;for(const r of this.children)r.draw(t,e)}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(a){const{state:h}=a,{id:m,size:d,pixelRatio:p,resolution:f,rotation:u,viewpoint:v,displayMat3:_}=h;if(this._viewStateId===m)return;const M=t(u),g=p*d[0],y=p*d[1];this._localOrigin=v.targetGeometry.clone();const{x:w,y:x}=this._localOrigin,b=c(w,h.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const j=f*g,O=f*y,R=e(this._dvsMat3);r(R,R,_),o(R,R,n(g/2,y/2)),i(R,R,l(g/j,-y/O,1)),s(R,R,-M),this._viewStateId=m}_updateOverlays(e,r){const{state:o}=e,{rotation:i,spatialReference:s,worldScreenWidth:a,size:n,viewpoint:l}=o,c=this._localOrigin;let d,p=0;const f=h(s);if(f&&s.isWrappable){const e=n[0],r=n[1],c=t(i),h=Math.abs(Math.cos(c)),u=Math.abs(Math.sin(c)),v=Math.round(e*h+r*u),[_,M]=f.valid,g=m(s),{x:y,y:w}=l.targetGeometry,x=[y,w],b=[0,0];o.toScreen(b,x);const j=[0,0];let O;O=v>a?.5*a:.5*v;const R=Math.floor((y+.5*g)/g),q=_+R*g,S=M+R*g,G=[b[0]+O,0];o.toMap(j,G),j[0]>S&&(p=g),G[0]=b[0]-O,o.toMap(j,G),j[0]<q&&(p=-g),d={worldWidth:g,xBounds:[_,M]}}for(const t of r)t.updateDrawCoords(c,p,s,d)}}export{u as default};\n"],"names":["x","i","t","e","y","h","a","w","s","r","g","S","l","m","j","p","o","v","c","u","f","n","d","_","M","b","R","O","q","G"],"mappings":"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","x_google_ignoreList":[0,1,2]}