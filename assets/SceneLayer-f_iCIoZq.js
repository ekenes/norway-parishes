const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/loadGLTFMesh-BRSFzU77.js","assets/index-BlI3-bLW.js","assets/index-DQ5T3qjA.css","assets/mat3-B87gwDFC.js","assets/mat3f64-q3fE-ZOt.js","assets/MeshVertexAttributes-DmLKRN9f.js","assets/meshVertexSpaceUtils-DTgChxUV.js","assets/vec32-Bu1rR2Op.js","assets/MeshLocalVertexSpace-JIunC1y7.js","assets/BufferView-Bqo2J_iG.js","assets/vec3-C90jqwuf.js","assets/vec4-BiQib4bp.js","assets/types-D0PSWh4d.js","assets/loader-BrH0_nzu.js","assets/mat4f64-CSKppSlJ.js","assets/enums-Dk3osxpS.js","assets/quat-WKekXwkC.js","assets/quatf64-aQ5IuZRd.js","assets/resourceUtils-D4ZmAcrn.js","assets/basicInterfaces-CZwQPxTp.js","assets/DefaultMaterial_COLOR_GAMMA-TTHVcyEl.js","assets/Indices-CKxq5z-Y.js","assets/vertexSpaceConversion-B_6JcWmu.js","assets/spatialReferenceEllipsoidUtils-C_ngEmk8.js","assets/computeTranslationToOriginAndRotation-B6_Giu2C.js","assets/projectPointToVector-DI38NV1n.js","assets/MultiOriginJSONSupport-CLK2ozmu.js","assets/MeshTransform-C-qgZjqt.js","assets/imageUtils-BHxjPLz8.js","assets/earcut-D9gy186-.js","assets/plane-ELSex9JT.js","assets/deduplicate-D--FvS9N.js","assets/External-wHjE1CET.js","assets/infoFor3D-CxdEiWhp.js","assets/meshSpatialReferenceScaleUtils-BbN3CUAN.js","assets/APIKeyMixin-V3YcjKVy.js","assets/ArcGISService-D9SJk9Mi.js","assets/CustomParametersMixin-DC6OQ-5P.js","assets/EditBusLayer-D-5j5aG2.js","assets/uuid-Cl5lrJ4c.js","assets/OperationalLayer-DBxMHjzI.js","assets/commonProperties-DvEUYxLA.js","assets/PortalLayer-BaAKk7vv.js","assets/portalItemUtils-bWLVBGJL.js","assets/SceneService-DxAJ7kLh.js","assets/originUtils-D69mHv66.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/HeightModelInfo-C6jIS8MN.js","assets/jsonContext-D13udXzk.js","assets/resourceUtils-DAW3VIE8.js","assets/resourceUtils-QmuB0Qg0.js","assets/saveUtils-DGWnRgtr.js","assets/TemporalLayer-DBJPCy1y.js","assets/TimeInfo-C7f55tHf.js","assets/associatedFeatureServiceUtils-D6gugCgA.js","assets/capabilities-D6exRNM4.js","assets/featureLayerUtils-C1mHgQA4.js","assets/FeatureReductionSelection-D8Sji-4b.js","assets/fieldProperties-Be4kZaoh.js","assets/I3SLayerDefinitions-BaMOqF_D.js","assets/labelingInfo-BbgRIaM8.js","assets/labelUtils-DiXPDPuN.js","assets/LayerFloorInfo-6l4YFx2O.js","assets/fetchService-smNlLw9I.js","assets/persistable-DwRXUmWD.js","assets/MD5-C9MwAd2G.js","assets/resourceExtension-Dma0I9DK.js","assets/styleUtils-B4Xw6O6K.js","assets/elevationInfoUtils-DYWR81oj.js","assets/popupUtils-Cyp6Hd78.js","assets/I3SUtil-CnAfrcbd.js","assets/projectVectorToVector-tbCN3rJ2.js","assets/sphere-CIp6bdxt.js","assets/I3SBinaryReader-CzeNUf3D.js","assets/VertexAttribute-BdZWZuT1.js","assets/floatRGBA-4DyfiAUr.js","assets/NormalAttribute.glsl-BHkqxUmf.js","assets/interfaces-DDtDqZYj.js","assets/BindType-BmZEZMMh.js","assets/orientedBoundingBox-J7x9gH3o.js","assets/ViewingMode-dBUh39ak.js","assets/popupUtils-BiRx-K58.js","assets/gltfexport-D6KdhYNo.js","assets/editingSupport-lDfEVIjI.js"])))=>i.map(i=>d[i]);
import{O as Q,eK as Je,df as Pe,j as n,m as u,gD as fr,u as mr,o as k,k as _,M as Ft,aY as Rt,s as R,b7 as ge,bd as Ye,I as b,d0 as E,fG as yr,b2 as gr,a8 as vr,lN as wr,lO as xr,lP as Be,j2 as he,bF as br,aN as F,bR as Ce,lQ as $r,io as Xe,lR as Ue,bV as _t,aX as Sr,bW as Tr,hR as Ot,_ as ue,w as Re,by as M,fx as Ir,lS as Ar,k2 as Lr,hg as Fr,ay as Rr,hS as _r,ae as _e,ar as jt,lT as Et,fW as Dt,lU as Mt,fU as Pt,lV as Ct,ho as Oe,c_ as Or,fv as jr,g9 as Er,hY as Dr,f7 as Mr,ao as Pr,c7 as Cr,c3 as ve,lj as Ur,lW as Nr,p as et,n as tt,ex as Wr,Y as rt,hE as zr,al as qr,eU as Vr,U as Ut,bk as Gr,eA as kr,v as Hr,Z as Br,gE as st,z as Qr,fl as Kr,l5 as Zr,d6 as Jr,X as it,gJ as at,bc as Ee,x as Yr,dM as Xr,eB as es,k4 as ts,gF as rs,$ as ss}from"./index-BlI3-bLW.js";import{S as is}from"./MultiOriginJSONSupport-CLK2ozmu.js";import{N as ce,z as Nt,w as be,k as Wt,j as zt,d as as}from"./MeshTransform-C-qgZjqt.js";import{c as ns}from"./imageUtils-BHxjPLz8.js";import{n as os,r as ls,p as $e}from"./MeshVertexAttributes-DmLKRN9f.js";import{a as Ne,b as Se}from"./MeshLocalVertexSpace-JIunC1y7.js";import{a as de,s as Te,g as qt,u as us}from"./meshVertexSpaceUtils-DTgChxUV.js";import{e as cs}from"./earcut-D9gy186-.js";import{t as Vt}from"./Indices-CKxq5z-Y.js";import{o as Ie,c as ps,u as ds,N as We,A as hs,z as Gt,E as fs,g as ms}from"./vec32-Bu1rR2Op.js";import{O as ys,v as gs,M as vs}from"./plane-ELSex9JT.js";import{e as nt}from"./deduplicate-D--FvS9N.js";import{c as W}from"./projectPointToVector-DI38NV1n.js";import{F as I,B as ze,O as G,n as ws,k as kt,g as Ht,E as Bt,w as Qt,h as Kt,R as Zt,G as Jt}from"./vertexSpaceConversion-B_6JcWmu.js";import{e as je}from"./mat4f64-CSKppSlJ.js";import{a as Qe}from"./spatialReferenceEllipsoidUtils-C_ngEmk8.js";import{C as Yt}from"./computeTranslationToOriginAndRotation-B6_Giu2C.js";import{e as ot,i as xs}from"./vec3-C90jqwuf.js";import{o as lt,h as bs,m as $s}from"./External-wHjE1CET.js";import{e as Xt}from"./mat3f64-q3fE-ZOt.js";import{n as Ss}from"./mat3-B87gwDFC.js";import{b as Ts}from"./quat-WKekXwkC.js";import{e as Is,r as As}from"./quatf64-aQ5IuZRd.js";import{i as Ls,m as Fs,a as Rs}from"./meshSpatialReferenceScaleUtils-BbN3CUAN.js";import{i as _s}from"./APIKeyMixin-V3YcjKVy.js";import{l as Os}from"./ArcGISService-D9SJk9Mi.js";import{e as js}from"./CustomParametersMixin-DC6OQ-5P.js";import{F as Es}from"./EditBusLayer-D-5j5aG2.js";import{b as Ds}from"./OperationalLayer-DBxMHjzI.js";import{j as Ms}from"./PortalLayer-BaAKk7vv.js";import{R as Ps,V as ut}from"./SceneService-DxAJ7kLh.js";import{f as Cs}from"./TemporalLayer-DBJPCy1y.js";import{d as ct,l as Us}from"./TimeInfo-C7f55tHf.js";import{s as Ns}from"./associatedFeatureServiceUtils-D6gugCgA.js";import{t as Ws}from"./capabilities-D6exRNM4.js";import{c as zs,p as qs,d as Vs,l as Gs,s as ks}from"./commonProperties-DvEUYxLA.js";import{Z as Hs,K as Bs}from"./featureLayerUtils-C1mHgQA4.js";import{p as Qs,t as Ks}from"./FeatureReductionSelection-D8Sji-4b.js";import{s as Zs}from"./fieldProperties-Be4kZaoh.js";import{p as er,a as Js,y as Ys,m as Xs}from"./I3SLayerDefinitions-BaMOqF_D.js";import{r as ei,n as ti}from"./infoFor3D-CxdEiWhp.js";import{n as pt,C as ri}from"./labelingInfo-BbgRIaM8.js";import{p as si}from"./LayerFloorInfo-6l4YFx2O.js";import{b as ii}from"./fetchService-smNlLw9I.js";import{j as ai}from"./persistable-DwRXUmWD.js";import{t as ni}from"./styleUtils-B4Xw6O6K.js";import{$ as dt,P as oi,w as li}from"./elevationInfoUtils-DYWR81oj.js";import{p as ui}from"./popupUtils-Cyp6Hd78.js";import{V as ci}from"./I3SUtil-CnAfrcbd.js";import{n as pi,p as di}from"./popupUtils-BiRx-K58.js";var K;const De=new WeakMap;let hi=0,C=K=class extends Q{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,s){if(e instanceof HTMLImageElement){const i={type:"image-element",src:Je(e.src,s),crossOrigin:e.crossOrigin};t[r]=i}else if(e instanceof HTMLCanvasElement){const i={type:"canvas-element",imageData:ht(e.getContext("2d").getImageData(0,0,e.width,e.height))};t[r]=i}else if(e instanceof HTMLVideoElement){const i={type:"video-element",src:Je(e.src,s),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=i}else if(e instanceof ImageData){const i={type:"image-data",imageData:ht(e)};t[r]=i}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=ft(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return ft(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const{data:e,url:t}=this;return e instanceof HTMLCanvasElement?mt(e.getContext("2d").getImageData(0,0,e.width,e.height)):e instanceof ImageData?mt(e):!(!(t!=null&&t.toLowerCase().endsWith(".png"))&&!(t!=null&&t.toLocaleLowerCase().startsWith("data:image/png;")))}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(De.has(this.data)||De.set(this.data,++hi),t(De.get(this.data))):t()}get memoryUsage(){let e=0;if(e+=this.url!=null?this.url.length:0,this.data!=null){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new K(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(e){return typeof e=="string"?new K({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new K({data:e}):Pe(K,e)}};function ht(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}function ft(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return ns(r,e.width,e.height)}function mt(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}n([u({type:String,json:{write:fr}})],C.prototype,"url",null),n([u({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),u()],C.prototype,"data",null),n([mr("data")],C.prototype,"writeData",null),n([k("data")],C.prototype,"readData",null),n([u({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],C.prototype,"transparent",null),n([u({json:{write:!0}})],C.prototype,"wrap",void 0),n([u({readOnly:!0})],C.prototype,"contentHash",null),C=K=n([_("esri.geometry.support.MeshTexture")],C);const oe=C;let Z=class extends Ft(Q){constructor(t){super(t),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};n([u({type:[Number],nonNullable:!0,json:{write:!0}})],Z.prototype,"offset",void 0),n([u({type:Number,nonNullable:!0,json:{write:!0}})],Z.prototype,"rotation",void 0),n([u({type:[Number],nonNullable:!0,json:{write:!0}})],Z.prototype,"scale",void 0),Z=n([_("esri.geometry.support.MeshTextureTransform")],Z);const le=Z;var qe;let D=qe=class extends Q{constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const s=new qe(this.clonePropertiesWithDeduplication(t));return e!=null&&e.set(this,s),s}clonePropertiesWithDeduplication(e){var t,r,s,i;return{color:this.color!=null?this.color.clone():null,colorTexture:(t=this.colorTexture)==null?void 0:t.cloneWithDeduplication(e),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(s=this.colorTextureTransform)==null?void 0:s.clone(),normalTextureTransform:(i=this.normalTextureTransform)==null?void 0:i.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=this.color!=null?16:0,this.colorTexture!=null&&(e+=this.colorTexture.memoryUsage),e+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(e+=this.normalTexture.memoryUsage),e+=this.normalTextureTransform!=null?20:0,e}};n([u({type:Rt,json:{write:!0}})],D.prototype,"color",void 0),n([u({type:oe,json:{write:!0}})],D.prototype,"colorTexture",void 0),n([u({type:le,json:{write:!0}})],D.prototype,"colorTextureTransform",void 0),n([u({type:oe,json:{write:!0}})],D.prototype,"normalTexture",void 0),n([u({type:le,json:{write:!0}})],D.prototype,"normalTextureTransform",void 0),n([u({nonNullable:!0,json:{write:!0}})],D.prototype,"alphaMode",void 0),n([u({nonNullable:!0,json:{write:!0}})],D.prototype,"alphaCutoff",void 0),n([u({nonNullable:!0,json:{write:!0}})],D.prototype,"doubleSided",void 0),D=qe=n([_("esri.geometry.support.MeshMaterial")],D);const Ke=D;var Ve;let O=Ve=class extends Ke{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const s=new Ve(this.clonePropertiesWithDeduplication(t));return e!=null&&e.set(this,s),s}getMemoryUsage(){let e=super.getMemoryUsage();return e+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(e+=this.emissiveTexture.memoryUsage),e+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(e+=this.occlusionTexture.memoryUsage),e+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=this.metallicRoughnessTextureTransform!=null?20:0,e}clonePropertiesWithDeduplication(e){var t,r,s,i,a,o,l;return{...super.clonePropertiesWithDeduplication(e),emissiveColor:(t=this.emissiveColor)==null?void 0:t.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(e),emissiveTextureTransform:(s=this.emissiveTextureTransform)==null?void 0:s.clone(),occlusionTexture:(i=this.occlusionTexture)==null?void 0:i.cloneWithDeduplication(e),occlusionTextureTransform:(a=this.occlusionTextureTransform)==null?void 0:a.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(e),metallicRoughnessTextureTransform:(l=this.metallicRoughnessTextureTransform)==null?void 0:l.clone()}}};n([u({type:Rt,json:{write:!0}})],O.prototype,"emissiveColor",void 0),n([u({type:oe,json:{write:!0}})],O.prototype,"emissiveTexture",void 0),n([u({type:le,json:{write:!0}})],O.prototype,"emissiveTextureTransform",void 0),n([u({type:oe,json:{write:!0}})],O.prototype,"occlusionTexture",void 0),n([u({type:le,json:{write:!0}})],O.prototype,"occlusionTextureTransform",void 0),n([u({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],O.prototype,"metallic",void 0),n([u({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],O.prototype,"roughness",void 0),n([u({type:oe,json:{write:!0}})],O.prototype,"metallicRoughnessTexture",void 0),n([u({type:le,json:{write:!0}})],O.prototype,"metallicRoughnessTextureTransform",void 0),O=Ve=n([_("esri.geometry.support.MeshMaterialMetallicRoughness")],O);const fi=O;var ie;let U=ie=class extends Q{static from(e){return Pe(ie,e)}constructor(e){super(e),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return os(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},R.getLogger(this))}castMaterial(e){return Pe(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?fi:Ke,e)}clone(){return new ie({faces:ge(this.faces),shading:this.shading,material:ge(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(e,t){const r={faces:ge(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new ie(r)}get memoryUsage(){let e=0;return this.faces!=null&&(e+=this.faces.byteLength),this.material!=null&&(e+=this.material.memoryUsage),e}};n([u({json:{write:ls}})],U.prototype,"faces",void 0),n([Ye("faces")],U.prototype,"castFaces",null),n([u({type:Ke,json:{write:!0}})],U.prototype,"material",void 0),n([Ye("material")],U.prototype,"castMaterial",null),n([u({json:{write:!0}})],U.prototype,"name",void 0),n([u({type:String,json:{write:!0}})],U.prototype,"shading",void 0),n([u({type:Boolean})],U.prototype,"trustSourceNormals",void 0),U=ie=n([_("esri.geometry.support.MeshComponent")],U);const te=U,mi="Mesh must be loaded before applying operations",yi="Provided component is not part of the list of components",gi="Expected polygon to be a Polygon instance",ae="Expected location to be a Point instance";let yt=class extends b{constructor(){super("invalid-input:location",ae)}};function vi(e,t,r){const s=wi(gt,e,t,r)?ys(gt):[0,0,1];return Math.abs(s[2])>Math.cos(yr(80))?E.Z:Math.abs(s[1])>Math.abs(s[0])?E.Y:E.X}function wi(e,t,r,s){const i=(o=>!Array.isArray(o[0]))(t)?(o,l)=>t[3*o+l]:(o,l)=>t[o][l],a=s?gr(s)/vr(s):1;return gs(e,(o,l)=>Ie(o,i(l,0)*a,i(l,1)*a,i(l,2)),r)}const gt=vs();function xi(e){const t=$i(e.rings,e.hasZ,Ae.CCW_IS_HOLE,e.spatialReference),r=new Array;let s=0,i=0;for(const l of t.polygons){const c=l.count,p=l.index,d=wr(t.position,3*p,3*c),m=l.holeIndices.map(f=>f-p),y=Vt(cs(d,m,3));r.push({position:d,faces:y}),s+=d.length,i+=y.length}const a=bi(r,s,i),o=Array.isArray(a.position)?nt(a.position,3,{originalIndices:a.faces}):nt(a.position.buffer,6,{originalIndices:a.faces});return a.position=xr(new Float64Array(o.buffer)),a.faces=o.indices,a}function bi(e,t,r){if(e.length===1)return e[0];const s=Be(t),i=new Array(r);let a=0,o=0,l=0;for(const c of e){for(let p=0;p<c.position.length;p++)s[a++]=c.position[p];for(const p of c.faces)i[o++]=p+l;l=a/3}return{position:s,faces:Vt(i)}}function $i(e,t,r,s){const i=e.length,a=new Array(i),o=new Array(i),l=new Array(i);let c=0;for(let g=0;g<i;++g)c+=e[g].length;let p=0,d=0,m=0;const y=Be(3*c);let f=0;for(let g=i-1;g>=0;g--){const v=e[g],$=r===Ae.CCW_IS_HOLE&&Si(v,t,s);if($&&i!==1)a[p++]=v;else{let A=v.length;for(let w=0;w<p;++w)A+=a[w].length;const x={index:f,pathLengths:new Array(p+1),count:A,holeIndices:new Array(p)};x.pathLengths[0]=v.length,v.length>0&&(l[m++]={index:f,count:v.length}),f=$?fe(v,v.length-1,-1,y,f,v.length,t):fe(v,0,1,y,f,v.length,t);for(let w=0;w<p;++w){const T=a[w];x.holeIndices[w]=f,x.pathLengths[w+1]=T.length,T.length>0&&(l[m++]={index:f,count:T.length}),f=fe(T,0,1,y,f,T.length,t)}p=0,x.count>0&&(o[d++]=x)}}for(let g=0;g<p;++g){const v=a[g];v.length>0&&(l[m++]={index:f,count:v.length}),f=fe(v,0,1,y,f,v.length,t)}return o.length=d,l.length=m,{position:y,polygons:o,outlines:l}}function fe(e,t,r,s,i,a,o){i*=3;for(let l=0;l<a;++l){const c=e[t];s[i++]=c[0],s[i++]=c[1],s[i++]=o&&c[2]?c[2]:0,t+=r}return i/3}function Si(e,t,r){if(!t)return!he(e);const s=e.length-1;switch(vi(e,s,r)){case E.X:return!he(e,E.Y,E.Z);case E.Y:return!he(e,E.X,E.Z);case E.Z:return!he(e,E.X,E.Y)}}var Ae;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Ae||(Ae={}));function Ze(e,t,r,s){if(s!==void 0){br(e(),"option: geographic",{replacement:"Use mesh `vertexSpace` and spatial reference to control how operations are performed instead.",version:"4.30",warnOnce:!0});const i=t.type==="local";if(!de(t)||s===i)return r.isGeographic||r.isWebMercator&&s;e().warnOnce(`Specifying the 'geographic' parameter (${s}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}switch(t.type){case"georeferenced":return r.isGeographic;case"local":return r.isGeographic||r.isWebMercator}}const pe=()=>R.getLogger("esri.geometry.support.meshUtils.centerAt");function Ti(e,t,r){var o;if(!((o=e.vertexAttributes)!=null&&o.position))return;const{vertexSpace:s}=e,i=(r==null?void 0:r.origin)??e.origin,a=Ze(pe,s,i.spatialReference,r==null?void 0:r.geographic);de(s)?Ii(e,t,i):a?Ai(e,t,i):Li(e,t,i)}function Ii(e,t,r){const{vertexSpace:s}=e;if(!de(s))return;const i=rr,a=tr;if(!W(t,a,e.spatialReference))return void I(pe(),t.spatialReference,e.spatialReference,G);if(!W(r,i,e.spatialReference)){const l=e.origin;return i[0]=l.x,i[1]=l.y,i[2]=l.z,void I(pe(),r.spatialReference,e.spatialReference,G)}const o=ps(Ri,a,i);s.origin=ds(F(),s.origin,o)}function Ai(e,t,r){const s=Ce(r.x,r.y,r.z??0),i=ze(e,new Ne({origin:s}));if(!i)return;const a=Ce(t.x,t.y,t.z??0),o=ze({vertexAttributes:i,spatialReference:e.spatialReference,vertexSpace:new Ne({origin:a})},Se.absolute);if(!o)return;const{position:l,normal:c,tangent:p}=o;e.vertexAttributes.position=l,e.vertexAttributes.normal=c,e.vertexAttributes.tangent=p,e.vertexAttributesChanged()}function Li(e,t,r){const s=rr,i=tr;if(W(t,i,e.spatialReference)){if(!W(r,s,e.spatialReference)){const a=e.origin;return s[0]=a.x,s[1]=a.y,s[2]=a.z,void I(pe(),r.spatialReference,e.spatialReference,G)}Fi(e.vertexAttributes.position,i,s),e.vertexAttributesChanged()}else I(pe(),t.spatialReference,e.spatialReference,G)}function Fi(e,t,r){if(e)for(let s=0;s<e.length;s+=3)for(let i=0;i<3;i++)e[s+i]+=t[i]-r[i]}const tr=F(),rr=F(),Ri=F();function _i(e){const{spatialReference:t,vertexSpace:r,untransformedBounds:s}=e,i=$r(s,Oi);if(de(r)&&e.transform&&ot(i,i,e.transform.localMatrix),r.type==="georeferenced"){const l=r.origin;return l&&xs(i,i,l),Xe(Ue(i),t)}const a=Qe(t),o=r.origin;if(!_t(a,t)){const[l,c,p]=o;return new Sr({xmin:l,ymin:c,zmin:p,xmax:l,ymax:c,zmax:p,spatialReference:t})}return Yt(t,o,vt,a),ot(i,i,vt),Tr(i,a,0,i,t,0),Xe(Ue(i),t)}const vt=je(),Oi=Be(24);async function ji(e,t,r){const{source:s}=t,{loadGLTFMesh:i}=await Ot(ue(()=>import("./loadGLTFMesh-BRSFzU77.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81])),r),a=await Di(s,r);Re(r);const o=i(new M({x:0,y:0,z:0,spatialReference:e.spatialReference}),a.url,{resolveFile:Ei(a),signal:r==null?void 0:r.signal,expectedType:a.type,unitConversionDisabled:t.unitConversionDisabled});o.then(()=>a.dispose(),()=>a.dispose());const{vertexAttributes:l,components:c}=await o;e.vertexAttributes=l,e.components=c}function Ei(e){const t=Ir(e.url);return r=>{const s=Ar(r,t,t),i=s?s.replace(/^ *\.\//,""):null;return(i?e.files.get(i):null)??r}}async function Di(e,t){if(Array.isArray(e)){if(!e.length)throw new b("mesh-load-external:missing-assets","There must be at least one file to load");return e[0]instanceof File?Pi(e):Ci(e,t)}return sr(e)}async function Mi(e,t){const{parts:r,assetMimeType:s,assetName:i}=e;if(r.length===1)return new Le(r[0].partUrl);const a=await e.toBlob(t);return Re(t),Le.fromBlob(a,lr(i,s))}function sr(e){return Le.fromBlob(e,lr(e.name,e.type))}function Pi(e){return nr(e.map(t=>({name:t.name,mimeType:t.type,source:sr(t)})))}async function Ci(e,t){const r=await Lr(e.map(async s=>{const i=await Mi(s);return Re(t),{name:s.assetName,mimeType:s.assetMimeType,source:i}}));if(Fr(t))throw r.forEach(s=>s.source.dispose()),Rr();return nr(r)}const ir=/^model\/gltf\+json$/,ar=/^model\/gltf-binary$/,Ge=/\.gltf$/i,Ui=/\.glb$/i;function wt({mimeType:e,source:t,name:r}){return ir.test(e)||Ge.test(r)?{url:t.url,type:"gltf"}:ar.test(e)||Ui.test(r)?{url:t.url,type:"glb"}:null}function nr(e){const t=new Map;let r=null,s=null;for(const a of e){const{source:o,name:l}=a;r??(r=wt(a)),l==="ESRI3DO_NORM.glb"&&(s=wt(a)),t.set(l,o.url),o.files.forEach((c,p)=>t.set(p,c))}const i=s??r;if(i==null)throw new b("mesh-load-external:missing-files","Missing files to load external mesh source");return new Le(i.url,()=>e.forEach(({source:a})=>a.dispose()),t,i.type)}let Le=class or{constructor(t,r=()=>{},s=new Map,i){this.url=t,this.dispose=r,this.files=s,this.type=i}static fromBlob(t,r){const s=URL.createObjectURL(t);return new or(s,()=>URL.revokeObjectURL(s),void 0,r)}};function lr(e,t){return ir.test(t)||Ge.test(e)?"gltf":ar.test(t)||Ge.test(e)?"glb":void 0}let N=class extends _r{constructor(t){super(t),this.externalSources=new _e,this._explicitDisplaySource=null,this.georeferenced=!1,this.addHandles(jt(()=>this.externalSources,"after-remove",({item:r})=>{r===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(t){if(t!=null&&!lt(t))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=t,t&&this.externalSources.every(r=>!bs(r,t))&&this.externalSources.add(t)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(t){return this.externalSources.items.filter(r=>$s(r,t))}get _implicitDisplaySource(){return this.externalSources.find(lt)}};n([u()],N.prototype,"externalSources",void 0),n([u()],N.prototype,"displaySource",null),n([u()],N.prototype,"_implicitDisplaySource",null),n([u()],N.prototype,"_explicitDisplaySource",void 0),n([u()],N.prototype,"georeferenced",void 0),N=n([_("esri.geometry.support.meshUtils.Metadata")],N);function Ni(){const{faceDescriptions:e,faceVertexOffsets:t,uvScales:r}=Qi,s=4*e.length,i=new Float64Array(3*s),a=new Float32Array(3*s),o=new Float32Array(2*s),l=new Uint32Array(2*e.length*3);let c=0,p=0,d=0,m=0;for(let y=0;y<e.length;y++){const f=e[y],g=c/3;for(const $ of t)l[m++]=g+$;const v=f.corners;for(let $=0;$<4;$++){const A=v[$];let x=0;o[d++]=.25*r[$][0]+f.uvOrigin[0],o[d++]=f.uvOrigin[1]-.25*r[$][1];for(let w=0;w<3;w++)f.axis[w]!==0?(i[c++]=.5*f.axis[w],a[p++]=f.axis[w]):(i[c++]=.5*A[x++],a[p++]=0)}}return{position:i,normal:a,uv:o,faces:l}}function Wi(e,t){const r=e.components[0],s=r.faces,i=Ki[t],a=6*i,o=new Array(6),l=new Array(s.length-6);let c=0,p=0;for(let d=0;d<s.length;d++)d>=a&&d<a+6?o[c++]=s[d]:l[p++]=s[d];if(e.vertexAttributes.uv!=null){const d=new Float32Array(e.vertexAttributes.uv),m=4*i*2,y=[0,1,1,1,1,0,0,0];for(let f=0;f<y.length;f++)d[m+f]=y[f];e.vertexAttributes.uv=d}return e.components=[new te({faces:o,material:r.material}),new te({faces:l})],e}function zi(e=0){const t=Math.round(8*2**e),r=2*t,s=(t-1)*(r+1)+2*r,i=new Float64Array(3*s),a=new Float32Array(3*s),o=new Float32Array(2*s),l=new Uint32Array(3*((t-1)*r*2));let c=0,p=0,d=0,m=0;for(let y=0;y<=t;y++){const f=y/t*Math.PI+.5*Math.PI,g=Math.cos(f),v=Math.sin(f);S[2]=v;const $=y===0||y===t,A=$?r-1:r;for(let x=0;x<=A;x++){const w=x/A*2*Math.PI;S[0]=-Math.sin(w)*g,S[1]=Math.cos(w)*g;for(let T=0;T<3;T++)i[c]=.5*S[T],a[c]=S[T],++c;o[p++]=(x+($?.5:0))/r,o[p++]=y/t,y!==0&&x!==r&&(y!==t&&(l[d++]=m,l[d++]=m+1,l[d++]=m-r),y!==1&&(l[d++]=m,l[d++]=m-r,l[d++]=m-r-1)),m++}}return{position:i,normal:a,uv:o,faces:l}}function qi(e=0){const r=Math.round(16*2**e),s=4*(r+1)+2*r,i=new Float64Array(3*s),a=new Float32Array(3*s),o=new Float32Array(2*s),l=new Uint32Array(3*(4*r));let c=0,p=0,d=0,m=0,y=0;for(let f=0;f<=5;f++){const g=f===0||f===5,v=f<=1||f>=4,$=f===2||f===4,A=g?r-1:r;for(let x=0;x<=A;x++){const w=x/A*2*Math.PI,T=g?0:.5;S[0]=T*Math.sin(w),S[1]=T*-Math.cos(w),S[2]=f<=2?.5:-.5;for(let z=0;z<3;z++)i[c++]=S[z],a[p++]=v?z===2?f<=1?1:-1:0:z===2?0:S[z]/T;o[d++]=(x+(g?.5:0))/r,o[d++]=f<=1?1*f/3:f<=3?1*(f-2)/3+1/3:1*(f-4)/3+2/3,$||f===0||x===r||(f!==5&&(l[m++]=y,l[m++]=y+1,l[m++]=y-r),f!==1&&(l[m++]=y,l[m++]=y-r,l[m++]=y-r-1)),y++}}return{position:i,normal:a,uv:o,faces:l}}function Vi(e,t){const r=typeof t=="number"?t:t!=null?t.width:1,s=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:r,depth:s};case"north":case"south":return{width:r,height:s};case"east":case"west":return{depth:r,height:s}}}function Gi(e){const t=se.facingAxisOrderSwap[e],r=se.position,s=se.normal,i=new Float64Array(r.length),a=new Float32Array(s.length);let o=0;for(let l=0;l<4;l++){const c=o;for(let p=0;p<3;p++){const d=t[p],m=Math.abs(d)-1,y=d>=0?1:-1;i[o]=r[c+m]*y,a[o]=s[c+m]*y,o++}}return{position:i,normal:a,uv:new Float32Array(se.uv),faces:new Uint32Array(se.faces),isPlane:!0}}const me=1,re=2,Me=3,se={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[Me,me,re],west:[-3,-1,re],north:[-1,Me,re],south:[me,-3,re],up:[me,re,Me],down:[me,-2,-3]}};function ye(e,t,r){e.isPlane||ki(e),Bi(e,Hi(r==null?void 0:r.size,r==null?void 0:r.unit,t.spatialReference));const s=Te(t,r),i=t.spatialReference.isGeographic?Te(t):s,a=ze({vertexAttributes:e,vertexSpace:i,spatialReference:t.spatialReference},s,{allowBufferReuse:!0});return{vertexAttributes:new $e({...a,uv:e.uv}),vertexSpace:s,components:[new te({faces:e.faces,material:(r==null?void 0:r.material)||null})],spatialReference:t.spatialReference}}function ki(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function Hi(e,t,r){const s=ws(t,r);if(e==null&&s===1)return null;if(e==null)return[s,s,s];if(typeof e=="number"){const i=e*s;return[i,i,i]}return[e.width!=null?e.width*s:s,e.depth!=null?e.depth*s:s,e.height!=null?e.height*s:s]}function Bi(e,t){if(t!=null){q[0]=t[0],q[4]=t[1],q[8]=t[2];for(let r=0;r<e.position.length;r+=3){for(let s=0;s<3;s++)S[s]=e.position[r+s];We(S,S,q);for(let s=0;s<3;s++)e.position[r+s]=S[s]}if(t[0]!==t[1]||t[1]!==t[2]){q[0]=1/t[0],q[4]=1/t[1],q[8]=1/t[2];for(let r=0;r<e.normal.length;r+=3){for(let s=0;s<3;s++)S[s]=e.normal[r+s];We(S,S,q),hs(S,S);for(let s=0;s<3;s++)e.normal[r+s]=S[s]}}}}const Qi={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Ki={south:0,east:1,north:2,west:3,up:4,down:5},S=F(),q=Xt(),H=()=>R.getLogger("esri.geometry.support.meshUtils.rotate");function Zi(e,t,r){var c;if(!((c=e.vertexAttributes)!=null&&c.position)||t[3]===0)return;const{spatialReference:s,vertexSpace:i}=e,a=(r==null?void 0:r.origin)??e.origin,o=r==null?void 0:r.geographic,l=Ze(H,i,s,o);qt(e)?Ji(e,t,a):l?Yi(e,t,a):Xi(e,t,a)}function Ji(e,t,r){e.transform??(e.transform=new ce);const{vertexSpace:s,transform:i,spatialReference:a}=e,[o,l,c]=s.origin,p=new M({x:o,y:l,z:c,spatialReference:a}),d=Y;if(p.equals(r))Ie(d,0,0,0);else if(!kt(d,r,e))return void I(H(),r.spatialReference,a,G);Ts(St,be(t),Nt(t));const m=Et(xt,St,Oe,jr,d),{localMatrix:y}=i,f=Dt(xt,m,y);i.scale=Mt(F(),f),Pt(f,f,Gt(Y,i.scale));const g=i.rotationAxis;i.rotation=Wt(f),i.rotationAngle===0&&(i.rotationAxis=g),i.translation=Ct(F(),f)}function Yi(e,t,r){const s=e.spatialReference,i=Qe(s),a=ur;if(!W(r,a,i)&&(I(H(),r.spatialReference,i,"Falling back to mesh origin"),!W(e.origin,a,i)))return void I(H(),e.origin.spatialReference,i);const o=e.vertexAttributes.position,l=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,p=new Float64Array(o.length),d=l!=null?new Float32Array(l.length):null,m=c!=null?new Float32Array(c.length):null;Yt(i,a,Fe,i),Ss($t,Fe);const y=bt;We(be(bt),be(t),$t),y[3]=t[3],Ht(o,s,p,i)&&(l==null||d==null||Bt(l,o,s,p,i,d))&&(c==null||m==null||Qt(c,o,s,p,i,m))?(ee(p,y,3,a),Kt(p,i,o,s)&&(l==null||d==null||(ee(d,y,3),Zt(d,o,s,p,i,l)))&&(c==null||m==null||(ee(m,y,4),Jt(m,o,s,p,i,c)))?e.vertexAttributesChanged():I(H(),i,s)):I(H(),s,i)}function Xi(e,t,r){const s=ur;if(!W(r,s,e.spatialReference)){const i=e.origin;return s[0]=i.x,s[1]=i.y,s[2]=i.z,void I(H(),r.spatialReference,e.spatialReference,G)}ee(e.vertexAttributes.position,t,3,s),ee(e.vertexAttributes.normal,t,3),ee(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function ee(e,t,r,s=Oe){if(e!=null){Or(Fe,Nt(t),be(t));for(let i=0;i<e.length;i+=r){for(let a=0;a<3;a++)Y[a]=e[i+a]-s[a];fs(Y,Y,Fe);for(let a=0;a<3;a++)e[i+a]=Y[a]+s[a]}}}const Y=F(),xt=je(),bt=zt(),Fe=je(),$t=Xt(),ur=F(),St=Is(),B=()=>R.getLogger("esri.geometry.support.meshUtils.scale");function ea(e,t,r){var c;if(!((c=e.vertexAttributes)!=null&&c.position))return;const{vertexSpace:s,spatialReference:i}=e,a=(r==null?void 0:r.origin)??e.origin,o=r==null?void 0:r.geographic,l=Ze(B,s,i,o);qt(e)?ta(e,t,a):l?ra(e,t,a):sa(e,t,a)}function ta(e,t,r){e.transform??(e.transform=new ce);const{vertexSpace:s,transform:i,spatialReference:a}=e,[o,l,c]=s.origin,p=new M({x:o,y:l,z:c,spatialReference:a}),d=X;if(p.equals(r))Ie(d,0,0,0);else if(!kt(d,r,e))return void I(B(),r.spatialReference,a,G);const m=Ie(ia,t,t,t),y=Et(Tt,As,Oe,m,d),{localMatrix:f}=i,g=Dt(Tt,y,f);i.scale=Mt(F(),g),Pt(g,g,Gt(X,i.scale));const v=i.rotationAxis;i.rotation=Wt(g),i.rotationAngle===0&&(i.rotationAxis=v),i.translation=Ct(F(),g)}function ra(e,t,r){const s=e.spatialReference,i=Qe(s),a=pr;if(!W(r,a,i)&&(I(B(),r.spatialReference,i,"Falling back to mesh origin"),!W(e.origin,a,i)))return void I(B(),e.origin.spatialReference,i);const o=e.vertexAttributes.position,l=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,p=new Float64Array(o.length),d=l!=null?new Float32Array(l.length):null,m=c!=null?new Float32Array(c.length):null;Ht(o,s,p,i)&&(l==null||d==null||Bt(l,o,s,p,i,d))&&(c==null||m==null||Qt(c,o,s,p,i,m))?(cr(p,t,a),Kt(p,i,o,s)&&(l==null||d==null||Zt(d,o,s,p,i,l))&&(c==null||m==null||Jt(m,o,s,p,i,c))?e.vertexAttributesChanged():I(B(),i,s)):I(B(),s,i)}function sa(e,t,r){const s=pr;if(!W(r,s,e.spatialReference)){const i=e.origin;return s[0]=i.x,s[1]=i.y,s[2]=i.z,void I(B(),r.spatialReference,e.spatialReference,G)}cr(e.vertexAttributes.position,t,s),e.vertexAttributesChanged()}function cr(e,t,r=Oe){if(e)for(let s=0;s<e.length;s+=3){for(let i=0;i<3;i++)X[i]=e[s+i]-r[i];ms(X,X,t);for(let i=0;i<3;i++)e[s+i]=X[i]+r[i]}}const X=F(),ia=F(),Tt=je(),pr=F();var j;const dr="esri.geometry.Mesh";function P(){return R.getLogger(dr)}const aa={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:Se,local:Ne}};let L=j=class extends Er.LoadableMixin(Dr(Mr)){constructor(e){super(e),this.components=null,this.vertexSpace=new Se,this.transform=null,this.metadata=new N,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new $e,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(Pr(()=>{var e;return{vertexAttributes:this.vertexAttributes,components:(e=this.components)==null?void 0:e.map(t=>t.clone())}},()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){var e;return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):((e=this.metadata.displaySource)==null?void 0:e.extent)!=null}get _transformedExtent(){const{spatialReference:e,vertexSpace:t}=this,r=this;return _i({get transform(){return r.transform},vertexSpace:t,spatialReference:e,untransformedBounds:this._untransformedBounds})}get _untransformedBounds(){const{vertexAttributes:{position:e},components:t}=this;return e.length===0||(t==null?void 0:t.length)===0?Cr(Nr):Ue(e)}get origin(){const e=us(this.vertexSpace,this.spatialReference);if(e!=null)return e;const{center:t,zmin:r}=this._transformedExtent;return new M({x:t.x,y:t.y,z:r,spatialReference:this.spatialReference})}get extent(){var e,t;return this.loaded||((t=(e=this.metadata)==null?void 0:e.displaySource)==null?void 0:t.extent)==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(e){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(te.from(e)),this.notifyChange("components"))}removeComponent(e){if(this._checkIfLoaded("removeComponent()")){if(this.components){const t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}P().error("removeComponent()",yi)}}rotate(e,t,r,s){return as(e,t,r,It),Zi(this,It,s),this}offset(e,t,r){if(!this._checkIfLoaded("offset()"))return this;const{vertexSpace:s,vertexAttributes:i}=this,a=i==null?void 0:i.position;if(!a)return this;if(de(s)){const[o,l,c]=s.origin;s.origin=Ce(o+e,l+t,c+r)}else{for(let o=0;o<a.length;o+=3)a[o]+=e,a[o+1]+=t,a[o+2]+=r;this.vertexAttributesChanged()}return this}scale(e,t){return this._checkIfLoaded("scale()")?(ea(this,e,t),this):this}centerAt(e,t){return this._checkIfLoaded("centerAt()")?(Ti(this,e,t),this):this}load(e){const{metadata:{displaySource:t}}=this;return t&&this.addResolvingPromise(ji(this,t,e)),Promise.resolve(this)}addExternalSources(e){this.metadata.externalSources.addMany(e)}updateDisplaySource(e){this.metadata.displaySource=e}clone(){return this.cloneAndModifyVertexAttributes(this.vertexAttributes.clone(),this.vertexSpace.clone(),{preserveMetadata:!0})}cloneAndModifyVertexAttributes(e,t,r){var a;let s=null;if(this.components){const o=new Map,l=new Map;s=this.components.map(c=>c.cloneWithDeduplication(o,l))}const i={components:s,spatialReference:this.spatialReference,vertexAttributes:e,vertexSpace:t,transform:((a=this.transform)==null?void 0:a.clone())??null,metadata:r!=null&&r.preserveMetadata?this.metadata.clone():new N};return new j(i)}cloneShallow(){return new j({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(e){const[{toBinaryGLTF:t}]=await Promise.all([ue(()=>import("./gltfexport-D6KdhYNo.js"),__vite__mapDeps([82,1,2,16,4,17,7,22,3,14,23,24,25,6,8,10,9,11,15,18,19,26,27,28,5,29,21,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81])),this.load(e)]);return Re(e),await t(this,e)}get memoryUsage(){let e=0;if(e+=this.vertexAttributes.memoryUsage,this.components!=null)for(const t of this.components)e+=t.memoryUsage;return e}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(e){return!!this.loaded||(P().error(e,mi),!1)}static createBox(e,t){if(!(e instanceof M))return P().error(".createBox()",ae),null;const r=new j(ye(Ni(),e,t));return t!=null&&t.imageFace&&t.imageFace!=="all"?Wi(r,t.imageFace):r}static createSphere(e,t){return e instanceof M?new j(ye(zi((t==null?void 0:t.densificationFactor)||0),e,t)):(P().error(".createSphere()",ae),null)}static createCylinder(e,t){return e instanceof M?new j(ye(qi((t==null?void 0:t.densificationFactor)||0),e,t)):(P().error(".createCylinder()",ae),null)}static createPlane(e,t){if(!(e instanceof M))return P().error(".createPlane()",ae),null;const r=(t==null?void 0:t.facing)??"up",s=Vi(r,t==null?void 0:t.size);return new j(ye(Gi(r),e,{...t,size:s}))}static createFromPolygon(e,t){if(!(e instanceof ve))return P().error(".createFromPolygon()",gi),null;const r=xi(e);return new j({vertexAttributes:new $e({position:r.position}),components:[new te({faces:r.faces,shading:"flat",material:(t==null?void 0:t.material)??null})],spatialReference:e.spatialReference,vertexSpace:new Se})}static async createFromGLTF(e,t,r){if(!(e instanceof M)){const i=new yt;throw P().error(".createfromGLTF()",i.message),i}const{loadGLTFMesh:s}=await Ot(ue(()=>import("./loadGLTFMesh-BRSFzU77.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81])),r);return new j(await s(e,t,r))}static async createFromFiles(e,t,r){Ur(P(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});const s=i=>P().error(".createFromFiles()",i.message);if(!(e instanceof M)){const i=new yt;throw s(i),i}if(!(r!=null&&r.layer))throw new b("invalid:no-layer","SceneLayer required for file to mesh conversion.");return r.layer.convertMesh(t,{location:e,...r})}static createWithExternalSource(e,t,r){var d;const s=(r==null?void 0:r.extent)??null,{spatialReference:i}=e,a=((d=r==null?void 0:r.transform)==null?void 0:d.clone())??new ce,o=Te(e,r),l=r==null?void 0:r.unitConversionDisabled,c={source:t,extent:s,unitConversionDisabled:l},p=new N;return p.externalSources.push(c),new j({metadata:p,transform:a,vertexSpace:o,spatialReference:i})}static createIncomplete(e,t){var o;const{spatialReference:r}=e,s=((o=t==null?void 0:t.transform)==null?void 0:o.clone())??new ce,i=Te(e,t),a=new j({transform:s,vertexSpace:i,spatialReference:r});return a.addResolvingPromise(Promise.reject(new b("mesh-incomplete","Mesh resources are not complete"))),a}};n([u({type:[te],json:{write:!0}})],L.prototype,"components",void 0),n([u({nonNullable:!0,types:aa,constructOnly:!0,json:{write:!0}})],L.prototype,"vertexSpace",void 0),n([u({type:ce,json:{write:!0}})],L.prototype,"transform",void 0),n([u({constructOnly:!0})],L.prototype,"metadata",void 0),n([u()],L.prototype,"hasExtent",null),n([u()],L.prototype,"_transformedExtent",null),n([u()],L.prototype,"_untransformedBounds",null),n([u()],L.prototype,"origin",null),n([u({readOnly:!0,json:{read:!1}})],L.prototype,"extent",null),n([u({readOnly:!0,json:{read:!1,write:!0,default:!0}})],L.prototype,"hasZ",void 0),n([u({readOnly:!0,json:{read:!1,write:!0,default:!1}})],L.prototype,"hasM",void 0),n([u({type:$e,nonNullable:!0,json:{write:!0}})],L.prototype,"vertexAttributes",void 0),L=j=n([_(dr)],L);const It=zt(),na=L;function hr({associatedLayer:e,serviceUpdateTimeStamp:t}){var l;const r=(l=e==null?void 0:e.editingInfo)==null?void 0:l.lastEditDate,s=e==null?void 0:e.serverGens,i=r!=null,a=t!=null,o=i&&a&&t.lastUpdate!==r.getTime();return i&&(o||!a&&(s==null?void 0:s.minServerGen)!==(s==null?void 0:s.serverGen))}const oa=e=>{let t=class extends e{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){var i;const r=(i=this.associatedLayer)==null?void 0:i.timeInfo;if(r==null)return null;const s=r.clone();return tt(s,this.fieldsIndex),s}set timeInfo(r){tt(r,this.fieldsIndex),this._override("timeInfo",r)}get timeExtent(){var r;return(r=this.associatedLayer)==null?void 0:r.timeExtent}set timeExtent(r){this._override("timeExtent",r)}get timeOffset(){var r;return(r=this.associatedLayer)==null?void 0:r.timeOffset}set timeOffset(r){this._override("timeOffset",r)}get datesInUnknownTimezone(){var r;return((r=this.associatedLayer)==null?void 0:r.datesInUnknownTimezone)??!1}set datesInUnknownTimezone(r){this._override("datesInUnknownTimezone",r)}async loadTimeInfoFromService(r){const{serviceTimeInfo:s}=this;if(s==null)return;const{startTimeField:i,endTimeField:a}=s;if(i==null&&a==null||hr({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;const o=async d=>{var A;let m=null;try{const x=await((A=this.fetchStatistics)==null?void 0:A.call(this,d,r));m=x==null?void 0:x.stats}catch{}if(m==null)return null;const{minTimeStr:y,min:f,maxTimeStr:g,max:v}=m,$=d===i?y??f:g??v;return $!=null?new Date($):null},[l,c]=await Promise.all([o(i),o(a)]);if(i!=null&&l==null||a!=null&&c==null)return;const p=new et({start:l,end:c});this.setAtOrigin("timeInfo",new ct({endField:a,startField:i,fullTimeExtent:p}),"service")}};return n([u({type:ct,json:{read:!1,write:!1}})],t.prototype,"timeInfo",null),n([u({type:et,json:{read:!1,write:!1}})],t.prototype,"timeExtent",null),n([u({type:Us,json:{read:!1,write:!1}})],t.prototype,"timeOffset",null),n([u({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],t.prototype,"datesInUnknownTimezone",null),n([u({type:ne,readOnly:!0,json:{read:{source:"timeInfo"}}})],t.prototype,"serviceTimeInfo",void 0),t=n([_("esri.layers.mixins.TemporalSceneLayer")],t),t};let ne=class extends Q{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};n([u({type:String})],ne.prototype,"endTimeField",void 0),n([u({type:String})],ne.prototype,"startTimeField",void 0),ne=n([_("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],ne);let V=class extends Q{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};n([u({type:String,json:{read:!0,write:!0}})],V.prototype,"name",void 0),n([u({type:String,json:{read:!0,write:!0}})],V.prototype,"field",void 0),n([u({type:[Number],json:{read:!0,write:!0}})],V.prototype,"currentRangeExtent",void 0),n([u({type:[Number],json:{read:!0,write:!0}})],V.prototype,"fullRangeExtent",void 0),n([u({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],V.prototype,"type",void 0),V=n([_("esri.layers.support.RangeInfo")],V);var we;let ke=we=class extends Wr(_e.ofType(ve)){constructor(e){super(e)}clone(){return new we(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var r,s;const t=(r=e==null?void 0:e.layer)==null?void 0:r.spatialReference;return t?this.toArray().map(i=>{var o;if(!t.equals(i.spatialReference)){if(!_t(i.spatialReference,t))return(o=e==null?void 0:e.messages)==null||o.push(new rt("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const l=new ve;zr(i,l,t),i=l}const a=i.toJSON(e);return delete a.spatialReference,a}).filter(i=>i!=null):((s=e==null?void 0:e.messages)==null||s.push(new rt("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(i=>i.toJSON(e)))}static fromJSON(e,t){const r=new we;return e.forEach(s=>r.add(ve.fromJSON(s,t))),r}};ke=we=n([_("esri.layers.support.PolygonCollection")],ke);const xe=ke;var He;let J=He=class extends Q{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new xe,this._geometriesSource=null}initialize(){this.addHandles(jt(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,qr))}readGeometries(e,t,r){Array.isArray(e)?this.geometries=xe.fromJSON(e,r):this._geometriesSource={url:Vr(e,r),context:r}}async loadGeometries(e,t){if(this._geometriesSource==null)return;const{url:r,context:s}=this._geometriesSource,i=await Ut(r,{responseType:"json",signal:t==null?void 0:t.signal}),a=e.toJSON(),o=i.data.map(l=>({...l,spatialReference:a}));this.geometries=xe.fromJSON(o,s),this._geometriesSource=null}clone(){const e=new He({geometries:ge(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};n([u({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],J.prototype,"spatialRelationship",void 0),n([u({type:xe,nonNullable:!0,json:{write:!0}}),ai({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],J.prototype,"geometries",void 0),n([k(["web-scene","portal-item"],"geometries")],J.prototype,"readGeometries",null),J=He=n([_("esri.layers.support.SceneFilter")],J);const la=J;async function ua({fieldName:e,statisticsInfo:t,errorContext:r,fieldsIndex:s,path:i,customParameters:a,apiKey:o,signal:l}){if(t==null)throw new b(`${r}:no-cached-statistics`,"Cached statistics are not available for this layer");const c=s.get(e);if(c==null)throw new b(`${r}:field-unexisting`,`Field '${e}' does not exist on the layer`);const p=t.find(y=>y.name===c.name);if(p==null)throw new b(`${r}:no-cached-statistics`,"Cached statistics for this attribute are not available");const d=Gr(i,p.href),{data:m}=await Ut(d,{query:{f:"json",...a,token:o},responseType:"json",signal:l});return m}async function ca(e){const t=[];for(const r of e)r.name.toLowerCase().endsWith(".zip")?t.push(pa(r)):t.push(Promise.resolve(r));return(await Promise.all(t)).flat()}async function pa(e){const{BlobReader:t,ZipReader:r,BlobWriter:s}=await ue(()=>import("./zipjs-wrapper-BRVdzJCO.js"),[]),i=[];return(await new r(new t(e)).getEntries()).forEach(o=>{var p;if(o.directory||/^__MACOS/i.test(o.filename))return;const l=new s,c=(p=o.getData)==null?void 0:p.call(o,l).then(d=>new File([d],o.filename));c&&i.push(c)}),Promise.all(i)}const da=new Set(["3DObject","Point"]),At=Zs();let h=class extends oa(Es(Ps(Os(Ds(Ms(kr(is(js(_s(Ft(es))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new _e,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}destroy(){this._set("renderer",null),this.associatedLayer=Hr(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var s,i,a;const r=(i=(s=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:s.domains)==null?void 0:i[e];return r&&r.type!=="inherited"?r:((a=this.getField(e))==null?void 0:a.domain)??null}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){var e;return((e=this.associatedLayer)==null?void 0:e.types)??[]}get typeIdField(){var e;return((e=this.associatedLayer)==null?void 0:e.typeIdField)??null}get templates(){var e;return((e=this.associatedLayer)==null?void 0:e.templates)??null}get formTemplate(){var e;return((e=this.associatedLayer)==null?void 0:e.formTemplate)??null}get attributeTableTemplate(){var e;return((e=this.associatedLayer)==null?void 0:e.attributeTableTemplate)??null}get fieldsIndex(){return new Br(this.fields)}readNodePages(e,t,r){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:er.fromJSON(e,r)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){var e;return this._capabilitiesFromAssociatedFeatureLayer((e=this.associatedLayer)==null?void 0:e.effectiveCapabilities)}get effectiveEditingEnabled(){return this.associatedLayer!=null&&Hs(this.associatedLayer)}get geometryType(){return ha[this.profile]||"mesh"}set renderer(e){st(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){var e;return this._capabilitiesFromAssociatedFeatureLayer((e=this.associatedLayer)==null?void 0:e.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){var z;e=e??Ws;const{query:t,queryRelated:r,editing:{supportsGlobalId:s,supportsRollbackOnFailure:i,supportsUploadWithItemId:a,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:l},data:{supportsZ:c,supportsM:p,isVersioned:d,supportsAttachment:m},operations:{supportsEditing:y,supportsAdd:f,supportsUpdate:g,supportsDelete:v,supportsQuery:$,supportsQueryAttachments:A,supportsAsyncConvert3D:x}}=e,w=e.operations.supportsChangeTracking,T=!!((z=this.associatedLayer)!=null&&z.infoFor3D);return{query:t,queryRelated:r,editing:{supportsGlobalId:s,supportsReturnServiceEditsInSourceSpatialReference:l,supportsRollbackOnFailure:i,supportsGeometryUpdate:T&&o,supportsUploadWithItemId:a},data:{supportsAttachment:m,supportsZ:c,supportsM:p,isVersioned:d},operations:{supportsQuery:$,supportsQueryAttachments:A,supportsEditing:y&&w,supportsAdd:T&&f&&w,supportsDelete:T&&v&&w,supportsUpdate:g&&w,supportsAsyncConvert3D:x}}}get editingEnabled(){var e;return this._isOverridden("editingEnabled")?this._get("editingEnabled"):((e=this.associatedLayer)==null?void 0:e.editingEnabled)??!1}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){var e;return((e=this.associatedLayer)==null?void 0:e.infoFor3D)??null}get relationships(){var e;return(e=this.associatedLayer)==null?void 0:e.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeOID"&&(e=r.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(e=r.name),!!e)),e||void 0}get displayField(){var e;return((e=this.associatedLayer)==null?void 0:e.displayField)??null}readProfile(e,t){const r=t.store.profile;return r!=null&&Lt[r]?Lt[r]:(R.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}get useViewTime(){var e;return((e=this.associatedLayer)==null?void 0:e.useViewTime)??!0}set useViewTime(e){this._override("useViewTime",e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const t=e!=null?e.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(Qr),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await ni(this,{origin:"service"},t),st(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){R.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:e}),this.filter=null}}createQuery(){var t;const e=new Kr;return this.geometryType==="mesh"?(t=this.associatedLayer)!=null&&t.infoFor3D&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const s of r.features)s.layer=this,s.sourceLayer=this;return r})}async queryRelatedFeatures(e,t){if(await this.load(),!this.associatedLayer)throw new b("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.associatedLayer)throw new b("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,t)}async queryCachedAttributes(e,t){var s;const r=Zr(this.fieldsIndex,await pi(this,di(this)));return ci(((s=this.parsedUrl)==null?void 0:s.path)??"",this.attributeStorageInfo??[],e,t,r,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){const r=await this.queryCachedAttributes(e,[t]);if(!r||r.length===0)throw new b("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const s=new Jr;return s.attributes=r[0],s.layer=this,s.sourceLayer=this,s}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(R.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return ui(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e!=null&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new b("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new b("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(ut.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(ut.SAVE,e)}async applyEdits(e,t){const{applyEdits:r}=await ue(()=>import("./editingSupport-lDfEVIjI.js"),__vite__mapDeps([83,1,2,39,38,33]));let s=t;await this.load();const i=this.associatedLayer;if(!i)throw new b(`${this.type}-layer:not-editable`,"Service is not editable");await i.load();const{globalIdField:a}=i,o=!!i.infoFor3D,l=(s==null?void 0:s.globalIdUsed)??!0;if(o&&a==null)throw new b(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(o&&!l)throw new b(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return it(i.url)&&o&&e.deleteFeatures!=null&&a!=null&&(s={...s,globalIdToObjectId:await Bs(i,e.deleteFeatures,a)}),r(this,i.source,e,s)}async uploadAssets(e,t){if(await this.load(),this.associatedLayer==null)throw new b(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,t)}on(e,t){return super.on(e,t)}async convertMesh(e,t){t??(t={});const r=d=>{throw R.getLogger(this).error(".convertMesh()",d.message),d};await this.load(),this.infoFor3D||r(new b("invalid:layer","SceneLayer has no capability for mesh conversion"));const s=await this.extractAndFilterFiles(e),i=s.reduce((d,m)=>ei(this.infoFor3D,m)?d+1:d,0);i===0&&r(new Ls),i>1&&r(new Fs);const a=this.spatialReference,o=t.location??new M({x:0,y:0,z:0,spatialReference:a}),l=o.spatialReference.isGeographic?"local":"georeferenced",c=na.createWithExternalSource(o,s,{vertexSpace:l,transform:Rs(o.spatialReference),unitConversionDisabled:!0}),[p]=await this.uploadAssets([c],{...t,useAssetOrigin:!t.location});return p}async extractAndFilterFiles(e){await this.load();const t=this.infoFor3D;return t?(await ca(e)).filter(r=>ti(t,r)):e}validateLayer(e){if(e.layerType&&!da.has(e.layerType))throw new b("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new b("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new b("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(r,s){let i=!1,a=!1;if(r==null)i=!0,a=!0;else{const o=s&&s.isGeographic;switch(r){case"east-north-up":case"earth-centered":i=!0,a=o;break;case"vertex-reference-frame":i=!0,a=!o;break;default:i=!1}}if(!i)throw new b("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!a)throw new b("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new b("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){var e,t,r;if(this._fieldUsageInfo={},this.fields)for(const s of this.fields){const i=!!((e=this.attributeStorageInfo)!=null&&e.some(l=>l.name===s.name)),a=!!((r=(t=this.associatedLayer)==null?void 0:t.fields)!=null&&r.some(l=>l&&s.name===l.name)),o={supportsLabelingInfo:i,supportsRenderer:i,supportsPopupTemplate:i||a,supportsLayerQuery:a};this._fieldUsageInfo[s.name]=o}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){var t;if(!((t=this.associatedLayer)!=null&&t.fields))return;let e=null;for(const r of this.associatedLayer.fields){const s=this.getField(r.name);s?(!s.domain&&r.domain&&(s.domain=r.domain.clone()),s.editable=r.editable,s.nullable=r.nullable,s.length=r.length):(e||(e=this.fields?this.fields.slice():[]),e.push(r.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled"],t=at(this);for(let r=0;r<e.length;r++){const s=e[r],i=this.originIdOf(s),a=this.associatedLayer.originIdOf(s);i<a&&(a===Ee.SERVICE||a===Ee.PORTAL_ITEM)&&t.setAtOrigin(s,this.associatedLayer[s],a)}}_applyAssociatedLayerExtentOverride(){var t,r,s;const e=(t=this.associatedLayer)==null?void 0:t.getAtOrigin("fullExtent","service");((r=this.associatedLayer)==null?void 0:r.infoFor3D)==null||!e||!it((s=this.associatedLayer)==null?void 0:s.url)||!hr(this)||at(this).setAtOrigin("fullExtent",e.clone(),Ee.SERVICE)}_applyAssociatedLayerPrivileges(){const e=this.associatedLayer;e&&(this._set("userHasEditingPrivileges",e.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",e.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if(["mesh-pyramids","points"].includes(this.profile))try{const{serverUrl:t,layerId:r,portalItem:s}=await Ns(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e}),i=await ii.FeatureLayer();this.associatedLayer=new i({url:t,customParameters:this.customParameters,layerId:r,portalItem:s}),await this.associatedLayer.load()}catch(t){Yr(t)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await Xr(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?R.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):R.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;this.profile==="mesh-pyramids"&&dt(R.getLogger(this),oi("Mesh scene layers","relative-to-scene",e)),dt(R.getLogger(this),li("Scene layers",e))}async fetchStatistics(e,t){var r;return await ua({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:"scenelayer",fieldsIndex:this.fieldsIndex,path:((r=this.parsedUrl)==null?void 0:r.path)??"",customParameters:this.customParameters,apiKey:this.apiKey,signal:t==null?void 0:t.signal})}};n([u({types:{key:"type",base:Ks,typeMap:{selection:Qs}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],h.prototype,"featureReduction",void 0),n([u({type:[V],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],h.prototype,"rangeInfos",void 0),n([u({json:{read:!1}})],h.prototype,"associatedLayer",void 0),n([u({type:["show","hide"]})],h.prototype,"listMode",void 0),n([u({type:["ArcGISSceneServiceLayer"]})],h.prototype,"operationalLayerType",void 0),n([u({json:{read:!1},readOnly:!0})],h.prototype,"type",void 0),n([u({...At.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"fields",void 0),n([u()],h.prototype,"types",null),n([u()],h.prototype,"typeIdField",null),n([u()],h.prototype,"templates",null),n([u()],h.prototype,"formTemplate",null),n([u()],h.prototype,"attributeTableTemplate",null),n([u({readOnly:!0,clonable:!1})],h.prototype,"fieldsIndex",null),n([u({type:si,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],h.prototype,"floorInfo",void 0),n([u(At.outFields)],h.prototype,"outFields",void 0),n([u({type:er,readOnly:!0,json:{read:!1}})],h.prototype,"nodePages",void 0),n([k("service","nodePages",["nodePages","pointNodePages"])],h.prototype,"readNodePages",null),n([u({type:[Js],readOnly:!0})],h.prototype,"materialDefinitions",void 0),n([u({type:[Ys],readOnly:!0})],h.prototype,"textureSetDefinitions",void 0),n([u({type:[Xs],readOnly:!0})],h.prototype,"geometryDefinitions",void 0),n([u({readOnly:!0})],h.prototype,"serviceUpdateTimeStamp",void 0),n([u({readOnly:!0})],h.prototype,"attributeStorageInfo",void 0),n([u({readOnly:!0})],h.prototype,"statisticsInfo",void 0),n([u({type:_e.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],h.prototype,"excludeObjectIds",void 0),n([u({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],h.prototype,"definitionExpression",void 0),n([u({type:la,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],h.prototype,"filter",void 0),n([u({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],h.prototype,"path",void 0),n([u(zs)],h.prototype,"elevationInfo",null),n([u({readOnly:!0,json:{read:!1}})],h.prototype,"effectiveCapabilities",null),n([u({readOnly:!0})],h.prototype,"effectiveEditingEnabled",null),n([u({type:String})],h.prototype,"geometryType",null),n([u(qs)],h.prototype,"labelsVisible",void 0),n([u({type:[ri],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:pt},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:pt},write:!0}})],h.prototype,"labelingInfo",void 0),n([u(Vs)],h.prototype,"legendEnabled",void 0),n([u({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var s,i;if(typeof e=="number"&&e>=0&&e<=1)return e;const r=(i=(s=t.layerDefinition)==null?void 0:s.drawingInfo)==null?void 0:i.transparency;return r!==void 0?ts(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],h.prototype,"opacity",void 0),n([u({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"priority",void 0),n([u({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"semantic",void 0),n([u({types:rs,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],h.prototype,"renderer",null),n([u({json:{read:!1}})],h.prototype,"cachedDrawingInfo",void 0),n([k("service","cachedDrawingInfo")],h.prototype,"readCachedDrawingInfo",null),n([u({readOnly:!0,json:{read:!1}})],h.prototype,"capabilities",null),n([u({type:Boolean,json:{read:!1}})],h.prototype,"editingEnabled",null),n([u({readOnly:!0,json:{write:!1,read:!1}})],h.prototype,"infoFor3D",null),n([u({readOnly:!0,json:{write:!1,read:!1}})],h.prototype,"relationships",null),n([u(Gs)],h.prototype,"popupEnabled",void 0),n([u({type:ss,json:{name:"popupInfo",write:!0}})],h.prototype,"popupTemplate",void 0),n([u({readOnly:!0,json:{read:!1}})],h.prototype,"defaultPopupTemplate",null),n([u({type:String,json:{read:!1}})],h.prototype,"objectIdField",void 0),n([k("service","objectIdField",["objectIdField","fields"])],h.prototype,"readObjectIdField",null),n([u({type:String,json:{read:!1}})],h.prototype,"globalIdField",void 0),n([k("service","globalIdField",["globalIdField","fields"])],h.prototype,"readGlobalIdField",null),n([u({readOnly:!0,type:String,json:{read:!1}})],h.prototype,"displayField",null),n([u({type:String,json:{read:!1}})],h.prototype,"profile",void 0),n([k("service","profile",["store.profile"])],h.prototype,"readProfile",null),n([u({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],h.prototype,"normalReferenceFrame",void 0),n([u(ks)],h.prototype,"screenSizePerspectiveEnabled",void 0),n([u({json:{read:!1,origins:{service:{read:!0}}}})],h.prototype,"serviceItemId",void 0),n([u(Cs)],h.prototype,"useViewTime",null),h=n([_("esri.layers.SceneLayer")],h);const Lt={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},ha={"mesh-pyramids":"mesh",points:"point"},fa=h,yn=Object.freeze(Object.defineProperty({__proto__:null,default:fa},Symbol.toStringTag,{value:"Module"}));export{na as $,yn as S,le as c,te as f,fi as m,oe as w};
//# sourceMappingURL=SceneLayer-f_iCIoZq.js.map
