{"version":3,"file":"AGraphicContainer-DGP7OLi_.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/GraphicInstanceStore.js","../../node_modules/@arcgis/core/views/2d/layers/graphics/GraphicBoundsRenderer.js","../../node_modules/@arcgis/core/views/2d/layers/graphics/AGraphicContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{FeatureTechniqueInstance as e}from\"./TechniqueInstance.js\";import{Techniques as i}from\"./TechniqueRegistry.js\";import{castInstanceId as t}from\"./mesh/instanceIdUtils.js\";let n=0;function a(i,a){return new e(t(n++),i,a)}const l={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class o{constructor(){this.instances={fill:a(i.fill,{uniforms:l,optionalAttributes:{zoomRange:!0}}),marker:a(i.marker,{uniforms:l,optionalAttributes:{zoomRange:!0}}),line:a(i.line,{uniforms:l,optionalAttributes:{zoomRange:!0}}),text:a(i.text,{uniforms:l,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:a(i.complexFill,{uniforms:l,optionalAttributes:{zoomRange:!0}}),texturedLine:a(i.texturedLine,{uniforms:l,optionalAttributes:{zoomRange:!0}}),animatedMarker:a(i.animatedMarker,{uniforms:l,optionalAttributes:{zoomRange:!0}})},this._instancesById=Object.values(this.instances).reduce(((e,i)=>(e.set(i.instanceId,i),e)),new Map)}getInstance(e){return this._instancesById.get(e)}}export{o as GraphicInstanceStore};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as t}from\"../../../../core/maybe.js\";import{identity as e,multiply as r,translate as i,scale as s,rotate as o}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as a}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as l}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as f}from\"../../../../geometry/support/normalizeUtils.js\";import{DisplayObject as m}from\"../../engine/DisplayObject.js\";import{createProgramDescriptor as c}from\"../../engine/webgl/Utils.js\";import{BufferObject as u}from\"../../../webgl/BufferObject.js\";import{BlendFactor as _,PrimitiveType as h,DataType as p,Usage as d}from\"../../../webgl/enums.js\";import{VertexArrayObject as g}from\"../../../webgl/VertexArrayObject.js\";const v=Math.PI/180,x=4;class b extends m{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=a(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=t(this._program)}doRender(t){const{context:e}=t,r=this._getBounds();if(r.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,r),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(_.ONE,_.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const i=this._program;e.bindVAO(this._vao),e.useProgram(i),i.setUniformMatrix3fv(\"u_dvsMat3\",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(h.LINES,8*r.length,p.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{displayViewScreenMat3:a()}}_createShaderProgram(t){if(this._program)return;const e=\"precision highp float;\\n        uniform mat3 u_dvsMat3;\\n\\n        attribute vec2 a_position;\\n\\n        void main() {\\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\\n        }\",r=\"precision mediump float;\\n      void main() {\\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\\n      }\";this._program=t.programCache.acquire(e,r,y().attributes)}_updateMatricesAndLocalOrigin(t){const{state:a}=t,{displayMat3:m,size:c,resolution:u,pixelRatio:_,rotation:h,viewpoint:p}=a,d=v*h,{x:g,y:x}=p.targetGeometry,b=f(g,a.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const y=_*c[0],B=_*c[1],M=u*y,j=u*B,A=e(this._dvsMat3);r(A,A,m),i(A,A,n(y/2,B/2)),s(A,A,l(c[0]/M,-B/j,1)),o(A,A,-d)}_updateBufferData(t,e){const{x:r,y:i}=this._localOrigin,s=2*x*e.length,o=new Float32Array(s),a=new Uint32Array(8*e.length);let n=0,l=0;for(const f of e)f&&(o[2*n]=f[0]-r,o[2*n+1]=f[1]-i,o[2*n+2]=f[0]-r,o[2*n+3]=f[3]-i,o[2*n+4]=f[2]-r,o[2*n+5]=f[3]-i,o[2*n+6]=f[2]-r,o[2*n+7]=f[1]-i,a[l]=n+0,a[l+1]=n+3,a[l+2]=n+3,a[l+3]=n+2,a[l+4]=n+2,a[l+5]=n+1,a[l+6]=n+1,a[l+7]=n+0,n+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=u.createVertex(t,d.DYNAMIC_DRAW,o.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=u.createIndex(t,d.DYNAMIC_DRAW,a),!this._vao){const e=y();this._vao=new g(t,e.attributes,e.bufferLayouts,new Map([[\"geometry\",this._vertexBuffer]]),this._indexBuffer)}}}const y=()=>c(\"bounds\",{geometry:[{location:0,name:\"a_position\",count:2,type:p.FLOAT}]});export{b as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{destroyMaybe as e}from\"../../../../core/maybe.js\";import{AFeatureContainer as t}from\"../../engine/AFeatureContainer.js\";import{FeatureBatchingStrategy as n}from\"../../engine/webgl/enums.js\";import{GraphicInstanceStore as r}from\"../../engine/webgl/shaderGraph/techniques/GraphicInstanceStore.js\";import s from\"./GraphicBoundsRenderer.js\";class i extends t{constructor(e){super(e),this._instanceStore=new r,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=e(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(e){this._boundsRenderer=new s(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.onMessage(t),this.contains(e)||this.addChild(e),this.requestRender()}_renderChildren(e,t){e.selection=t;for(const r of this.children){if(!r.visible)continue;const t=r.getDisplayList(this._instanceStore,n.STRICT_ORDER);t?.render(e)}}}export{i as AGraphicContainer};\n"],"names":["n","a","i","e","t","l","o","v","x","b","m","_","h","p","y","c","u","d","g","f","B","M","j","A","r","s"],"mappings":"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","x_google_ignoreList":[0,1,2]}