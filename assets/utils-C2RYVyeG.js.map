{"version":3,"file":"utils-C2RYVyeG.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../../core/handleUtils.js\";import{Milliseconds as e}from\"../../../../../core/time.js\";import{imageTypeToCanvas as r}from\"../../../../../geometry/support/meshUtils/exporters/gltf/imageutils.js\";import{AnimatedSymbolRepeatType as i}from\"../../../../../symbols/cim/enums.js\";import{getRandomValue as a}from\"../grouping.js\";function n(t){return e(t.frameDurations.reduce(((t,e)=>t+e),0))}function o(t){const{width:e,height:r}=t,i=t.frameDurations.reverse(),a=e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)};return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:a,width:e,height:r}}function s(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map((t=>e(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}function m(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}function u(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class h{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=0;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,r,c,f){let l,{repeatType:d}=r;if(null==d&&(d=i.Loop),!0===r.reverseAnimation&&(t=o(t)),null!=r.duration&&(t=s(t,e(1e3*r.duration))),null!=r.repeatDelay){const a=1e3*r.repeatDelay;d===i.Loop?t=u(t,e(a)):d===i.Oscillate&&(t=m(u(t,e(a/2)),e(a/2)))}if(null!=r.startTimeOffset)l=e(1e3*r.startTimeOffset);else if(null!=r.randomizeStartTime){const i=82749913,o=null!=r.randomizeStartSeed?r.randomizeStartSeed:i,s=a(c,o);l=e(s*n(t))}else l=e(0);return new h(t,l,d,f)}function f(e,r,i,a){const n=null==r.playAnimation||r.playAnimation,o=c(e,r,i,a);let s,m=o.timeToFrame;function u(){s=n?setTimeout((()=>{o.nextFrame(),m=o.timeToFrame,u()}),m):void 0}return u(),t((()=>n&&clearTimeout(s)))}let l,d;function g(){return l??=document.createElement(\"canvas\"),d??=l.getContext(\"2d\"),{canvas:l,ctx:d}}function F(t,e,i){const{canvas:a,ctx:n}=g();a.width=e,a.height=i;const o=[],s=t.frameDurations.length;for(let m=0;m<s;m++){const a=t.getFrame(m);n.clearRect(0,0,e,i),a instanceof ImageData?n.drawImage(r(a),0,0,e,i):n.drawImage(a,0,0,e,i),o.push(n.getImageData(0,0,e,i))}return{width:e,height:i,frameDurations:t.frameDurations,getFrame:t=>o[t],frameCount:t.frameCount,duration:t.duration}}export{h as Player,s as adjustDuration,u as appendDelay,c as createPlayer,n as getDuration,f as play,m as prependDelay,F as resize,o as reverse};\n"],"names":["n","t","e","o","r","i","a","s","m","u","h","c","f","l","d"],"mappings":"oGAIqW,SAASA,EAAEC,EAAE,CAAC,OAAOC,EAAED,EAAE,eAAe,OAAQ,CAAC,EAAEC,IAAI,EAAEA,EAAG,CAAC,CAAC,CAAC,CAAC,SAASC,EAAEF,EAAE,CAAC,KAAK,CAAC,MAAMC,EAAE,OAAOE,CAAC,EAAEH,EAAEI,EAAEJ,EAAE,eAAe,QAAO,EAAGK,EAAEJ,GAAG,CAAC,MAAME,EAAEH,EAAE,eAAe,OAAO,EAAEC,EAAE,OAAOD,EAAE,SAASG,CAAC,CAAC,EAAE,MAAM,CAAC,WAAWH,EAAE,WAAW,SAASA,EAAE,SAAS,eAAeI,EAAE,SAASC,EAAE,MAAMJ,EAAE,OAAOE,CAAC,CAAC,CAAC,SAASG,EAAEN,EAAEG,EAAE,CAAC,KAAK,CAAC,MAAMC,EAAE,OAAOC,EAAE,SAASN,CAAC,EAAEC,EAAEE,EAAEC,EAAEH,EAAE,SAASM,EAAEN,EAAE,eAAe,IAAKA,GAAGC,EAAED,EAAEE,CAAC,CAAG,EAAC,MAAM,CAAC,WAAWF,EAAE,WAAW,SAASA,EAAE,SAAS,eAAeM,EAAE,SAASP,EAAE,MAAMK,EAAE,OAAOC,CAAC,CAAC,CAAC,SAASE,EAAEP,EAAEG,EAAE,CAAC,KAAK,CAAC,MAAMC,EAAE,OAAOC,EAAE,SAASN,CAAC,EAAEC,EAAEE,EAAEF,EAAE,eAAe,MAAO,EAACM,EAAEJ,EAAE,MAAK,EAAG,OAAOA,EAAE,QAAQD,EAAEK,EAAEH,CAAC,CAAC,EAAE,CAAC,WAAWH,EAAE,WAAW,SAASA,EAAE,SAASG,EAAE,eAAeD,EAAE,SAASH,EAAE,MAAMK,EAAE,OAAOC,CAAC,CAAC,CAAC,SAASG,EAAER,EAAEG,EAAE,CAAC,KAAK,CAAC,MAAMC,EAAE,OAAOC,EAAE,SAASN,CAAC,EAAEC,EAAEE,EAAEF,EAAE,eAAe,MAAO,EAACM,EAAEJ,EAAE,IAAK,EAAC,OAAOA,EAAE,KAAKD,EAAEK,EAAEH,CAAC,CAAC,EAAE,CAAC,WAAWH,EAAE,WAAW,SAASA,EAAE,SAASG,EAAE,eAAeD,EAAE,SAASH,EAAE,MAAMK,EAAE,OAAOC,CAAC,CAAC,CAAC,MAAMI,CAAC,CAAC,YAAY,EAAER,EAAEE,EAAEC,EAAE,CAAC,KAAK,WAAW,EAAE,KAAK,YAAYD,EAAE,KAAK,aAAaC,EAAE,KAAK,WAAW,EAAE,KAAK,cAAc,EAAE,KAAK,YAAY,KAAK,WAAW,eAAe,KAAK,aAAa,EAAE,IAAIC,EAAE,EAAE,KAAKJ,EAAEI,GAAGA,GAAG,KAAK,YAAY,KAAK,UAAS,EAAG,MAAMN,EAAE,KAAK,WAAW,SAAS,KAAK,aAAa,EAAE,KAAK,aAAaA,CAAC,CAAC,CAAC,WAAW,CAAC,GAAG,KAAK,eAAe,KAAK,WAAW,KAAK,WAAW,GAAG,GAAG,KAAK,gBAAgB,KAAK,WAAW,eAAe,OAAO,OAAO,KAAK,YAAW,CAAE,KAAKK,EAAE,KAAK,KAAK,eAAe,KAAK,WAAW,MAAM,KAAKA,EAAE,KAAK,KAAK,cAAc,EAAE,MAAM,KAAKA,EAAE,UAAU,KAAK,eAAe,KAAK,WAAW,KAAK,WAAW,EAAE,UAAe,KAAK,gBAAV,GAAwB,OAAO,KAAK,YAAW,CAAE,KAAKA,EAAE,KAAK,KAAK,eAAe,KAAK,WAAW,MAAM,KAAKA,EAAE,KAAK,KAAK,cAAc,KAAK,WAAW,eAAe,OAAO,EAAE,MAAM,KAAKA,EAAE,UAAU,KAAK,eAAe,KAAK,WAAW,KAAK,WAAW,CAAC,CAAC,KAAK,YAAY,KAAK,WAAW,eAAe,KAAK,aAAa,EAAE,MAAM,EAAE,KAAK,WAAW,SAAS,KAAK,aAAa,EAAE,KAAK,aAAa,CAAC,CAAC,CAAC,CAAC,SAASM,EAAEV,EAAEG,EAAEO,EAAEC,EAAE,CAAC,IAAIC,EAAE,CAAC,WAAWC,CAAC,EAAEV,EAAE,GAASU,GAAN,OAAUA,EAAET,EAAE,MAAWD,EAAE,mBAAP,KAA0BH,EAAEE,EAAEF,CAAC,GAASG,EAAE,UAAR,OAAmBH,EAAEM,EAAEN,EAAEC,EAAE,IAAIE,EAAE,QAAQ,CAAC,GAASA,EAAE,aAAR,KAAoB,CAAC,MAAM,EAAE,IAAIA,EAAE,YAAYU,IAAIT,EAAE,KAAKJ,EAAEQ,EAAER,EAAEC,EAAE,CAAC,CAAC,EAAEY,IAAIT,EAAE,YAAYJ,EAAEO,EAAEC,EAAER,EAAEC,EAAE,EAAE,CAAC,CAAC,EAAEA,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,GAASE,EAAE,iBAAR,KAAwBS,EAAEX,EAAE,IAAIE,EAAE,eAAe,UAAgBA,EAAE,oBAAR,KAA2B,CAAC,MAAiBD,EAAQC,EAAE,oBAAR,KAA2BA,EAAE,mBAAmB,SAAEG,EAAED,EAAEK,EAAER,CAAC,EAAEU,EAAEX,EAAEK,EAAEP,EAAEC,CAAC,CAAC,CAAC,MAAMY,EAAEX,EAAE,CAAC,EAAE,OAAO,IAAIQ,EAAET,EAAEY,EAAEC,EAAEF,CAAC,CAAC,CAAC,SAASA,EAAEV,EAAEE,EAAEC,EAAEC,EAAE,CAAC,MAAMN,EAAQI,EAAE,eAAR,MAAuBA,EAAE,cAAcD,EAAEQ,EAAET,EAAEE,EAAEC,EAAEC,CAAC,EAAE,IAAIC,EAAEC,EAAEL,EAAE,YAAY,SAASM,GAAG,CAACF,EAAEP,EAAE,WAAY,IAAI,CAACG,EAAE,UAAS,EAAGK,EAAEL,EAAE,YAAYM,EAAC,CAAE,EAAGD,CAAC,EAAE,MAAM,CAAC,OAAOC,EAAC,EAAGR,EAAG,IAAID,GAAG,aAAaO,CAAC,CAAG,CAAA","x_google_ignoreList":[0]}