{"version":3,"file":"RawBlockCache-C99I59J0.js","sources":["../../node_modules/@arcgis/core/layers/support/rasterDatasets/EphemeralBlockCache.js","../../node_modules/@arcgis/core/layers/support/rasterDatasets/RawBlockCache.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nclass t{constructor(t=15e3,e=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,e)}decreaseRefCount(t,e){const s=t+\"/\"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.refCount--,t.refCount<=0&&(r.delete(s),t.controller&&t.controller.abort()),t.refCount}return 0}getBlock(t,e){const s=t+\"/\"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.ts=Date.now(),t.refCount++,r.delete(s),r.set(s,t),t.block}return null}putBlock(t,e,s,r){const i=this._cachedBlocks,c=t+\"/\"+e;if(i.has(c)){const t=i.get(c);t.ts=Date.now(),t.refCount++}else i.set(c,{block:s,ts:Date.now(),refCount:1,controller:r});this._trim(),this._updateTimer()}deleteBlock(t,e){const s=this._cachedBlocks,r=t+\"/\"+e;s.has(r)&&s.delete(r)}updateMaxSize(t){this._size=t,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const t=this._cachedBlocks;this._timer=setInterval((()=>{const e=Array.from(t),s=Date.now();for(let r=0;r<e.length&&e[r][1].ts<=s-this._duration;r++)t.delete(e[r][0]);0===t.size&&this._clearTimer()}),this._interval)}_trim(){const t=this._cachedBlocks;if(-1===this._size||this._size>=t.size)return;const e=Array.from(t);for(let s=0;s<e.length-this._size;s++)t.delete(e[s][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}export{t as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport\"../../../geometry.js\";import e from\"./EphemeralBlockCache.js\";import{projectExtent as t,projectResolution as n,snapPyramid as o}from\"../rasterFunctions/rasterProjectionHelper.js\";import l from\"../../../geometry/Point.js\";const r=new Map,c=new e;function i(e,t){return null==t?e:`${e}?sliceId=${t}`}function u(e,t){const n={extent:null,rasterInfo:t,cache:new Map},o=r.get(e);return o?(o.push(n),o.length-1):(r.set(e,[n]),0)}function a(e,t){const n=r.get(e);n&&(n[t]=null,n.some((e=>null!=e))||r.delete(e))}function f(e){r.delete(e)}function s(e,t,n){const o=r.get(e);if(!o)return null==t?c.decreaseRefCount(e,n):0;if(null==t||null==o[t])return c.decreaseRefCount(e,n);const l=o[t]?.cache,i=l?.get(n);if(l&&i){if(i.refCount--,0===i.refCount){l.delete(n);for(let e=0;e<o.length;e++)o[e]?.cache.delete(n);i.controller&&i.controller.abort()}return i.refCount}return 0}function m(e,t,n){const o=r.get(e);if(!o)return null==t?c.getBlock(e,n):null;if(null==t||null==o[t]){for(let e=0;e<o.length;e++){const t=o[e]?.cache.get(n);if(t)return t.refCount++,t.block}return c.getBlock(e,n)}const l=o[t]?.cache.get(n);if(l)return l.refCount++,l.block;for(let r=0;r<o.length;r++){if(r===t||!o[r])continue;const e=o[r]?.cache,l=e?.get(n);if(e&&l)return l.refCount++,e.set(n,l),l.block}return null}function x(e,t,n,o,l=null){const i=r.get(e);if(!i)return void(null==t&&c.putBlock(e,n,o,l));if(null==t||null==i[t])return void c.putBlock(e,n,o,l);const u={refCount:1,block:o,isResolved:!1,isRejected:!1,controller:l};o.then((()=>u.isResolved=!0)).catch((()=>u.isRejected=!0)),i[t]?.cache.set(n,u)}function h(e,t,n){const o=r.get(e);o?null!=t&&null!=o[t]?o[t]?.cache.delete(n):c.deleteBlock(e,n):null==t&&c.deleteBlock(e,n)}function d(e,t){const n=r.get(e);return n?n[t]??null:null}function g(e,r,c,i,u,a,f=null){const s=d(e,r);if(!s)return;const m=s.extent,{cache:x,rasterInfo:h}=s;if(m&&m.xmin===c.xmin&&m.xmax===c.xmax&&m.ymin===c.ymin&&m.ymax===c.ymax)return;i=i??0;const g=c.clone().normalize(),{spatialReference:y,transform:p}=h,k=new Set;for(let d=0;d<g.length;d++){const e=g[d];if(e.xmax-e.xmin<=i||e.ymax-e.ymin<=i)continue;let r=t(e,y,f);null!=p&&(r=p.inverseTransform(r));const c=new l({x:i,y:i,spatialReference:e.spatialReference});if(null==u&&!(u=n(c,y,e,f)))return;const{pyramidLevel:s,pyramidResolution:m,excessiveReading:x}=o(u,h,a||\"closest\");if(x)return;const{storageInfo:M}=h,{origin:R}=M,C={x:Math.max(0,Math.floor((r.xmin-R.x)/m.x)),y:Math.max(0,Math.floor((R.y-r.ymax)/m.y))},B=Math.ceil((r.xmax-r.xmin)/m.x-.1),j=Math.ceil((r.ymax-r.ymin)/m.y-.1),v=s>0?M.pyramidBlockWidth:M.blockWidth,b=s>0?M.pyramidBlockHeight:M.blockHeight,w=1,$=Math.max(0,Math.floor(C.x/v)-w),I=Math.max(0,Math.floor(C.y/b)-w),H=Math.floor((C.x+B-1)/v)+w,E=Math.floor((C.y+j-1)/b)+w;for(let t=I;t<=E;t++)for(let e=$;e<=H;e++)k.add(`${s}/${t}/${e}`)}x.forEach(((e,t)=>{if(!k.has(t)){const e=x.get(t);(null==e||e.isResolved||e.isRejected)&&x.delete(t)}})),s.extent={xmin:c.xmin,ymin:c.ymin,xmax:c.xmax,ymax:c.ymax}}export{s as decreaseRefCount,h as deleteBlock,f as deleteRaster,m as getBlock,i as getRasterId,x as putBlock,u as register,a as unregister,g as update};\n"],"names":["t","s","i","c","r","e","u","n","o","a","l","_a","_b","m","_c","x","h","d","g","f","y","p","k","M","R","C","B","j","v","b","w","$","I","H"],"mappings":"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","x_google_ignoreList":[0,1]}